!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.RamanSpectrum=r():t.RamanSpectrum=r()}("undefined"!=typeof self?self:this,function(){return function(t){var r={};function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var i in t)e.d(n,i,function(r){return t[r]}.bind(null,i));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=15)}([function(t,r,e){"use strict";e(27);var n=e(8),i=e(3);class o extends(n(Array)){constructor(t,r){var e;if(1===arguments.length&&"number"==typeof t)return new Array(t);if(o.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(super(t),!(Number.isInteger(r)&&r>0))throw new TypeError("nColumns must be a positive integer");for(e=0;e<t;e++)this[e]=new Array(r)}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const n=t;if(t=n.length,"number"!=typeof(r=n[0].length)||0===r)throw new TypeError("Data must be a 2D array with at least one element");for(super(t),e=0;e<t;e++){if(n[e].length!==r)throw new RangeError("Inconsistent array dimensions");this[e]=[].concat(n[e])}}}return this.rows=t,this.columns=r,this}set(t,r,e){return this[t][r]=e,this}get(t,r){return this[t][r]}clone(){for(var t=new this.constructor[Symbol.species](this.rows,this.columns),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t.set(r,e,this.get(r,e));return t}removeRow(t){if(i.checkRowIndex(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.splice(t,1),this.rows-=1,this}addRow(t,r){return void 0===r&&(r=t,t=this.rows),i.checkRowIndex(this,t,!0),r=i.checkRowVector(this,r,!0),this.splice(t,0,r),this.rows+=1,this}removeColumn(t){if(i.checkColumnIndex(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(var r=0;r<this.rows;r++)this[r].splice(t,1);return this.columns-=1,this}addColumn(t,r){void 0===r&&(r=t,t=this.columns),i.checkColumnIndex(this,t,!0),r=i.checkColumnVector(this,r);for(var e=0;e<this.rows;e++)this[e].splice(t,0,r[e]);return this.columns+=1,this}}r.Matrix=o,o.abstractMatrix=n},function(t,r,e){"use strict";var n=e(8),i=e(0);t.exports=class extends(n()){constructor(t,r,e){super(),this.matrix=t,this.rows=r,this.columns=e}static get[Symbol.species](){return i.Matrix}}},function(t,r,e){"use strict";t.exports=e(0).Matrix,t.exports.Decompositions=t.exports.DC=e(40)},function(t,r,e){"use strict";var n=e(0);r.checkRowIndex=function(t,r,e){var n=e?t.rows:t.rows-1;if(r<0||r>n)throw new RangeError("Row index out of range")},r.checkColumnIndex=function(t,r,e){var n=e?t.columns:t.columns-1;if(r<0||r>n)throw new RangeError("Column index out of range")},r.checkRowVector=function(t,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return r},r.checkColumnVector=function(t,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return r},r.checkIndices=function(t,r,e){var n=r.some(r=>r<0||r>=t.rows),i=e.some(r=>r<0||r>=t.columns);if(n||i)throw new RangeError("Indices are out of range");if("object"!=typeof r||"object"!=typeof e)throw new TypeError("Unexpected type for row/column indices");return Array.isArray(r)||(r=Array.from(r)),Array.isArray(e)||(r=Array.from(e)),{row:r,column:e}},r.checkRange=function(t,r,e,n,i){if(5!==arguments.length)throw new TypeError("Invalid argument type");var o=Array.from(arguments).slice(1).some(function(t){return"number"!=typeof t});if(o)throw new TypeError("Invalid argument type");if(r>e||n>i||r<0||r>=t.rows||e<0||e>=t.rows||n<0||n>=t.columns||i<0||i>=t.columns)throw new RangeError("Submatrix indices are out of range")},r.getRange=function(t,r){for(var e=new Array(r-t+1),n=0;n<e.length;n++)e[n]=t+n;return e},r.sumByRow=function(t){for(var r=n.Matrix.zeros(t.rows,1),e=0;e<t.rows;++e)for(var i=0;i<t.columns;++i)r.set(e,0,r.get(e,0)+t.get(e,i));return r},r.sumByColumn=function(t){for(var r=n.Matrix.zeros(1,t.columns),e=0;e<t.rows;++e)for(var i=0;i<t.columns;++i)r.set(0,i,r.get(0,i)+t.get(e,i));return r},r.sumAll=function(t){for(var r=0,e=0;e<t.rows;e++)for(var n=0;n<t.columns;n++)r+=t.get(e,n);return r}},function(t,r,e){"use strict";const n=Object.prototype.toString;t.exports=function(t){return n.call(t).endsWith("Array]")}},function(t,r,e){"use strict";r.hypotenuse=function(t,r){var e;return Math.abs(t)>Math.abs(r)?(e=r/t,Math.abs(t)*Math.sqrt(1+e*e)):0!==r?(e=t/r,Math.abs(r)*Math.sqrt(1+e*e)):0},r.getEmpty2DArray=function(t,r){for(var e=new Array(t),n=0;n<t;n++)e[n]=new Array(r);return e},r.getFilled2DArray=function(t,r,e){for(var n=new Array(t),i=0;i<t;i++){n[i]=new Array(r);for(var o=0;o<r;o++)n[i][o]=e}return n}},function(t,r,e){"use strict";function n(t,r){return t-r}r.sum=function(t){for(var r=0,e=0;e<t.length;e++)r+=t[e];return r},r.max=function(t){for(var r=-1/0,e=t.length,n=0;n<e;n++)t[n]>r&&(r=t[n]);return r},r.min=function(t){for(var r=1/0,e=t.length,n=0;n<e;n++)t[n]<r&&(r=t[n]);return r},r.minMax=function(t){for(var r=1/0,e=-1/0,n=t.length,i=0;i<n;i++)t[i]<r&&(r=t[i]),t[i]>e&&(e=t[i]);return{min:r,max:e}},r.arithmeticMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++)r+=t[n];return r/e},r.mean=r.arithmeticMean,r.geometricMean=function(t){for(var r=1,e=t.length,n=0;n<e;n++)r*=t[n];return Math.pow(r,1/e)},r.logMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++)r+=Math.log(t[n]);return r/e},r.grandMean=function(t,r){for(var e=0,n=0,i=t.length,o=0;o<i;o++)e+=r[o]*t[o],n+=r[o];return e/n},r.truncatedMean=function(t,r,e){void 0===e&&(e=!1),e||(t=t.slice().sort(n));for(var i=t.length,o=Math.floor(i*r),a=0,s=o;s<i-o;s++)a+=t[s];return a/(i-2*o)},r.harmonicMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");r+=1/t[n]}return e/r},r.contraHarmonicMean=function(t){for(var r=0,e=0,n=t.length,i=0;i<n;i++)r+=t[i]*t[i],e+=t[i];if(e<0)throw new RangeError("sum of values is negative");return r/e},r.median=function(t,r){void 0===r&&(r=!1),r||(t=t.slice().sort(n));var e=t.length,i=Math.floor(e/2);return e%2==0?.5*(t[i-1]+t[i]):t[i]},r.variance=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),i=0,o=t.length,a=0;a<o;a++){var s=t[a]-n;i+=s*s}return e?i/(o-1):i/o},r.standardDeviation=function(t,e){return Math.sqrt(r.variance(t,e))},r.standardError=function(t){return r.standardDeviation(t)/Math.sqrt(t.length)},r.quartiles=function(t,e){void 0===e&&(e=!1),e||(t=t.slice()).sort(n);var i=t.length/4;return{q1:t[Math.ceil(i)-1],q2:r.median(t,!0),q3:t[Math.ceil(3*i)-1]}},r.pooledStandardDeviation=function(t,e){return Math.sqrt(r.pooledVariance(t,e))},r.pooledVariance=function(t,e){void 0===e&&(e=!0);for(var n=0,i=0,o=t.length,a=0;a<o;a++){var s=t[a],h=r.variance(s);n+=(s.length-1)*h,i+=e?s.length-1:s.length}return n/i},r.mode=function(t){var r,e=t.length,n=new Array(e);for(r=0;r<e;r++)n[r]=0;var i=new Array(e),o=0;for(r=0;r<e;r++){var a=i.indexOf(t[r]);a>=0?n[a]++:(i[o]=t[r],n[o]=1,o++)}var s=0,h=0;for(r=0;r<o;r++)n[r]>s&&(s=n[r],h=r);return i[h]},r.covariance=function(t,e,n){void 0===n&&(n=!0);var i=r.mean(t),o=r.mean(e);if(t.length!==e.length)throw"Vectors do not have the same dimensions";for(var a=0,s=t.length,h=0;h<s;h++){a+=(t[h]-i)*(e[h]-o)}return n?a/(s-1):a/s},r.skewness=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),i=0,o=0,a=t.length,s=0;s<a;s++){var h=t[s]-n;i+=h*h,o+=h*h*h}var l=i/a,u=o/a/Math.pow(l,1.5);return e?Math.sqrt(a*(a-1))/(a-2)*u:u},r.kurtosis=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),i=t.length,o=0,a=0,s=0;s<i;s++){var h=t[s]-n;o+=h*h,a+=h*h*h*h}var l=o/i;if(e){var u=o/(i-1);return i*(i+1)/((i-1)*(i-2)*(i-3))*(a/(u*u))-3*((i-1)*(i-1)/((i-2)*(i-3)))}return a/i/(l*l)-3},r.entropy=function(t,r){void 0===r&&(r=0);for(var e=0,n=t.length,i=0;i<n;i++)e+=t[i]*Math.log(t[i]+r);return-e},r.weightedMean=function(t,r){for(var e=0,n=t.length,i=0;i<n;i++)e+=t[i]*r[i];return e},r.weightedStandardDeviation=function(t,e){return Math.sqrt(r.weightedVariance(t,e))},r.weightedVariance=function(t,e){for(var n=r.weightedMean(t,e),i=0,o=t.length,a=0,s=0,h=0;h<o;h++){var l=t[h]-n,u=e[h];i+=u*(l*l),s+=u,a+=u*u}return i*(s/(s*s-a))},r.center=function(t,e){void 0===e&&(e=!1);var n=t;e||(n=t.slice());for(var i=r.mean(n),o=n.length,a=0;a<o;a++)n[a]-=i},r.standardize=function(t,e,n){void 0===e&&(e=r.standardDeviation(t)),void 0===n&&(n=!1);for(var i=t.length,o=n?t:new Array(i),a=0;a<i;a++)o[a]=t[a]/e;return o},r.cumulativeSum=function(t){var r=t.length,e=new Array(r);e[0]=t[0];for(var n=1;n<r;n++)e[n]=e[n-1]+t[n];return e}},function(t,r,e){"use strict";var n=e(25),i=n.Matrix.algebra,o=e(2);function a(t,r,e){var n,i,a,s,h=r.length/3,l=t.rows,u=o.zeros(t.length,1);for(i=0;i<h;i++)for(s=Math.pow(r[i+2*h][0]/2,2),n=r[i+h][0]*s,a=0;a<l;a++)u[a][0]+=n/(Math.pow(t[a][0]-r[i][0],2)+s);return u}function s(t,r,e){for(var n=r[1][0]*Math.pow(r[2][0]/2,2),i=t.rows,a=new o(t.rows,t.columns),s=0;s<i;s++)a[s][0]=n/(Math.pow(t[s][0]-r[0][0],2)+Math.pow(r[2][0]/2,2));return a}function h(t,r,e){for(var n=r[2][0]*r[2][0]/2,i=t.rows,a=new o(t.rows,t.columns),s=0;s<i;s++)a[s][0]=r[1][0]*Math.exp(-(t[s][0]-r[0][0])*(t[s][0]-r[0][0])/n);return a}function l(t,r,e){var i=f(t,(e=e||{}).percentage||0);if(null===i||i[0].rows<3)return null;var a=i[0],h=i[1],l=i[2],u=[a.rows/Math.sqrt(h.dot(h))],c=(e=Object.create(e.LMOptions||[3,100,.001,.001,.001,.01,.01,11,9,1]),Math.abs(a[0][0]-a[1][0])),m=new o([[-c/1e4],[-.001],[-c/1e4]]),v=new o([[r.x],[1],[r.width]]),g=new o([[r.x-c],[.75],[r.width/4]]),p=new o([[r.x+c],[1.25],[4*r.width]]),w=n.optimize(s,v,a,h,u,m,g,p,[],e);return[(w=w.p)[0],[w[1][0]*l],w[2]]}function u(t,r,e){var i=f(t,(e=e||{}).percentage||0);if(null===i||i[0].rows<3)return null;var a=i[0],s=i[1],l=i[2],u=[a.rows/Math.sqrt(s.dot(s))],c=(e=Object.create(e.LMOptions||[3,100,.001,.001,.001,.01,.01,11,9,1]),Math.abs(a[0][0]-a[1][0])),m=new o([[-c/1e4],[-.001],[-c/1e4]]),v=(m=new o([[-Math.abs(a[0][0]-a[1][0])/1e3],[-.001],[-r.width/1e3]]),new o([[r.x],[1],[r.width]])),g=new o([[r.x-c],[.75],[r.width/4]]),p=new o([[r.x+c],[1.25],[4*r.width]]),w=n.optimize(h,v,a,s,u,m,g,p,[],e);return[(w=w.p)[0],[w[1][0]*l],w[2]]}function f(t,r){var e,n,i,a=t.length,s=null,h=null,l=0;if(2==a){var u=t[0].length;if(s=new Array(u),h=new Array(u),e=t[0],n=t[1],"number"==typeof e[0])for(i=0;i<u;i++)s[i]=e[i],h[i]=n[i],n[i]>l&&(l=n[i]);else if("object"==typeof e[0])for(i=0;i<u;i++)s[i]=e[i][0],h[i]=n[i][0],n[i][0]>l&&(l=n[i][0])}else{u=a;for(s=new Array(u),h=new Array(u),i=0;i<u;i++)s[i]=t[i][0],h[i]=t[i][1],h[i]>l&&(l=h[i])}for(i=0;i<u;i++)h[i]/=l;if(r)for(i=u-1;i>=0;i--)h[i]<r&&(h.splice(i,1),s.splice(i,1));return s.length>0?[new o([s]).transpose(),new o([h]).transpose(),l]:null}t.exports.optimizeSingleLorentzian=l,t.exports.optimizeLorentzianSum=function(t,r,e){var s=f(t);if(null===s||s[0].rows<3)return null;var h,l=s[0],u=s[1],c=s[2],m=[l.rows/i.sqrt(u.dot(u))],v=(e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,1]),r.length),g=new o(3*v,1),p=new o(3*v,1),w=new o(3*v,1),d=new o(3*v,1),y=Math.abs(l[0][0]-l[1][0]);for(h=0;h<v;h++)g[h][0]=r[h].x,g[h+v][0]=1,g[h+2*v][0]=r[h].width,p[h][0]=r[h].x-y,p[h+v][0]=0,p[h+2*v][0]=r[h].width/4,w[h][0]=r[h].x+y,w[h+v][0]=1.5,w[h+2*v][0]=4*r[h].width,d[h][0]=-y/1e3,d[h+v][0]=-.001,d[h+2*v][0]=-y/1e3;d=-Math.abs(l[0][0]-l[1][0])/1e4;var x=n.optimize(a,g,l,u,m,d,p,w,[],e);x=x.p;var M=new Array(v);for(h=0;h<v;h++)M[h]=[x[h],[x[h+v][0]*c],x[h+2*v]];return M},t.exports.optimizeSingleGaussian=u,t.exports.optimizeGaussianSum=function(t,r,e){var s=f(t);if(null===s||s[0].rows<3)return null;var h,l=s[0],u=s[1],c=s[2],m=l.rows,v=new o(m,1),g=m/i.sqrt(u.dot(u));for(h=0;h<m;h++)v[h][0]=g;e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,2]);var p=r.length,w=new o(3*p,1),d=new o(3*p,1),y=new o(3*p,1),x=new o(3*p,1),M=Math.abs(l[0][0]-l[1][0]);for(h=0;h<p;h++)w[h][0]=r[h].x,w[h+p][0]=r[h].y/c,w[h+2*p][0]=r[h].width,d[h][0]=r[h].x-M,d[h+p][0]=.8*r[h].y/c,d[h+2*p][0]=r[h].width/2,y[h][0]=r[h].x+M,y[h+p][0]=1.2*r[h].y/c,y[h+2*p][0]=2*r[h].width,x[h][0]=-M/1e3,x[h+p][0]=-.001,x[h+2*p][0]=-M/1e3;var b=n.optimize(a,w,l,u,v,x,d,y,[],e);b=b.p;var A=new Array(p);for(h=0;h<p;h++)A[h]=[b[h],[b[h+p][0]*c],b[h+2*p]];return A},t.exports.singleGaussian=h,t.exports.singleLorentzian=s,t.exports.optimizeGaussianTrain=function(t,r,e){var n=f(t);if(null===n||n[0].rows<3)return null;for(var i,o,a,s,h=n[0],l=n[1],c=n[2],m=0,v=h.length,g=[],p=0;p<r.length;p++){for(i=r[p].x-1.5*r[p].width;h[m++]<i&&m<v;);for(i=r[p].x+1.5*r[p].width,o=[],a=[];h[m]<=i&&m<v;)o.push(h[m][0]),a.push(l[m][0]*c),m++;(s=u([o,a],r[p],e))?g.push({x:s[0][0],y:s[1][0],width:s[2][0],opt:!0}):g.push({x:r[p].x,y:r[p].y,width:r[p].width,opt:!1})}return g},t.exports.optimizeLorentzianTrain=function(t,r,e){var n=f(t);if(null===n||n[0].rows<3)return null;for(var i,o,a,s,h=n[0],u=n[1],c=n[2],m=0,v=h.length,g=[],p=0;p<r.length;p++){for(i=r[p].x-1.5*r[p].width;h[m++]<i&&m<v;);for(i=r[p].x+1.5*r[p].width,o=[],a=[];h[m]<=i&&m<v;)o.push(h[m][0]),a.push(u[m][0]*c),m++;(s=l([o,a],r[p],e))?g.push({x:s[0][0],y:s[1][0],width:s[2][0],opt:!0}):g.push({x:r[p].x,y:r[p].y,width:r[p].width,opt:!1})}return g}},function(module,exports,__webpack_require__){"use strict";module.exports=abstractMatrix;var LuDecomposition=__webpack_require__(9),SvDecomposition=__webpack_require__(10),arrayUtils=__webpack_require__(28),util=__webpack_require__(3),MatrixTransposeView=__webpack_require__(33),MatrixRowView=__webpack_require__(34),MatrixSubView=__webpack_require__(35),MatrixSelectionView=__webpack_require__(36),MatrixColumnView=__webpack_require__(37),MatrixFlipRowView=__webpack_require__(38),MatrixFlipColumnView=__webpack_require__(39);function abstractMatrix(superCtor){void 0===superCtor&&(superCtor=Object);class Matrix extends superCtor{static get[Symbol.species](){return this}static from1DArray(t,r,e){if(t*r!==e.length)throw new RangeError("Data length does not match given dimensions");for(var n=new this(t,r),i=0;i<t;i++)for(var o=0;o<r;o++)n.set(i,o,e[i*r+o]);return n}static rowVector(t){for(var r=new this(1,t.length),e=0;e<t.length;e++)r.set(0,e,t[e]);return r}static columnVector(t){for(var r=new this(t.length,1),e=0;e<t.length;e++)r.set(e,0,t[e]);return r}static empty(t,r){return new this(t,r)}static zeros(t,r){return this.empty(t,r).fill(0)}static ones(t,r){return this.empty(t,r).fill(1)}static rand(t,r,e){void 0===e&&(e=Math.random);for(var n=this.empty(t,r),i=0;i<t;i++)for(var o=0;o<r;o++)n.set(i,o,e());return n}static randInt(t,r,e,n){void 0===e&&(e=1e3),void 0===n&&(n=Math.random);for(var i=this.empty(t,r),o=0;o<t;o++)for(var a=0;a<r;a++){var s=Math.floor(n()*e);i.set(o,a,s)}return i}static eye(t,r,e){void 0===r&&(r=t),void 0===e&&(e=1);for(var n=Math.min(t,r),i=this.zeros(t,r),o=0;o<n;o++)i.set(o,o,e);return i}static diag(t,r,e){var n=t.length;void 0===r&&(r=n),void 0===e&&(e=r);for(var i=Math.min(n,r,e),o=this.zeros(r,e),a=0;a<i;a++)o.set(a,a,t[a]);return o}static min(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);for(var e=t.rows,n=t.columns,i=new this(e,n),o=0;o<e;o++)for(var a=0;a<n;a++)i.set(o,a,Math.min(t.get(o,a),r.get(o,a)));return i}static max(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);for(var e=t.rows,n=t.columns,i=new this(e,n),o=0;o<e;o++)for(var a=0;a<n;a++)i.set(o,a,Math.max(t.get(o,a),r.get(o,a)));return i}static checkMatrix(t){return Matrix.isMatrix(t)?t:new this(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(var r=this.rows,e=this.columns,n=0;n<r;n++)for(var i=0;i<e;i++)t.call(this,n,i);return this}to1DArray(){for(var t=new Array(this.size),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t[r*this.columns+e]=this.get(r,e);return t}to2DArray(){for(var t=new Array(this.rows),r=0;r<this.rows;r++){t[r]=new Array(this.columns);for(var e=0;e<this.columns;e++)t[r][e]=this.get(r,e)}return t}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(var t=0;t<this.rows;t++)for(var r=0;r<=t;r++)if(this.get(t,r)!==this.get(r,t))return!1;return!0}return!1}set(t,r,e){throw new Error("set method is unimplemented")}get(t,r){throw new Error("get method is unimplemented")}repeat(t,r){t=t||1,r=r||1;for(var e=new this.constructor[Symbol.species](this.rows*t,this.columns*r),n=0;n<t;n++)for(var i=0;i<r;i++)e.setSubMatrix(this,this.rows*n,this.columns*i);return e}fill(t){for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,t);return this}neg(){return this.mulS(-1)}getRow(t){util.checkRowIndex(this,t);for(var r=new Array(this.columns),e=0;e<this.columns;e++)r[e]=this.get(t,e);return r}getRowVector(t){return this.constructor.rowVector(this.getRow(t))}setRow(t,r){util.checkRowIndex(this,t),r=util.checkRowVector(this,r);for(var e=0;e<this.columns;e++)this.set(t,e,r[e]);return this}swapRows(t,r){util.checkRowIndex(this,t),util.checkRowIndex(this,r);for(var e=0;e<this.columns;e++){var n=this.get(t,e);this.set(t,e,this.get(r,e)),this.set(r,e,n)}return this}getColumn(t){util.checkColumnIndex(this,t);for(var r=new Array(this.rows),e=0;e<this.rows;e++)r[e]=this.get(e,t);return r}getColumnVector(t){return this.constructor.columnVector(this.getColumn(t))}setColumn(t,r){util.checkColumnIndex(this,t),r=util.checkColumnVector(this,r);for(var e=0;e<this.rows;e++)this.set(e,t,r[e]);return this}swapColumns(t,r){util.checkColumnIndex(this,t),util.checkColumnIndex(this,r);for(var e=0;e<this.rows;e++){var n=this.get(e,t);this.set(e,t,this.get(e,r)),this.set(e,r,n)}return this}addRowVector(t){t=util.checkRowVector(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)+t[e]);return this}subRowVector(t){t=util.checkRowVector(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)-t[e]);return this}mulRowVector(t){t=util.checkRowVector(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)*t[e]);return this}divRowVector(t){t=util.checkRowVector(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)/t[e]);return this}addColumnVector(t){t=util.checkColumnVector(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)+t[r]);return this}subColumnVector(t){t=util.checkColumnVector(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)-t[r]);return this}mulColumnVector(t){t=util.checkColumnVector(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)*t[r]);return this}divColumnVector(t){t=util.checkColumnVector(this,t);for(var r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)/t[r]);return this}mulRow(t,r){util.checkRowIndex(this,t);for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)*r);return this}mulColumn(t,r){util.checkColumnIndex(this,t);for(var e=0;e<this.rows;e++)this.set(e,t,this.get(e,t)*r);return this}max(){for(var t=this.get(0,0),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.get(r,e)>t&&(t=this.get(r,e));return t}maxIndex(){for(var t=this.get(0,0),r=[0,0],e=0;e<this.rows;e++)for(var n=0;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n),r[0]=e,r[1]=n);return r}min(){for(var t=this.get(0,0),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)this.get(r,e)<t&&(t=this.get(r,e));return t}minIndex(){for(var t=this.get(0,0),r=[0,0],e=0;e<this.rows;e++)for(var n=0;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n),r[0]=e,r[1]=n);return r}maxRow(t){util.checkRowIndex(this,t);for(var r=this.get(t,0),e=1;e<this.columns;e++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxRowIndex(t){util.checkRowIndex(this,t);for(var r=this.get(t,0),e=[t,0],n=1;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n),e[1]=n);return e}minRow(t){util.checkRowIndex(this,t);for(var r=this.get(t,0),e=1;e<this.columns;e++)this.get(t,e)<r&&(r=this.get(t,e));return r}minRowIndex(t){util.checkRowIndex(this,t);for(var r=this.get(t,0),e=[t,0],n=1;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n),e[1]=n);return e}maxColumn(t){util.checkColumnIndex(this,t);for(var r=this.get(0,t),e=1;e<this.rows;e++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxColumnIndex(t){util.checkColumnIndex(this,t);for(var r=this.get(0,t),e=[0,t],n=1;n<this.rows;n++)this.get(n,t)>r&&(r=this.get(n,t),e[0]=n);return e}minColumn(t){util.checkColumnIndex(this,t);for(var r=this.get(0,t),e=1;e<this.rows;e++)this.get(e,t)<r&&(r=this.get(e,t));return r}minColumnIndex(t){util.checkColumnIndex(this,t);for(var r=this.get(0,t),e=[0,t],n=1;n<this.rows;n++)this.get(n,t)<r&&(r=this.get(n,t),e[0]=n);return e}diag(){for(var t=Math.min(this.rows,this.columns),r=new Array(t),e=0;e<t;e++)r[e]=this.get(e,e);return r}sum(t){switch(t){case"row":return util.sumByRow(this);case"column":return util.sumByColumn(this);default:return util.sumAll(this)}}mean(){return this.sum()/this.size}prod(){for(var t=1,r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t*=this.get(r,e);return t}cumulativeSum(){for(var t=0,r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t+=this.get(r,e),this.set(r,e,t);return this}dot(t){Matrix.isMatrix(t)&&(t=t.to1DArray());var r=this.to1DArray();if(r.length!==t.length)throw new RangeError("vectors do not have the same size");for(var e=0,n=0;n<r.length;n++)e+=r[n]*t[n];return e}mmul(t){t=this.constructor.checkMatrix(t),this.columns!==t.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");for(var r=this.rows,e=this.columns,n=t.columns,i=new this.constructor[Symbol.species](r,n),o=new Array(e),a=0;a<n;a++){for(var s=0;s<e;s++)o[s]=t.get(s,a);for(var h=0;h<r;h++){var l=0;for(s=0;s<e;s++)l+=this.get(h,s)*o[s];i.set(h,a,l)}}return i}strassen2x2(t){var r=new this.constructor[Symbol.species](2,2);const e=this.get(0,0),n=t.get(0,0),i=this.get(0,1),o=t.get(0,1),a=this.get(1,0),s=t.get(1,0),h=this.get(1,1),l=t.get(1,1),u=(e+h)*(n+l),f=(a+h)*n,c=e*(o-l),m=h*(s-n),v=(e+i)*l,g=u+m-v+(i-h)*(s+l),p=c+v,w=f+m,d=u-f+c+(a-e)*(n+o);return r.set(0,0,g),r.set(0,1,p),r.set(1,0,w),r.set(1,1,d),r}strassen3x3(t){var r=new this.constructor[Symbol.species](3,3);const e=this.get(0,0),n=this.get(0,1),i=this.get(0,2),o=this.get(1,0),a=this.get(1,1),s=this.get(1,2),h=this.get(2,0),l=this.get(2,1),u=this.get(2,2),f=t.get(0,0),c=t.get(0,1),m=t.get(0,2),v=t.get(1,0),g=t.get(1,1),p=t.get(1,2),w=t.get(2,0),d=t.get(2,1),y=t.get(2,2),x=(e-o)*(-c+g),M=(-e+o+a)*(f-c+g),b=(o+a)*(-f+c),A=e*f,S=(-e+h+l)*(f-m+p),k=(-e+h)*(m-p),R=(h+l)*(-f+m),E=(-i+l+u)*(g+w-d),V=(i-u)*(g-d),C=i*w,_=(l+u)*(-w+d),O=(-i+a+s)*(p+w-y),T=(i-s)*(p-y),F=(a+s)*(-w+y),z=A+C+n*v,D=(e+n+i-o-a-l-u)*g+M+b+A+E+C+_,I=A+S+R+(e+n+i-a-s-h-l)*p+C+O+F,q=x+a*(-f+c+v-g-p-w+y)+M+A+C+O+T,j=x+M+b+A+s*d,N=C+O+T+F+o*m,L=A+S+k+l*(-f+m+v-g-p-w+d)+E+V+C,X=E+V+C+_+h*c,P=A+S+k+R+u*y;return r.set(0,0,z),r.set(0,1,D),r.set(0,2,I),r.set(1,0,q),r.set(1,1,j),r.set(1,2,N),r.set(2,0,L),r.set(2,1,X),r.set(2,2,P),r}mmulStrassen(t){var r=this.clone(),e=r.rows,n=r.columns,i=t.rows,o=t.columns;function a(t,r,e){var n=t.rows,i=t.columns;if(n===r&&i===e)return t;var o=Matrix.zeros(r,e);return o=o.setSubMatrix(t,0,0)}n!==i&&console.warn("Multiplying ".concat(e," x ").concat(n," and ").concat(i," x ").concat(o," matrix: dimensions do not match."));var s=Math.max(e,i),h=Math.max(n,o);return function t(r,e,n,i){if(n<=512||i<=512)return r.mmul(e);n%2==1&&i%2==1?(r=a(r,n+1,i+1),e=a(e,n+1,i+1)):n%2==1?(r=a(r,n+1,i),e=a(e,n+1,i)):i%2==1&&(r=a(r,n,i+1),e=a(e,n,i+1));var o=parseInt(r.rows/2),s=parseInt(r.columns/2),h=r.subMatrix(0,o-1,0,s-1),l=e.subMatrix(0,o-1,0,s-1),u=r.subMatrix(0,o-1,s,r.columns-1),f=e.subMatrix(0,o-1,s,e.columns-1),c=r.subMatrix(o,r.rows-1,0,s-1),m=e.subMatrix(o,e.rows-1,0,s-1),v=r.subMatrix(o,r.rows-1,s,r.columns-1),g=e.subMatrix(o,e.rows-1,s,e.columns-1),p=t(Matrix.add(h,v),Matrix.add(l,g),o,s),w=t(Matrix.add(c,v),l,o,s),d=t(h,Matrix.sub(f,g),o,s),y=t(v,Matrix.sub(m,l),o,s),x=t(Matrix.add(h,u),g,o,s),M=t(Matrix.sub(c,h),Matrix.add(l,f),o,s),b=t(Matrix.sub(u,v),Matrix.add(m,g),o,s),A=Matrix.add(p,y);A.sub(x),A.add(b);var S=Matrix.add(d,x),k=Matrix.add(w,y),R=Matrix.sub(p,w);R.add(d),R.add(M);var E=Matrix.zeros(2*A.rows,2*A.columns);return(E=(E=(E=(E=E.setSubMatrix(A,0,0)).setSubMatrix(S,A.rows,0)).setSubMatrix(k,0,A.columns)).setSubMatrix(R,A.rows,A.columns)).subMatrix(0,n-1,0,i-1)}(r=a(r,s,h),t=a(t,s,h),s,h)}scaleRows(t,r){if((t=void 0===t?0:t)>=(r=void 0===r?1:r))throw new RangeError("min should be strictly smaller than max");for(var e=this.constructor.empty(this.rows,this.columns),n=0;n<this.rows;n++){var i=arrayUtils.scale(this.getRow(n),{min:t,max:r});e.setRow(n,i)}return e}scaleColumns(t,r){if((t=void 0===t?0:t)>=(r=void 0===r?1:r))throw new RangeError("min should be strictly smaller than max");for(var e=this.constructor.empty(this.rows,this.columns),n=0;n<this.columns;n++){var i=arrayUtils.scale(this.getColumn(n),{min:t,max:r});e.setColumn(n,i)}return e}kroneckerProduct(t){t=this.constructor.checkMatrix(t);for(var r=this.rows,e=this.columns,n=t.rows,i=t.columns,o=new this.constructor[Symbol.species](r*n,e*i),a=0;a<r;a++)for(var s=0;s<e;s++)for(var h=0;h<n;h++)for(var l=0;l<i;l++)o[n*a+h][i*s+l]=this.get(a,s)*t.get(h,l);return o}transpose(){for(var t=new this.constructor[Symbol.species](this.columns,this.rows),r=0;r<this.rows;r++)for(var e=0;e<this.columns;e++)t.set(e,r,this.get(r,e));return t}sortRows(t){void 0===t&&(t=compareNumbers);for(var r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(t));return this}sortColumns(t){void 0===t&&(t=compareNumbers);for(var r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(t));return this}subMatrix(t,r,e,n){util.checkRange(this,t,r,e,n);for(var i=new this.constructor[Symbol.species](r-t+1,n-e+1),o=t;o<=r;o++)for(var a=e;a<=n;a++)i[o-t][a-e]=this.get(o,a);return i}subMatrixRow(t,r,e){if(void 0===r&&(r=0),void 0===e&&(e=this.columns-1),r>e||r<0||r>=this.columns||e<0||e>=this.columns)throw new RangeError("Argument out of range");for(var n=new this.constructor[Symbol.species](t.length,e-r+1),i=0;i<t.length;i++)for(var o=r;o<=e;o++){if(t[i]<0||t[i]>=this.rows)throw new RangeError("Row index out of range: "+t[i]);n.set(i,o-r,this.get(t[i],o))}return n}subMatrixColumn(t,r,e){if(void 0===r&&(r=0),void 0===e&&(e=this.rows-1),r>e||r<0||r>=this.rows||e<0||e>=this.rows)throw new RangeError("Argument out of range");for(var n=new this.constructor[Symbol.species](e-r+1,t.length),i=0;i<t.length;i++)for(var o=r;o<=e;o++){if(t[i]<0||t[i]>=this.columns)throw new RangeError("Column index out of range: "+t[i]);n.set(o-r,i,this.get(o,t[i]))}return n}setSubMatrix(t,r,e){var n=r+(t=this.constructor.checkMatrix(t)).rows-1,i=e+t.columns-1;util.checkRange(this,r,n,e,i);for(var o=0;o<t.rows;o++)for(var a=0;a<t.columns;a++)this[r+o][e+a]=t.get(o,a);return this}selection(t,r){for(var e=util.checkIndices(this,t,r),n=new this.constructor[Symbol.species](t.length,r.length),i=0;i<e.row.length;i++)for(var o=e.row[i],a=0;a<e.column.length;a++){var s=e.column[a];n[i][a]=this.get(o,s)}return n}trace(){for(var t=Math.min(this.rows,this.columns),r=0,e=0;e<t;e++)r+=this.get(e,e);return r}transposeView(){return new MatrixTransposeView(this)}rowView(t){return util.checkRowIndex(this,t),new MatrixRowView(this,t)}columnView(t){return util.checkColumnIndex(this,t),new MatrixColumnView(this,t)}flipRowView(){return new MatrixFlipRowView(this)}flipColumnView(){return new MatrixFlipColumnView(this)}subMatrixView(t,r,e,n){return new MatrixSubView(this,t,r,e,n)}selectionView(t,r){return new MatrixSelectionView(this,t,r)}det(){var t,r,e,n,i,o;if(this.isSquare())return 2===this.columns?(t=this.get(0,0),r=this.get(0,1),e=this.get(1,0),t*this.get(1,1)-r*e):3===this.columns?(n=this.selectionView([1,2],[1,2]),i=this.selectionView([1,2],[0,2]),o=this.selectionView([1,2],[0,1]),t=this.get(0,0),r=this.get(0,1),e=this.get(0,2),t*n.det()-r*i.det()+e*o.det()):new LuDecomposition(this).determinant;throw Error("Determinant can only be calculated for a square matrix.")}pseudoInverse(t){void 0===t&&(t=Number.EPSILON);for(var r=new SvDecomposition(this,{autoTranspose:!0}),e=r.leftSingularVectors,n=r.rightSingularVectors,i=r.diagonal,o=0;o<i.length;o++)Math.abs(i[o])>t?i[o]=1/i[o]:i[o]=0;return i=this.constructor[Symbol.species].diag(i),n.mmul(i.mmul(e.transposeView()))}}function checkDimensions(t,r){if(t.rows!==r.rows||t.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal")}function compareNumbers(t,r){return t-r}Matrix.prototype.klass="Matrix",Matrix.random=Matrix.rand,Matrix.diagonal=Matrix.diag,Matrix.prototype.diagonal=Matrix.prototype.diag,Matrix.identity=Matrix.eye,Matrix.prototype.negate=Matrix.prototype.neg,Matrix.prototype.tensorProduct=Matrix.prototype.kroneckerProduct,Matrix.prototype.determinant=Matrix.prototype.det;var inplaceOperator="\n(function %name%(value) {\n    if (typeof value === 'number') return this.%name%S(value);\n    return this.%name%M(value);\n})\n",inplaceOperatorScalar="\n(function %name%S(value) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, this.get(i, j) %op% value);\n        }\n    }\n    return this;\n})\n",inplaceOperatorMatrix="\n(function %name%M(matrix) {\n    matrix = this.constructor.checkMatrix(matrix);\n    checkDimensions(this, matrix);\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));\n        }\n    }\n    return this;\n})\n",staticOperator="\n(function %name%(matrix, value) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(value);\n})\n",inplaceMethod="\n(function %name%() {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j)));\n        }\n    }\n    return this;\n})\n",staticMethod="\n(function %name%(matrix) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%();\n})\n",inplaceMethodWithArgs="\n(function %name%(%args%) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), %args%));\n        }\n    }\n    return this;\n})\n",staticMethodWithArgs="\n(function %name%(matrix, %args%) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(%args%);\n})\n",inplaceMethodWithOneArgScalar="\n(function %name%S(value) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), value));\n        }\n    }\n    return this;\n})\n",inplaceMethodWithOneArgMatrix="\n(function %name%M(matrix) {\n    matrix = this.constructor.checkMatrix(matrix);\n    checkDimensions(this, matrix);\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));\n        }\n    }\n    return this;\n})\n",inplaceMethodWithOneArg="\n(function %name%(value) {\n    if (typeof value === 'number') return this.%name%S(value);\n    return this.%name%M(value);\n})\n",staticMethodWithOneArg=staticMethodWithArgs,operators=[["+","add"],["-","sub","subtract"],["*","mul","multiply"],["/","div","divide"],["%","mod","modulus"],["&","and"],["|","or"],["^","xor"],["<<","leftShift"],[">>","signPropagatingRightShift"],[">>>","rightShift","zeroFillRightShift"]],i;for(var operator of operators){var inplaceOp=eval(fillTemplateFunction(inplaceOperator,{name:operator[1],op:operator[0]})),inplaceOpS=eval(fillTemplateFunction(inplaceOperatorScalar,{name:operator[1]+"S",op:operator[0]})),inplaceOpM=eval(fillTemplateFunction(inplaceOperatorMatrix,{name:operator[1]+"M",op:operator[0]})),staticOp=eval(fillTemplateFunction(staticOperator,{name:operator[1]}));for(i=1;i<operator.length;i++)Matrix.prototype[operator[i]]=inplaceOp,Matrix.prototype[operator[i]+"S"]=inplaceOpS,Matrix.prototype[operator[i]+"M"]=inplaceOpM,Matrix[operator[i]]=staticOp}var methods=[["~","not"]];for(var method of(["abs","acos","acosh","asin","asinh","atan","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","log","log1p","log10","log2","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].forEach(function(t){methods.push(["Math."+t,t])}),methods)){var inplaceMeth=eval(fillTemplateFunction(inplaceMethod,{name:method[1],method:method[0]})),staticMeth=eval(fillTemplateFunction(staticMethod,{name:method[1]}));for(i=1;i<method.length;i++)Matrix.prototype[method[i]]=inplaceMeth,Matrix[method[i]]=staticMeth}var methodsWithArgs=[["Math.pow",1,"pow"]];for(var methodWithArg of methodsWithArgs){var args="arg0";for(i=1;i<methodWithArg[1];i++)args+=", arg".concat(i);if(1!==methodWithArg[1]){var inplaceMethWithArgs=eval(fillTemplateFunction(inplaceMethodWithArgs,{name:methodWithArg[2],method:methodWithArg[0],args:args})),staticMethWithArgs=eval(fillTemplateFunction(staticMethodWithArgs,{name:methodWithArg[2],args:args}));for(i=2;i<methodWithArg.length;i++)Matrix.prototype[methodWithArg[i]]=inplaceMethWithArgs,Matrix[methodWithArg[i]]=staticMethWithArgs}else{var tmplVar={name:methodWithArg[2],args:args,method:methodWithArg[0]},inplaceMethod2=eval(fillTemplateFunction(inplaceMethodWithOneArg,tmplVar)),inplaceMethodS=eval(fillTemplateFunction(inplaceMethodWithOneArgScalar,tmplVar)),inplaceMethodM=eval(fillTemplateFunction(inplaceMethodWithOneArgMatrix,tmplVar)),staticMethod2=eval(fillTemplateFunction(staticMethodWithOneArg,tmplVar));for(i=2;i<methodWithArg.length;i++)Matrix.prototype[methodWithArg[i]]=inplaceMethod2,Matrix.prototype[methodWithArg[i]+"M"]=inplaceMethodM,Matrix.prototype[methodWithArg[i]+"S"]=inplaceMethodS,Matrix[methodWithArg[i]]=staticMethod2}}function fillTemplateFunction(t,r){for(var e in r)t=t.replace(new RegExp("%"+e+"%","g"),r[e]);return t}return Matrix}},function(t,r,e){"use strict";var n=e(0);function i(t){if(!(this instanceof i))return new i(t);var r,e,o,a,s,h,l,u,f,c,m=(t=n.Matrix.checkMatrix(t)).clone(),v=m.rows,g=m.columns,p=new Array(v),w=1;for(r=0;r<v;r++)p[r]=r;for(f=new Array(v),e=0;e<g;e++){for(r=0;r<v;r++)f[r]=m[r][e];for(r=0;r<v;r++){for(u=m[r],c=Math.min(r,e),s=0,o=0;o<c;o++)s+=u[o]*f[o];u[e]=f[r]-=s}for(a=e,r=e+1;r<v;r++)Math.abs(f[r])>Math.abs(f[a])&&(a=r);if(a!==e){for(o=0;o<g;o++)h=m[a][o],m[a][o]=m[e][o],m[e][o]=h;l=p[a],p[a]=p[e],p[e]=l,w=-w}if(e<v&&0!==m[e][e])for(r=e+1;r<v;r++)m[r][e]/=m[e][e]}this.LU=m,this.pivotVector=p,this.pivotSign=w}i.prototype={isSingular:function(){for(var t=this.LU,r=t.columns,e=0;e<r;e++)if(0===t[e][e])return!0;return!1},get determinant(){var t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");for(var r=this.pivotSign,e=t.columns,n=0;n<e;n++)r*=t[n][n];return r},get lowerTriangularMatrix(){for(var t=this.LU,r=t.rows,e=t.columns,i=new n.Matrix(r,e),o=0;o<r;o++)for(var a=0;a<e;a++)i[o][a]=o>a?t[o][a]:o===a?1:0;return i},get upperTriangularMatrix(){for(var t=this.LU,r=t.rows,e=t.columns,i=new n.Matrix(r,e),o=0;o<r;o++)for(var a=0;a<e;a++)i[o][a]=o<=a?t[o][a]:0;return i},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(t){t=n.Matrix.checkMatrix(t);var r=this.LU;if(r.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var e,i,o,a=t.columns,s=t.subMatrixRow(this.pivotVector,0,a-1),h=r.columns;for(o=0;o<h;o++)for(e=o+1;e<h;e++)for(i=0;i<a;i++)s[e][i]-=s[o][i]*r[e][o];for(o=h-1;o>=0;o--){for(i=0;i<a;i++)s[o][i]/=r[o][o];for(e=0;e<o;e++)for(i=0;i<a;i++)s[e][i]-=s[o][i]*r[e][o]}return s}},t.exports=i},function(t,r,e){"use strict";var n=e(0),i=e(5),o=i.hypotenuse,a=i.getFilled2DArray;function s(t,r){if(!(this instanceof s))return new s(t,r);r=r||{};var e=(t=n.Matrix.checkMatrix(t)).rows,i=t.columns,h=Math.min(e,i),l=!0,u=!0;!1===r.computeLeftSingularVectors&&(l=!1),!1===r.computeRightSingularVectors&&(u=!1);var f,c=!0===r.autoTranspose,m=!1;if(e<i)if(c){e=(f=t.transpose()).rows,i=f.columns,m=!0;var v=l;l=u,u=v}else f=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else f=t.clone();var g,p,w,d,y,x,M,b,A,S,k,R,E,V,C,_,O,T,F,z,D,I=new Array(Math.min(e+1,i)),q=a(e,h,0),j=a(i,i,0),N=new Array(i),L=new Array(e),X=Math.min(e-1,i),P=Math.max(0,Math.min(i-2,e));for(w=0,S=Math.max(X,P);w<S;w++){if(w<X){for(I[w]=0,g=w;g<e;g++)I[w]=o(I[w],f[g][w]);if(0!==I[w]){for(f[w][w]<0&&(I[w]=-I[w]),g=w;g<e;g++)f[g][w]/=I[w];f[w][w]+=1}I[w]=-I[w]}for(p=w+1;p<i;p++){if(w<X&&0!==I[w]){for(y=0,g=w;g<e;g++)y+=f[g][w]*f[g][p];for(y=-y/f[w][w],g=w;g<e;g++)f[g][p]+=y*f[g][w]}N[p]=f[w][p]}if(l&&w<X)for(g=w;g<e;g++)q[g][w]=f[g][w];if(w<P){for(N[w]=0,g=w+1;g<i;g++)N[w]=o(N[w],N[g]);if(0!==N[w]){for(N[w+1]<0&&(N[w]=0-N[w]),g=w+1;g<i;g++)N[g]/=N[w];N[w+1]+=1}if(N[w]=-N[w],w+1<e&&0!==N[w]){for(g=w+1;g<e;g++)L[g]=0;for(p=w+1;p<i;p++)for(g=w+1;g<e;g++)L[g]+=N[p]*f[g][p];for(p=w+1;p<i;p++)for(y=-N[p]/N[w+1],g=w+1;g<e;g++)f[g][p]+=y*L[g]}if(u)for(g=w+1;g<i;g++)j[g][w]=N[g]}}if(d=Math.min(i,e+1),X<i&&(I[X]=f[X][X]),e<d&&(I[d-1]=0),P+1<d&&(N[P]=f[P][d-1]),N[d-1]=0,l){for(p=X;p<h;p++){for(g=0;g<e;g++)q[g][p]=0;q[p][p]=1}for(w=X-1;w>=0;w--)if(0!==I[w]){for(p=w+1;p<h;p++){for(y=0,g=w;g<e;g++)y+=q[g][w]*q[g][p];for(y=-y/q[w][w],g=w;g<e;g++)q[g][p]+=y*q[g][w]}for(g=w;g<e;g++)q[g][w]=-q[g][w];for(q[w][w]=1+q[w][w],g=0;g<w-1;g++)q[g][w]=0}else{for(g=0;g<e;g++)q[g][w]=0;q[w][w]=1}}if(u)for(w=i-1;w>=0;w--){if(w<P&&0!==N[w])for(p=w+1;p<i;p++){for(y=0,g=w+1;g<i;g++)y+=j[g][w]*j[g][p];for(y=-y/j[w+1][w],g=w+1;g<i;g++)j[g][p]+=y*j[g][w]}for(g=0;g<i;g++)j[g][w]=0;j[w][w]=1}for(var W=d-1,U=Math.pow(2,-52);d>0;){for(w=d-2;w>=-1&&-1!==w;w--)if(Math.abs(N[w])<=U*(Math.abs(I[w])+Math.abs(I[w+1]))){N[w]=0;break}if(w===d-2)k=4;else{for(x=d-1;x>=w&&x!==w;x--)if(y=(x!==d?Math.abs(N[x]):0)+(x!==w+1?Math.abs(N[x-1]):0),Math.abs(I[x])<=U*y){I[x]=0;break}x===w?k=3:x===d-1?k=1:(k=2,w=x)}switch(w++,k){case 1:for(M=N[d-2],N[d-2]=0,p=d-2;p>=w;p--)if(y=o(I[p],M),b=I[p]/y,A=M/y,I[p]=y,p!==w&&(M=-A*N[p-1],N[p-1]=b*N[p-1]),u)for(g=0;g<i;g++)y=b*j[g][p]+A*j[g][d-1],j[g][d-1]=-A*j[g][p]+b*j[g][d-1],j[g][p]=y;break;case 2:for(M=N[w-1],N[w-1]=0,p=w;p<d;p++)if(y=o(I[p],M),b=I[p]/y,A=M/y,I[p]=y,M=-A*N[p],N[p]=b*N[p],l)for(g=0;g<e;g++)y=b*q[g][p]+A*q[g][w-1],q[g][w-1]=-A*q[g][p]+b*q[g][w-1],q[g][p]=y;break;case 3:for(R=Math.max(Math.max(Math.max(Math.max(Math.abs(I[d-1]),Math.abs(I[d-2])),Math.abs(N[d-2])),Math.abs(I[w])),Math.abs(N[w])),E=I[d-1]/R,V=I[d-2]/R,C=N[d-2]/R,_=I[w]/R,O=N[w]/R,F=E*C*(E*C),z=0,0===(T=((V+E)*(V-E)+C*C)/2)&&0===F||(z=Math.sqrt(T*T+F),T<0&&(z=-z),z=F/(T+z)),M=(_+E)*(_-E)+z,D=_*O,p=w;p<d-1;p++){if(b=M/(y=o(M,D)),A=D/y,p!==w&&(N[p-1]=y),M=b*I[p]+A*N[p],N[p]=b*N[p]-A*I[p],D=A*I[p+1],I[p+1]=b*I[p+1],u)for(g=0;g<i;g++)y=b*j[g][p]+A*j[g][p+1],j[g][p+1]=-A*j[g][p]+b*j[g][p+1],j[g][p]=y;if(b=M/(y=o(M,D)),A=D/y,I[p]=y,M=b*N[p]+A*I[p+1],I[p+1]=-A*N[p]+b*I[p+1],D=A*N[p+1],N[p+1]=b*N[p+1],l&&p<e-1)for(g=0;g<e;g++)y=b*q[g][p]+A*q[g][p+1],q[g][p+1]=-A*q[g][p]+b*q[g][p+1],q[g][p]=y}N[d-2]=M,1;break;case 4:if(I[w]<=0&&(I[w]=I[w]<0?-I[w]:0,u))for(g=0;g<=W;g++)j[g][w]=-j[g][w];for(;w<W&&!(I[w]>=I[w+1]);){if(y=I[w],I[w]=I[w+1],I[w+1]=y,u&&w<i-1)for(g=0;g<i;g++)y=j[g][w+1],j[g][w+1]=j[g][w],j[g][w]=y;if(l&&w<e-1)for(g=0;g<e;g++)y=q[g][w+1],q[g][w+1]=q[g][w],q[g][w]=y;w++}0,d--}}if(m){var Y=j;j=q,q=Y}this.m=e,this.n=i,this.s=I,this.U=q,this.V=j}s.prototype={get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var t=Math.pow(2,-52),r=Math.max(this.m,this.n)*this.s[0]*t,e=0,n=this.s,i=0,o=n.length;i<o;i++)n[i]>r&&e++;return e},get diagonal(){return this.s},get threshold(){return Math.pow(2,-52)/2*Math.max(this.m,this.n)*this.s[0]},get leftSingularVectors(){return n.Matrix.isMatrix(this.U)||(this.U=new n.Matrix(this.U)),this.U},get rightSingularVectors(){return n.Matrix.isMatrix(this.V)||(this.V=new n.Matrix(this.V)),this.V},get diagonalMatrix(){return n.Matrix.diag(this.s)},solve:function(t){var r,e=t,i=this.threshold,o=this.s.length,a=n.Matrix.zeros(o,o);for(r=0;r<o;r++)Math.abs(this.s[r])<=i?a[r][r]=0:a[r][r]=1/this.s[r];var s,h,l,u=this.U,f=this.rightSingularVectors,c=f.mmul(a),m=f.rows,v=u.length,g=n.Matrix.zeros(m,v);for(r=0;r<m;r++)for(s=0;s<v;s++){for(l=0,h=0;h<o;h++)l+=c[r][h]*u[s][h];g[r][s]=l}return g.mmul(e)},solveForDiagonal:function(t){return this.solve(n.Matrix.diag(t))},inverse:function(){var t,r,e=this.V,i=this.threshold,o=e.length,a=e[0].length,s=new n.Matrix(o,this.s.length);for(t=0;t<o;t++)for(r=0;r<a;r++)Math.abs(this.s[r])>i?s[t][r]=e[t][r]/this.s[r]:s[t][r]=0;var h,l,u=this.U,f=u.length,c=u[0].length,m=new n.Matrix(o,f);for(t=0;t<o;t++)for(r=0;r<f;r++){for(l=0,h=0;h<c;h++)l+=s[t][h]*u[r][h];m[t][r]=l}return m}},t.exports=s},function(t,r,e){"use strict";r.array=e(12),r.matrix=e(30)},function(t,r,e){"use strict";function n(t,r){return t-r}r.sum=function(t){for(var r=0,e=0;e<t.length;e++)r+=t[e];return r},r.max=function(t){for(var r=t[0],e=t.length,n=1;n<e;n++)t[n]>r&&(r=t[n]);return r},r.min=function(t){for(var r=t[0],e=t.length,n=1;n<e;n++)t[n]<r&&(r=t[n]);return r},r.minMax=function(t){for(var r=t[0],e=t[0],n=t.length,i=1;i<n;i++)t[i]<r&&(r=t[i]),t[i]>e&&(e=t[i]);return{min:r,max:e}},r.arithmeticMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++)r+=t[n];return r/e},r.mean=r.arithmeticMean,r.geometricMean=function(t){for(var r=1,e=t.length,n=0;n<e;n++)r*=t[n];return Math.pow(r,1/e)},r.logMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++)r+=Math.log(t[n]);return r/e},r.grandMean=function(t,r){for(var e=0,n=0,i=t.length,o=0;o<i;o++)e+=r[o]*t[o],n+=r[o];return e/n},r.truncatedMean=function(t,r,e){void 0===e&&(e=!1),e||(t=[].concat(t).sort(n));for(var i=t.length,o=Math.floor(i*r),a=0,s=o;s<i-o;s++)a+=t[s];return a/(i-2*o)},r.harmonicMean=function(t){for(var r=0,e=t.length,n=0;n<e;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");r+=1/t[n]}return e/r},r.contraHarmonicMean=function(t){for(var r=0,e=0,n=t.length,i=0;i<n;i++)r+=t[i]*t[i],e+=t[i];if(e<0)throw new RangeError("sum of values is negative");return r/e},r.median=function(t,r){void 0===r&&(r=!1),r||(t=[].concat(t).sort(n));var e=t.length,i=Math.floor(e/2);return e%2==0?.5*(t[i-1]+t[i]):t[i]},r.variance=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),i=0,o=t.length,a=0;a<o;a++){var s=t[a]-n;i+=s*s}return e?i/(o-1):i/o},r.standardDeviation=function(t,e){return Math.sqrt(r.variance(t,e))},r.standardError=function(t){return r.standardDeviation(t)/Math.sqrt(t.length)},r.robustMeanAndStdev=function(t){var r=0,e=t.length,i=0;for(i=0;i<e;i++)r+=t[i];r/=e;var o=new Array(e);for(i=0;i<e;i++)o[i]=Math.abs(t[i]-r);return o.sort(n),{mean:r,stdev:e%2==1?o[(e-1)/2]/.6745:.5*(o[e/2]+o[e/2-1])/.6745}},r.quartiles=function(t,e){void 0===e&&(e=!1),e||(t=[].concat(t).sort(n));var i=t.length/4;return{q1:t[Math.ceil(i)-1],q2:r.median(t,!0),q3:t[Math.ceil(3*i)-1]}},r.pooledStandardDeviation=function(t,e){return Math.sqrt(r.pooledVariance(t,e))},r.pooledVariance=function(t,e){void 0===e&&(e=!0);for(var n=0,i=0,o=t.length,a=0;a<o;a++){var s=t[a],h=r.variance(s);n+=(s.length-1)*h,i+=e?s.length-1:s.length}return n/i},r.mode=function(t){var r,e=t.length,n=new Array(e);for(r=0;r<e;r++)n[r]=0;var i=new Array(e),o=0;for(r=0;r<e;r++){var a=i.indexOf(t[r]);a>=0?n[a]++:(i[o]=t[r],n[o]=1,o++)}var s=0,h=0;for(r=0;r<o;r++)n[r]>s&&(s=n[r],h=r);return i[h]},r.covariance=function(t,e,n){void 0===n&&(n=!0);var i=r.mean(t),o=r.mean(e);if(t.length!==e.length)throw"Vectors do not have the same dimensions";for(var a=0,s=t.length,h=0;h<s;h++){a+=(t[h]-i)*(e[h]-o)}return n?a/(s-1):a/s},r.skewness=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),i=0,o=0,a=t.length,s=0;s<a;s++){var h=t[s]-n;i+=h*h,o+=h*h*h}var l=i/a,u=o/a/Math.pow(l,1.5);return e?Math.sqrt(a*(a-1))/(a-2)*u:u},r.kurtosis=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),i=t.length,o=0,a=0,s=0;s<i;s++){var h=t[s]-n;o+=h*h,a+=h*h*h*h}var l=o/i;if(e){var u=o/(i-1);return i*(i+1)/((i-1)*(i-2)*(i-3))*(a/(u*u))-3*((i-1)*(i-1)/((i-2)*(i-3)))}return a/i/(l*l)-3},r.entropy=function(t,r){void 0===r&&(r=0);for(var e=0,n=t.length,i=0;i<n;i++)e+=t[i]*Math.log(t[i]+r);return-e},r.weightedMean=function(t,r){for(var e=0,n=t.length,i=0;i<n;i++)e+=t[i]*r[i];return e},r.weightedStandardDeviation=function(t,e){return Math.sqrt(r.weightedVariance(t,e))},r.weightedVariance=function(t,e){for(var n=r.weightedMean(t,e),i=0,o=t.length,a=0,s=0,h=0;h<o;h++){var l=t[h]-n,u=e[h];i+=u*(l*l),s+=u,a+=u*u}return i*(s/(s*s-a))},r.center=function(t,e){void 0===e&&(e=!1);var n=t;e||(n=[].concat(t));for(var i=r.mean(n),o=n.length,a=0;a<o;a++)n[a]-=i},r.standardize=function(t,e,n){void 0===e&&(e=r.standardDeviation(t)),void 0===n&&(n=!1);for(var i=t.length,o=n?t:new Array(i),a=0;a<i;a++)o[a]=t[a]/e;return o},r.cumulativeSum=function(t){var r=t.length,e=new Array(r);e[0]=t[0];for(var n=1;n<r;n++)e[n]=e[n-1]+t[n];return e}},function(t,r,e){"use strict";var n=e(2);t.exports={transpose:function(t){return"number"==typeof t?t:t.clone().transpose()},add:function(t,r){return"number"==typeof t&&"number"==typeof r?t+r:"number"==typeof t?this.add(r,t):t.clone().add(r)},subtract:function(t,r){return"number"==typeof t&&"number"==typeof r?t-r:"number"==typeof t?this.subtract(r,t):t.clone().sub(r)},multiply:function(t,r){if("number"==typeof t&&"number"==typeof r)return t*r;if("number"==typeof t)return this.multiply(r,t);var e=t.clone();return"number"==typeof r?e.mul(r):e=e.mmul(r),1==e.rows&&1==e.columns?e[0][0]:e},dotMultiply:function(t,r){return t.clone().mul(r)},dotDivide:function(t,r){return t.clone().div(r)},diag:function(t){var r,e,i=null,o=t.rows,a=t.columns;if(void 0===a&&"object"==typeof t)if(t[0]&&t[0].length)for(o=t.length,a=t[0].length,e=Math.min(o,a),i=n.zeros(a,a),r=0;r<a;r++)i[r][r]=t[r][r];else for(a=t.length,i=n.zeros(a,a),r=0;r<a;r++)i[r][r]=t[r];if(1==o)for(i=n.zeros(a,a),r=0;r<a;r++)i[r][r]=t[0][r];else if(o>0&&a>0)for(e=Math.min(o,a),i=new Array(e),r=0;r<e;r++)i[r]=t[r][r];return i},min:function(t,r){if("number"==typeof t&&"number"==typeof r)return Math.min(t,r);for(var e=t.rows,i=t.columns,o=new n(e,i),a=0;a<e;a++)for(var s=0;s<i;s++)t[a][s]<r[a][s]?o[a][s]=t[a][s]:o[a][s]=r[a][s];return o},max:function(t,r){if("number"==typeof t&&"number"==typeof r)return Math.max(t,r);for(var e=t.rows,i=t.columns,o=new n(e,i),a=0;a<e;a++)for(var s=0;s<i;s++)t[a][s]>r[a][s]?o[a][s]=t[a][s]:o[a][s]=r[a][s];return o},solve:function(t,r){return t.solve(r)},inv:function(t){return"number"==typeof t?1/t:t.inverse()},sqrt:function(t){if("number"==typeof t)return Math.sqrt(t);for(var r=t.rows,e=t.columns,i=new n(r,e),o=0;o<r;o++)for(var a=0;a<e;a++)i[o][a]=Math.sqrt(t[o][a]);return i},exp:function(t){if("number"==typeof t)return Math.sqrt(t);for(var r=t.rows,e=t.columns,i=new n(r,e),o=0;o<r;o++)for(var a=0;a<e;a++)i[o][a]=Math.exp(t[o][a]);return i},dotPow:function(t,r){if("number"==typeof t)return Math.pow(t,r);for(var e=t.rows,i=t.columns,o=new n(e,i),a=0;a<e;a++)for(var s=0;s<i;s++)o[a][s]=Math.pow(t[a][s],r);return o},abs:function(t){if("number"==typeof t)return Math.abs(t);for(var r=t.rows,e=t.columns,i=new n(r,e),o=0;o<r;o++)for(var a=0;a<e;a++)i[o][a]=Math.abs(t[o][a]);return i},matrix:function(t,r){return new n(t,r)},ones:function(t,r){return n.ones(t,r)},zeros:function(t,r){return n.zeros(t,r)},random:function(t,r){return n.rand(t,r)},eye:function(t,r){return n.eye(t,r)}}},function(t,r,e){"use strict";t.exports=function(t,r){if(!(t.length<2)){for(var e=t[0],n=0,i=1;i<t.length;i++)e!==t[i]&&(n++,e=t[i],t[n]=t[i],i!==n&&(r[n]=0)),i!==n&&(r[n]+=r[i]);t.length=n+1,r.length=n+1}}},function(t,r,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e(16)),o=n(e(17)),a=e(18),s=e(46),h=n(e(47)),l=e(48);function u(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r.wavelength)throw new Error("addPeak: peak mush have wavelength property");const{wavelength:e,intensity:n}=r;for(let r of t.peaks)if(Number(r.wavelength)===e)return r;return t.peaks.push({wavelength:e,intensity:n,kind:f(n,t.minIntensity,t.maxIntensity)}),r}function f(t,r,e){var n=t/(e-r);return n<.33?"w":n<.66?"m":"S"}function c(t,r){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{range:n=0,optimize:i=!1}=e;let o=function(t,r){let e={intensity:t.intensity[0],wavelength:t.wavelength[0],index:0},n=Math.abs(r-e.wavelength);for(let i=1;i<t.wavelength.length;i++){let o=Math.abs(r-t.wavelength[i]);o<n&&(n=o,m(t,e,i))}return e}(t,r);return i?function(t,r){let e,n=r.index;for(;n!==e;)e=n,n>0&&t.intensity[n-1]>r.intensity?m(t,r,--n):n<t.wavelength.length-1&&t.intensity[n+1]>r.intensity&&m(t,r,++n)}(t,o):n&&function(t,r,e,n){for(let i=0;i<t.wavelength.length;i++)Math.abs(t.wavelength[i]-e)<=n&&t.intensity[i]>r.intensity&&m(t,r,i)}(t,o,r,n),u(t,o)}function m(t,r,e){r.index=e,r.wavelength=t.wavelength[e],r.intensity=t.intensity[e]}class v{constructor(t){this.wavelength=t.wavelength||[],this.intensity=t.intensity||[],this.peaks=[],function(t){t.wavelength.length>0&&(t.minWavelength=i(t.wavelength));t.wavelength.length>0&&(t.maxWavelength=o(t.wavelength));t.intensity.length>0&&(t.minIntensity=i(t.intensity));t.intensity.length>0&&(t.maxIntensity=o(t.intensity))}(this)}setPeaks(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.peaks=t}peakPicking(t){c(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}getData(){return{x:this.wavelength,y:this.intensity}}}v.prototype.getAnnotations=function(t){return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{fillColor:e="green",strokeColor:n="red",creationFct:i}=r,o=t.peaks;return o?o.map(t=>{var r={line:1,type:"rect",strokeColor:n,strokeWidth:0,fillColor:e};return i&&i(r,t),function(t,r){t.label=[{text:r.kind,size:"18px",anchor:"middle",color:"red",position:{x:r.wavelength,y:r.intensity,dy:"-15px"}}],t.position=[{x:r.wavelength,y:r.intensity,dy:"-10px",dx:"-1px"},{x:r.wavelength,y:r.intensity,dy:"-5px",dx:"1px"}]}(r,t),r}):[]}(this,t)},v.prototype.autoPeakPicking=function(t){return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{noiseLevel:e=.001,minMaxRatio:n=.05,fromWavelength:i=0,toWavelength:o=5e3,replaceExisting:s=!0}=r;let h=a.gsd(t.wavelength,t.intensity,{noiseLevel:e,minMaxRatio:n,realTopDetection:!0,maxCriteria:!0,smoothY:!1,sgOptions:{windowSize:7,polynomial:3}});if(h=h.filter(t=>t.x>=i&&t.x<=o),s)for(;t.peaks.length;)t.peaks.pop();t:for(let r of h){for(let e of t.peaks)if(Number(e.wavelength)===Number(r.x))continue t;u(t,{wavelength:r.x,intensity:r.y})}}(this,t)},r.Spectrum=v,r.fromJcamp=function(t){let r=s.convert(t,{xy:!0}).spectra[0].data[0];return r=h(r),new v({wavelength:r.x,intensity:r.y})},r.fromText=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=Object.assign({},r,{arrayType:"xxyy"});const e=l.parseXY(t,r);let n=h({x:e[0],y:e[1]});return new v({wavelength:n.x,intensity:n.y})}},function(t,r,e){"use strict";e.r(r);var n=e(4),i=e.n(n);r.default=function(t){if(!i()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var r=t[0],e=1;e<t.length;e++)t[e]<r&&(r=t[e]);return r}},function(t,r,e){"use strict";e.r(r);var n=e(4),i=e.n(n);r.default=function(t){if(!i()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var r=t[0],e=1;e<t.length;e++)t[e]>r&&(r=t[e]);return r}},function(t,r,e){"use strict";t.exports.gsd=e(19),t.exports.post={optimizePeaks:e(24),joinBroadPeaks:e(44),broadenPeaks:e(45)}},function(t,r,e){"use strict";const n=e(20),i={sgOptions:{windowSize:9,polynomial:3},minMaxRatio:25e-5,broadRatio:0,maxCriteria:!0,smoothY:!0,realTopDetection:!1,heightFactor:0,boundaries:!1,derivativeThreshold:-1};t.exports=function(t,r,e){let o=(e=Object.assign({},i,e)).sgOptions;const a=[].concat(r);if(!("noiseLevel"in e)){var s,h=0,l=Number.MAX_VALUE;for(let r=0;r<t.length-1;++r)(s=Math.abs(t[r+1]-t[r]))<l&&(l=s),s>h&&(h=s);e.noiseLevel=(h-l)/h<.05?function(t){var r=0,e=0,n=t.length;for(let e=0;e<n;++e)r+=t[e];r/=n;var i=new Array(n);for(let e=0;e<n;++e)i[e]=Math.abs(t[e]-r);i.sort(),e=n%2==1?i[(n-1)/2]/.6745:.5*(i[n/2]+i[n/2-1])/.6745;return e}(a):0}const u={m:1,b:e.noiseLevel};e.maxCriteria||(u.m=-1,u.b*=-1);for(let t=0;t<a.length;t++)a[t]=u.m*a[t]-u.b;for(let t=0;t<a.length;t++)a[t]<0&&(a[t]=0);let f,c,m=a;(h-l)/h<.05?(e.smoothY&&(m=n(a,t[1]-t[0],{windowSize:o.windowSize,polynomial:o.polynomial,derivative:0})),f=n(a,t[1]-t[0],{windowSize:o.windowSize,polynomial:o.polynomial,derivative:1}),c=n(a,t[1]-t[0],{windowSize:o.windowSize,polynomial:o.polynomial,derivative:2})):(e.smoothY&&(m=n(a,t,{windowSize:o.windowSize,polynomial:o.polynomial,derivative:0})),f=n(a,t,{windowSize:o.windowSize,polynomial:o.polynomial,derivative:1}),c=n(a,t,{windowSize:o.windowSize,polynomial:o.polynomial,derivative:2}));const v=t,g=t[1]-t[0];var p=0,w=0;for(let t=0;t<m.length;t++)Math.abs(c[t])>p&&(p=Math.abs(c[t])),Math.abs(m[t])>w&&(w=Math.abs(m[t]));var d=null,y=null,x=new Array(m.length-2),M=new Array(m.length),b=new Array(m.length),A=new Array(m.length-2),S=0,k=0,R=0,E=0;for(let t=1;t<m.length-1;++t)Math.abs(f[t])>e.derivativeThreshold&&((f[t]<f[t-1]&&f[t]<=f[t+1]||f[t]<=f[t-1]&&f[t]<f[t+1])&&(y={x:v[t],index:t},g>0&&null!==d&&(M[k++]=d,b[R++]=y)),(f[t]>=f[t-1]&&f[t]>f[t+1]||f[t]>f[t-1]&&f[t]>=f[t+1])&&(d={x:v[t],index:t},g<0&&null!==y&&(M[k++]=d,b[R++]=y))),c[t]<c[t-1]&&c[t]<c[t+1]&&(x[S++]=t,A[E++]=Math.abs(c[t])<=e.broadRatio*p);x.length=S,M.length=k,b.length=R,A.length=E;let V,C,_,O,T,F=new Array(x.length),z=0,D=-1;for(let t=0;t<x.length;++t){C=v[x[t]],V=-1;let r=D+1;for(O=Number.MAX_VALUE,_=0,T=!0;-1===V&&r<M.length&&T;)(_=Math.abs(C-(M[r].x+b[r].x)/2))<O?O=_:T=!1,_<Math.abs(M[r].x-b[r].x)/2&&(V=r,D=r),++r;if(-1!==V&&Math.abs(m[x[t]])>e.minMaxRatio*w&&(F[z++]={index:x[t],x:C,y:(m[x[t]]+u.b)/u.m,width:Math.abs(b[V].x-M[V].x),soft:A[t]},e.boundaries&&(F[z-1].left=M[V],F[z-1].right=b[V]),e.heightFactor)){let t=m[M[V].index],r=m[b[V].index];F[z-1].height=e.heightFactor*(F[z-1].y-(t+r)/2)}}F.length=z,e.realTopDetection&&function(t,r,e){for(var n,i,o,a,s,h=0;h<t.length;h++)s=t[h].index,e[s-1]>=e[s-2]&&e[s-1]>=e[s]?s--:e[s+1]>=e[s]&&e[s+1]>=e[s+2]?s++:e[s-2]>=e[s-3]&&e[s-2]>=e[s-1]?s-=2:e[s+2]>=e[s+1]&&e[s+2]>=e[s+3]&&(s+=2),e[s-1]>0&&e[s+1]>0&&e[s]>=e[s-1]&&e[s]>=e[s+1]&&(n=20*Math.log10(e[s-1]),i=20*Math.log10(e[s]),o=20*Math.log10(e[s+1]),a=.5*(n-o)/(n-2*i+o),t[h].x=r[s]+(r[s]-r[s-1])*a,t[h].y=e[s]-.25*(e[s-1]-e[s+1])*a)}(F,v,m);for(let t=0;t<F.length;t++)F[t].base=e.noiseLevel;return F.sort(function(t,r){return t.x-r.x}),F}},function(t,r,e){var n=e(21),i=(e(22),{windowSize:9,derivative:0,polynomial:3});function o(t,r,e,n){for(var i=0,o=0,a=r-e;a<r+e;a++)a>=0&&a<t.length-1&&(i+=t[a+1]-t[a],o++);return Math.pow(i/o,n)}function a(t,r,e,n){return e>0?(4*e-2)/(e*(2*r-e+1))*(t*a(t,r,e-1,n)+n*a(t,r,e-1,n-1))-(e-1)*(2*r+e)/(e*(2*r-e+1))*a(t,r,e-2,n):0==e&&0==n?1:0}function s(t,r){var e=1;if(t>=r)for(var n=t-r+1;n<=t;n++)e*=n;return e}function h(t,r,e,n,i){for(var o=0,h=0;h<=n;h++)o+=(2*h+1)*(s(2*e,h)/s(2*e+h+1,h+1))*a(t,e,h,0)*a(r,e,h,i);return o}t.exports=function(t,r,e){if((e=n({},i,e)).windowSize%2==0||e.windowSize<5||!Number.isInteger(e.windowSize))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(e.windowSize>t.length)throw new RangeError("Window size is higher than the data length "+e.windowSize+">"+t.length);if(e.derivative<0||!Number.isInteger(e.derivative))throw new RangeError("Derivative should be a positive integer");if(e.polynomial<1||!Number.isInteger(e.polynomial))throw new RangeError("Polynomial should be a positive integer");e.polynomial>=6&&console.warn("You should not use polynomial grade higher than 5 if you are not sure that your data arises from such a model. Possible polynomial oscillation problems");var a=e.windowSize,s=Math.floor(a/2),l=t.length,u=new Array(l),f=function(t,r,e){for(var n=new Array(t),i=Math.floor(t/2),o=-i;o<=i;o++){n[o+i]=new Array(t);for(var a=-i;a<=i;a++)n[o+i][a+i]=h(a,o,i,r,e)}return n}(a,e.polynomial,e.derivative),c=0,m=!0;"[object Array]"===Object.prototype.toString.call(r)?m=!1:c=Math.pow(r,e.derivative);for(var v=0;v<s;v++){for(var g=f[s-v-1],p=f[s+v+1],w=0,d=0,y=0;y<a;y++)w+=g[y]*t[y],d+=p[y]*t[l-a+y-1];m?(u[s-v-1]=w/c,u[l-s+v]=d/c):(c=o(r,s-v-1,s,e.derivative),u[s-v-1]=w/c,c=o(r,l-s+v,s,e.derivative),u[l-s+v]=d/c)}var x=f[s];for(v=a;v<l+1;v++){var M=0;for(y=0;y<a;y++)M+=x[y]*t[y+v-a];m||(c=o(r,v-s-1,s,e.derivative)),u[v-s-1]=M/c}return u}},function(t,r,e){"use strict";var n=Object.prototype.hasOwnProperty,i=Object.prototype.toString,o=Object.defineProperty,a=Object.getOwnPropertyDescriptor,s=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===i.call(t)},h=function(t){if(!t||"[object Object]"!==i.call(t))return!1;var r,e=n.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&n.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!o)return!1;for(r in t);return void 0===r||n.call(t,r)},l=function(t,r){o&&"__proto__"===r.name?o(t,r.name,{enumerable:!0,configurable:!0,value:r.newValue,writable:!0}):t[r.name]=r.newValue},u=function(t,r){if("__proto__"===r){if(!n.call(t,r))return;if(a)return a(t,r).value}return t[r]};t.exports=function t(){var r,e,n,i,o,a,f=arguments[0],c=1,m=arguments.length,v=!1;for("boolean"==typeof f&&(v=f,f=arguments[1]||{},c=2),(null==f||"object"!=typeof f&&"function"!=typeof f)&&(f={});c<m;++c)if(null!=(r=arguments[c]))for(e in r)n=u(f,e),f!==(i=u(r,e))&&(v&&i&&(h(i)||(o=s(i)))?(o?(o=!1,a=n&&s(n)?n:[]):a=n&&h(n)?n:{},l(f,{name:e,newValue:t(v,a,i)})):void 0!==i&&l(f,{name:e,newValue:i}));return f}},function(t,r,e){"use strict";r.array=e(6),r.matrix=e(23)},function(t,r,e){"use strict";var n=e(6);function i(t,r){void 0===r&&(r=0);var e,n,i,o,a=t.length,s=t[0].length;if(-1===r){for(e=[0],n=a*s,i=0;i<a;i++)for(o=0;o<s;o++)e[0]+=t[i][o];e[0]/=n}else if(0===r)for(e=new Array(s),n=a,o=0;o<s;o++){for(e[o]=0,i=0;i<a;i++)e[o]+=t[i][o];e[o]/=n}else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(a),n=s,o=0;o<a;o++){for(e[o]=0,i=0;i<s;i++)e[o]+=t[o][i];e[o]/=n}}return e}function o(t,r,e){for(var n=a(t,r,e),i=n.length,o=0;o<i;o++)n[o]=Math.sqrt(n[o]);return n}function a(t,r,e){void 0===e&&(e=!0),r=r||i(t);var n=t.length;if(0===n)return[];for(var o=t[0].length,a=new Array(o),s=0;s<o;s++){for(var h=0,l=0,u=0,f=0;f<n;f++)h+=u=t[f][s]-r[s],l+=u*u;a[s]=e?(l-h*h/n)/(n-1):(l-h*h/n)/n}return a}function s(t,r,e){void 0===e&&(e=0),void 0===r&&(0===e?r=t.length-1:1===e&&(r=t[0].length-1));var n=i(t,e),o=t.length;if(0===o)return[[]];var a,s,h,l,u,f=t[0].length;if(0===e){for(a=new Array(f),s=0;s<f;s++)a[s]=new Array(f);for(s=0;s<f;s++)for(h=s;h<f;h++){for(l=0,u=0;u<o;u++)l+=(t[u][h]-n[h])*(t[u][s]-n[s]);l/=r,a[s][h]=l,a[h][s]=l}}else{if(1!==e)throw new Error("Invalid dimension");for(a=new Array(o),s=0;s<o;s++)a[s]=new Array(o);for(s=0;s<o;s++)for(h=s;h<o;h++){for(l=0,u=0;u<f;u++)l+=(t[h][u]-n[h])*(t[s][u]-n[s]);l/=r,a[s][h]=l,a[h][s]=l}}return a}function h(t,r,e){return r=r||i(t),void 0===e&&(e=o(t,!0,r)),u(l(t,r,!1),e,!0)}function l(t,r,e){r=r||i(t);var n,o,a,s=t,h=t.length;if(!e)for(s=new Array(h),n=0;n<h;n++)s[n]=new Array(t[n].length);for(n=0;n<h;n++){var l=s[n];for(o=0,a=l.length;o<a;o++)l[o]=t[n][o]-r[o]}return s}function u(t,r,e){void 0===r&&(r=o(t));var n,i,a,s=t,h=t.length;if(!e)for(s=new Array(h),n=0;n<h;n++)s[n]=new Array(t[n].length);for(n=0;n<h;n++){var l=s[n],u=t[n];for(i=0,a=l.length;i<a;i++)0===r[i]||isNaN(r[i])||(l[i]=u[i]/r[i])}return s}function f(t,r,e){void 0===e&&(e=0);var i=t.length;if(0===i)return[];var o,a,s,h,l,u,f=t[0].length;if(0===e){for(o=new Array(f),a=0;a<f;a++)o[a]=0;for(a=0;a<i;a++)for(u=t[a],l=r[a],h=0;h<f;h++)o[h]+=u[h]*l}else{if(1!==e)throw new Error("Invalid dimension");for(o=new Array(i),a=0;a<i;a++)o[a]=0;for(h=0;h<i;h++)for(u=t[h],l=r[h],a=0;a<f;a++)o[h]+=u[a]*l}var c=n.sum(r);if(0!==c)for(a=0,s=o.length;a<s;a++)o[a]/=c;return o}function c(t,r,e,n,i){i=i||0,e=e||f(t,r,i),void 0===n&&(n=1);var o=t.length;if(0===o)return[[]];var a,s,h,l,u,c=t[0].length;if(0===i){for(a=new Array(c),s=0;s<c;s++)a[s]=new Array(c);for(s=0;s<c;s++)for(h=s;h<c;h++){for(u=0,l=0;l<o;l++)u+=r[l]*(t[l][h]-e[h])*(t[l][s]-e[s]);a[s][h]=u*n,a[h][s]=u*n}}else{if(1!==i)throw new Error("Invalid dimension");for(a=new Array(o),s=0;s<o;s++)a[s]=new Array(o);for(s=0;s<o;s++)for(h=s;h<o;h++){for(u=0,l=0;l<c;l++)u+=r[l]*(t[h][l]-e[h])*(t[s][l]-e[s]);a[s][h]=u*n,a[h][s]=u*n}}return a}t.exports={entropy:function(t,r){void 0===r&&(r=0);for(var e=0,n=t.length,i=t[0].length,o=0;o<n;o++)for(var a=0;a<i;a++)e+=t[o][a]*Math.log(t[o][a]+r);return-e},mean:i,standardDeviation:o,variance:a,median:function(t){for(var r=t.length,e=t[0].length,n=new Array(e),i=0;i<e;i++){for(var o=new Array(r),a=0;a<r;a++)o[a]=t[a][i];o.sort();var s=o.length;n[i]=s%2==0?.5*(o[s/2]+o[s/2-1]):o[Math.floor(s/2)]}return n},mode:function(t){var r,e,n=t.length,i=t[0].length,o=new Array(i);for(r=0;r<i;r++){for(var a=new Array(n),s=0;s<n;s++)a[s]=0;var h=new Array(n),l=0;for(e=0;e<n;e++){var u=h.indexOf(t[e][r]);u>=0?a[u]++:(h[l]=t[e][r],a[l]=1,l++)}var f=0,c=0;for(e=0;e<l;e++)a[e]>f&&(f=a[e],c=e);o[r]=h[c]}return o},skewness:function(t,r){void 0===r&&(r=!0);for(var e=i(t),n=t.length,o=e.length,a=new Array(o),s=0;s<o;s++){for(var h=0,l=0,u=0;u<n;u++){var f=t[u][s]-e[s];h+=f*f,l+=f*f*f}var c=h/n,m=l/n/Math.pow(c,1.5);if(r){var v=Math.sqrt(n*(n-1)),g=n-2;a[s]=v/g*m}else a[s]=m}return a},kurtosis:function(t,r){void 0===r&&(r=!0);for(var e=i(t),n=t.length,o=t[0].length,a=new Array(o),s=0;s<o;s++){for(var h=0,l=0,u=0;u<n;u++){var f=t[u][s]-e[s];h+=f*f,l+=f*f*f*f}var c=h/n,m=l/n;if(r){var v=h/(n-1),g=n*(n+1)/((n-1)*(n-2)*(n-3)),p=l/(v*v),w=(n-1)*(n-1)/((n-2)*(n-3));a[s]=g*p-3*w}else a[s]=m/(c*c)-3}return a},standardError:function(t){for(var r=t.length,e=o(t),n=e.length,i=new Array(n),a=Math.sqrt(r),s=0;s<n;s++)i[s]=e[s]/a;return i},covariance:function(t,r){return s(t,void 0,r)},scatter:s,correlation:function(t){var r,e,n=i(t),a=h(t,n,o(t,!0,n)),s=t.length,l=t[0].length,u=new Array(l);for(r=0;r<l;r++)u[r]=new Array(l);for(r=0;r<l;r++)for(e=r;e<l;e++){for(var f=0,c=0,m=a.length;c<m;c++)f+=a[c][e]*a[c][r];f/=s-1,u[r][e]=f,u[e][r]=f}return u},zScores:h,center:l,standardize:u,weightedVariance:function(t,r){var e=i(t),n=t.length;if(0===n)return[];for(var o=t[0].length,a=new Array(o),s=0;s<o;s++){for(var h=0,l=0,u=0,f=0;f<n;f++){var c=t[f][s]-e[s],m=r[f];h+=m*(c*c),u+=m,l+=m*m}a[s]=h*(u/(u*u-l))}return a},weightedMean:f,weightedCovariance:function(t,r,e,n){n=n||0,e=e||f(t,r,n);for(var i=0,o=0,a=0,s=r.length;a<s;a++)i+=r[a],o+=r[a]*r[a];return c(t,r,e,i/(i*i-o),n)},weightedScatter:c}},function(t,r,e){"use strict";var n=e(7);function i(t,r,e,n,i){var o=e.length,a=[],s=[],h=Math.sign(e[1]-e[0]);-1===h&&(i[0]=e.length-1);for(var l=Math.abs(r-t)/2,u=(t+r)/2,f=!1,c=i[0];!f&&c<o&&c>=0;)Math.abs(e[c]-u)<=l?(a.push(e[c]),s.push(n[c]),c+=h):1===Math.sign(u-e[c])?c+=h:f=!0;return i[0]=c,[a,s]}t.exports=function(t,r,e,o,a){var s,h,l,u,f,c=[0],m=function(t,r){var e,n,i,o,a=[],s=[],h=[t[0].x,r*t[0].width];for(e=0;e<t.length;e++)Math.abs(t[e].x-h[0])<r*t[e].width+h[1]?(a.push(t[e]),i=h[0]+h[1],t[e].x+r*t[e].width>i&&(i=t[e].x+r*t[e].width),o=h[0]-h[1],t[e].x-r*t[e].width<o&&(o=t[e].x-r*t[e].width),h=[(i+o)/2,Math.abs(i-o)/2]):(s.push({limits:h,group:a}),a=[t[e]],h=[t[e].x,r*t[e].width]);for(s.push({limits:h,group:a}),e=s.length-2;e>=0;e--)if(Math.abs(s[e].limits[0]-s[e+1].limits[0])<(s[e].limits[1]+s[e+1].limits[1])/2){for(n=0;n<s[e+1].group.length;n++)s[e].group.push(s[e+1].group[n]);i=s[e].limits[0]+s[e].limits[1],s[e+1].limits[0]+s[e+1].limits[1]>i&&(i=s[e+1].limits[0]+s[e+1].limits[1]),o=s[e].limits[0]-s[e].limits[1],s[e+1].limits[0]-s[e+1].limits[1]<o&&(o=s[e+1].limits[0]-s[e+1].limits[1]),s[e].limits=[(i+o)/2,Math.abs(i-o)/2],s.splice(e+1,1)}return s}(t,o),v=[],g=1;for("gaussian"===a&&(g=1.17741),s=0;s<m.length;s++){var p=m[s].group;if(p.length>1){if((l=i(m[s].limits[0]-m[s].limits[1],m[s].limits[0]+m[s].limits[1],r,e,c))[0].length>5){f=[3,100,u=p[0].width/1e3,u,u,10*u,10*u,11,9,1];var w=[];for("gaussian"===a?w=n.optimizeGaussianSum(l,p,f):"lorentzian"===a&&(w=n.optimizeLorentzianSum(l,p,f)),h=0;h<w.length;h++)v.push({x:w[h][0][0],y:w[h][1][0],width:w[h][2][0]*g})}}else if((l=i((p=p[0]).x-o*p.width,p.x+o*p.width,r,e,c))[0].length>5){f=[3,100,u=p.width/1e3,u,u,10*u,10*u,11,9,1];var d=[];"gaussian"===a?d=n.optimizeSingleGaussian([l[0],l[1]],p,f):"lorentzian"===a&&(d=n.optimizeSingleLorentzian([l[0],l[1]],p,f)),v.push({x:d[0][0],y:d[1][0],width:d[2][0]*g})}}return v}},function(t,r,e){"use strict";t.exports=e(26),t.exports.Matrix=e(2),t.exports.Matrix.algebra=e(13)},function(t,r,e){var n=e(2),i=e(13),o={optimize:function(t,r,e,o,a,s,h,l,u,f){var c=0;if("object"!=typeof r[0])for(var m=0;m<r.length;m++)r[m]=[r[m]];var v=r.length,g=o.length,p=n.zeros(v,1),w=n.zeros(g,1),d=-2e-4,y=-2e-4,x=n.zeros(g,v);if(e.length==o.length){a=a||Math.sqrt((g-v+1)/i.multiply(i.transpose(o),o)),s=s||.001,h=h||i.multiply(Math.abs(r),-100),l=l||i.multiply(Math.abs(r),100),u=u||1;(f=f||[3,10*v,.001,.001,.001,.01,.01,11,9,1])[0];var M=f[1],b=f[2],A=(f[3],f[4],f[5]),S=f[6],k=f[7],R=f[8],E=f[9];if(!s.length||1==s.length){var V=new Array(v);for(m=0;m<v;m++)V[m]=[s];s=V}var C=[];for(m=0;m<s.length;m++)0!=s[m][0]&&C.push(m);var _=C.length,O=!1,T=null;if(!a.length||a.length<g){var F=i.multiply(n.ones(g,1),a[0]);T=i.dotMultiply(F,F)}else T=i.dotMultiply(a,a);var z=this.lm_matx(t,e,p,w,1,x,r,o,T,s,u),D=z.JtWJ,I=z.JtWdy,q=(d=z.Chi_sq,z.y_hat);x=z.J;switch(Math.max(Math.abs(I))<b&&(console.log(" *** Your Initial Guess is Extremely Close to Optimal ***"),console.log(" *** epsilon_1 = ",b),O=!0),E){case 1:lambda=S;break;default:lambda=S*Math.max(i.diag(D)),nu=2}y=d;for(var j=null;!O&&c<=M;){switch(c+=1,E){case 1:j=i.solve(i.add(D,i.multiply(i.diag(i.diag(D)),lambda)),I);break;default:j=i.solve(i.add(D,i.multiply(n.eye(v),lambda)),I)}var N=new Array(C.length);for(Y=0;Y<C.length;Y++)N[Y]=j[C[Y]];var L=i.add(r,N);for(Y=0;Y<L.length;Y++)L[Y][0]=Math.min(Math.max(h[Y][0],L[Y][0]),l[Y][0]);var X=i.subtract(o,t(e,L,u)),P=i.multiply(i.transpose(X),i.dotMultiply(X,T));if(2==E){var W=i.multiply(i.transpose(I),j),U=i.multiply(W,i.inv(i.add(i.multiply(i.subtract(P-d),.5)),i.multiply(W,2)));j=i.multiply(U,j);for(var Y=0;Y<C.length;Y++)N[Y]=j[C[Y]];L=i.add(r,N),L=i.min(i.max(h,L),l),X=i.subtract(o,t(e,L,u)),P=i.multiply(i.transpose(X),mat.dotMultiply(X,T))}var J=(d-P)/i.multiply(i.multiply(i.transpose(j),2),i.add(i.multiply(lambda,j),I));if(J>A)switch(dX2=d-y,y=d,p=r,w=q,r=L,D=(z=this.lm_matx(t,e,p,w,dX2,x,r,o,T,s,u)).JtWJ,I=z.JtWdy,d=z.Chi_sq,q=z.y_hat,x=z.J,E){case 1:lambda=Math.max(lambda/R,1e-7);break;case 2:lambda=Math.max(lambda/(1+U),1e-7);break;case 3:lambda=i.multiply(Math.max(1/3,1-(2*J-1)^3),lambda),nu=2}else switch(d=y,c%(2*v)==0&&(D=(z=this.lm_matx(t,e,p,w,-1,x,r,o,T,s,u)).JtWJ,I=z.JtWdy,dX2=z.Chi_sq,q=z.y_hat,x=z.J),E){case 1:lambda=Math.min(lambda*k,1e7);break;case 2:lambda+=Math.abs((P-d)/2/U);break;case 3:lambda*=nu,nu*=2}}return(T=i.multiply(i.multiply(i.transpose(X),X),n.ones(g,1))).apply(function(t,r){T[t][r]=(g-_+1)/T[t][r]}),D=(z=this.lm_matx(t,e,p,w,-1,x,r,o,T,s,u)).JtWJ,I=z.JtWdy,d=z.Chi_sq,q=z.y_hat,x=z.J,{p:r,X2:d}}console.log("lm.m error: the length of t must equal the length of y_dat"),length_t=e.length,length_y_dat=o.length;var d=0},lm_FD_J:function(t,r,e,o,a,s){var h=o.length,l=e.length;a=a||i.multiply(n.ones(l,1),.001);for(var u=e.clone(),f=new n(h,l),c=new Array(l),m=0;m<l;m++){if(c[m]=a[m]*(1+Math.abs(e[m][0])),e[m]=[u[m][0]+c[m]],0!=c[m])if(y1=t(r,e,s),a[m][0]<0)for(var v=i.dotDivide(i.subtract(y1,o),c[m]),g=0;g<h;g++)f[g][m]=v[g][0];else{e[m][0]=u[m][0]-c[m];for(v=i.dotDivide(i.subtract(y1,t(r,e,s)),2*c[m]),g=0;g<h;g++)f[g][m]=v[g][0]}e[m]=u[m]}return f},lm_Broyden_J:function(t,r,e,n,o){var a=i.subtract(n,t),s=i.transpose(a);return s.div(i.multiply(s,a)),e=i.add(e,i.multiply(i.subtract(o,i.add(r,i.multiply(e,a))),s))},lm_matx:function(t,r,e,o,a,s,h,l,u,f,c,m){l.length;var v=h.length;f=f||.001;var g=t(r,h,c);s=m%(2*v)==0||a>0?this.lm_FD_J(t,r,h,g,f,c):this.lm_Broyden_J(e,o,s,h,g);var p=i.subtract(l,g),w=i.multiply(i.transpose(p),i.dotMultiply(p,u)),d=i.transpose(s);return{JtWJ:i.multiply(d,i.dotMultiply(s,i.multiply(u,n.ones(1,v)))),JtWdy:i.multiply(d,i.dotMultiply(u,p)),Chi_sq:w,y_hat:g,J:s}}};t.exports=o},function(t,r,e){"use strict";Symbol.species||(Symbol.species=Symbol.for("@@species"))},function(t,r,e){t.exports=r=e(29),r.getEquallySpacedData=e(31).getEquallySpacedData,r.SNV=e(32).SNV},function(t,r,e){"use strict";const n=e(11).array;function i(t){for(var r=new Array(t[0].length),e=0;e<r.length;++e)r[e]=new Array(t.length);for(e=0;e<t.length;++e)for(var n=0;n<t[0].length;++n)r[n][e]=t[e][n];return r}t.exports={coordArrayToPoints:function(t,r){if(t.length%r!=0)throw new RangeError("Dimensions number must be accordance with the size of the array.");for(var e=t.length/r,n=new Array(e),i=0,o=0;o<t.length;o+=r){for(var a=new Array(r),s=0;s<r;++s)a[s]=t[o+s];n[i]=a,i++}return n},coordArrayToCoordMatrix:function(t,r){if(t.length%r!=0)throw new RangeError("Dimensions number must be accordance with the size of the array.");for(var e=new Array(r),n=t.length/r,i=0;i<e.length;i++)e[i]=new Array(n);for(i=0;i<t.length;i+=r)for(var o=0;o<r;++o){var a=Math.floor(i/r);e[o][a]=t[i+o]}return e},coordMatrixToCoordArray:function(t){for(var r=new Array(t.length*t[0].length),e=0,n=0;n<t[0].length;++n)for(var i=0;i<t.length;++i)r[e]=t[i][n],++e;return r},coordMatrixToPoints:i,pointsToCoordArray:function(t){for(var r=new Array(t.length*t[0].length),e=0,n=0;n<t.length;++n)for(var i=0;i<t[0].length;++i)r[e]=t[n][i],++e;return r},pointsToCoordMatrix:i,applyDotProduct:function(t,r){var e,n;t.length<=r.length?(n=t,e=r):(n=r,e=t);for(var i=e.length-n.length+1,o=new Array(i),a=0;a<i;++a){for(var s=0,h=0;h<n.length;++h)s+=n[h]*e[a+h];o[a]=s}return o},scale:function(t,r){var e;e=r.inPlace?t:new Array(t.length);const i=r.max,o=r.min;if("number"==typeof i)if("number"==typeof o)for(var a=n.minMax(t),s=(i-o)/(a.max-a.min),h=0;h<e.length;h++)e[h]=(t[h]-a.min)*s+o;else for(s=i/n.max(t),h=0;h<e.length;h++)e[h]=t[h]*s;else if("number"==typeof o)for(s=o/n.min(t),h=0;h<e.length;h++)e[h]=t[h]*s;return e}}},function(t,r,e){"use strict";var n=e(12);function i(t,r){return t-r}r.max=function(t){for(var r=-1/0,e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)t[e][n]>r&&(r=t[e][n]);return r},r.min=function(t){for(var r=1/0,e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)t[e][n]<r&&(r=t[e][n]);return r},r.minMax=function(t){for(var r=1/0,e=-1/0,n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)t[n][i]<r&&(r=t[n][i]),t[n][i]>e&&(e=t[n][i]);return{min:r,max:e}},r.entropy=function(t,r){void 0===r&&(r=0);for(var e=0,n=t.length,i=t[0].length,o=0;o<n;o++)for(var a=0;a<i;a++)e+=t[o][a]*Math.log(t[o][a]+r);return-e},r.mean=function(t,r){void 0===r&&(r=0);var e,n,i,o,a=t.length,s=t[0].length;if(-1===r){for(e=[0],n=a*s,i=0;i<a;i++)for(o=0;o<s;o++)e[0]+=t[i][o];e[0]/=n}else if(0===r)for(e=new Array(s),n=a,o=0;o<s;o++){for(e[o]=0,i=0;i<a;i++)e[o]+=t[i][o];e[o]/=n}else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(a),n=s,o=0;o<a;o++){for(e[o]=0,i=0;i<s;i++)e[o]+=t[o][i];e[o]/=n}}return e},r.sum=function(t,r){void 0===r&&(r=0);var e,n,i,o=t.length,a=t[0].length;if(-1===r)for(e=[0],n=0;n<o;n++)for(i=0;i<a;i++)e[0]+=t[n][i];else if(0===r)for(e=new Array(a),i=0;i<a;i++)for(e[i]=0,n=0;n<o;n++)e[i]+=t[n][i];else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(o),i=0;i<o;i++)for(e[i]=0,n=0;n<a;n++)e[i]+=t[i][n]}return e},r.product=function(t,r){void 0===r&&(r=0);var e,n,i,o=t.length,a=t[0].length;if(-1===r)for(e=[1],n=0;n<o;n++)for(i=0;i<a;i++)e[0]*=t[n][i];else if(0===r)for(e=new Array(a),i=0;i<a;i++)for(e[i]=1,n=0;n<o;n++)e[i]*=t[n][i];else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(o),i=0;i<o;i++)for(e[i]=1,n=0;n<a;n++)e[i]*=t[i][n]}return e},r.standardDeviation=function(t,e,n){for(var i=r.variance(t,e,n),o=i.length,a=0;a<o;a++)i[a]=Math.sqrt(i[a]);return i},r.variance=function(t,e,n){void 0===n&&(n=!0),e=e||r.mean(t);var i=t.length;if(0===i)return[];for(var o=t[0].length,a=new Array(o),s=0;s<o;s++){for(var h=0,l=0,u=0,f=0;f<i;f++)h+=u=t[f][s]-e[s],l+=u*u;a[s]=n?(l-h*h/i)/(i-1):(l-h*h/i)/i}return a},r.median=function(t){for(var r=t.length,e=t[0].length,n=new Array(e),o=0;o<e;o++){for(var a=new Array(r),s=0;s<r;s++)a[s]=t[s][o];a.sort(i);var h=a.length;n[o]=h%2==0?.5*(a[h/2]+a[h/2-1]):a[Math.floor(h/2)]}return n},r.mode=function(t){var r,e,n=t.length,i=t[0].length,o=new Array(i);for(r=0;r<i;r++){for(var a=new Array(n),s=0;s<n;s++)a[s]=0;var h=new Array(n),l=0;for(e=0;e<n;e++){var u=h.indexOf(t[e][r]);u>=0?a[u]++:(h[l]=t[e][r],a[l]=1,l++)}var f=0,c=0;for(e=0;e<l;e++)a[e]>f&&(f=a[e],c=e);o[r]=h[c]}return o},r.skewness=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),i=t.length,o=n.length,a=new Array(o),s=0;s<o;s++){for(var h=0,l=0,u=0;u<i;u++){var f=t[u][s]-n[s];h+=f*f,l+=f*f*f}var c=h/i,m=l/i/Math.pow(c,1.5);if(e){var v=Math.sqrt(i*(i-1)),g=i-2;a[s]=v/g*m}else a[s]=m}return a},r.kurtosis=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),i=t.length,o=t[0].length,a=new Array(o),s=0;s<o;s++){for(var h=0,l=0,u=0;u<i;u++){var f=t[u][s]-n[s];h+=f*f,l+=f*f*f*f}var c=h/i,m=l/i;if(e){var v=h/(i-1),g=i*(i+1)/((i-1)*(i-2)*(i-3)),p=l/(v*v),w=(i-1)*(i-1)/((i-2)*(i-3));a[s]=g*p-3*w}else a[s]=m/(c*c)-3}return a},r.standardError=function(t){for(var e=t.length,n=r.standardDeviation(t),i=n.length,o=new Array(i),a=Math.sqrt(e),s=0;s<i;s++)o[s]=n[s]/a;return o},r.covariance=function(t,e){return r.scatter(t,void 0,e)},r.scatter=function(t,e,n){void 0===n&&(n=0),void 0===e&&(0===n?e=t.length-1:1===n&&(e=t[0].length-1));var i=r.mean(t,n),o=t.length;if(0===o)return[[]];var a,s,h,l,u,f=t[0].length;if(0===n){for(a=new Array(f),s=0;s<f;s++)a[s]=new Array(f);for(s=0;s<f;s++)for(h=s;h<f;h++){for(l=0,u=0;u<o;u++)l+=(t[u][h]-i[h])*(t[u][s]-i[s]);l/=e,a[s][h]=l,a[h][s]=l}}else{if(1!==n)throw new Error("Invalid dimension");for(a=new Array(o),s=0;s<o;s++)a[s]=new Array(o);for(s=0;s<o;s++)for(h=s;h<o;h++){for(l=0,u=0;u<f;u++)l+=(t[h][u]-i[h])*(t[s][u]-i[s]);l/=e,a[s][h]=l,a[h][s]=l}}return a},r.correlation=function(t){var e,n,i=r.mean(t),o=r.standardDeviation(t,!0,i),a=r.zScores(t,i,o),s=t.length,h=t[0].length,l=new Array(h);for(e=0;e<h;e++)l[e]=new Array(h);for(e=0;e<h;e++)for(n=e;n<h;n++){for(var u=0,f=0,c=a.length;f<c;f++)u+=a[f][n]*a[f][e];u/=s-1,l[e][n]=u,l[n][e]=u}return l},r.zScores=function(t,e,n){return e=e||r.mean(t),void 0===n&&(n=r.standardDeviation(t,!0,e)),r.standardize(r.center(t,e,!1),n,!0)},r.center=function(t,e,n){e=e||r.mean(t);var i,o,a,s=t,h=t.length;if(!n)for(s=new Array(h),i=0;i<h;i++)s[i]=new Array(t[i].length);for(i=0;i<h;i++){var l=s[i];for(o=0,a=l.length;o<a;o++)l[o]=t[i][o]-e[o]}return s},r.standardize=function(t,e,n){void 0===e&&(e=r.standardDeviation(t));var i,o,a,s=t,h=t.length;if(!n)for(s=new Array(h),i=0;i<h;i++)s[i]=new Array(t[i].length);for(i=0;i<h;i++){var l=s[i],u=t[i];for(o=0,a=l.length;o<a;o++)0===e[o]||isNaN(e[o])||(l[o]=u[o]/e[o])}return s},r.weightedVariance=function(t,e){var n=r.mean(t),i=t.length;if(0===i)return[];for(var o=t[0].length,a=new Array(o),s=0;s<o;s++){for(var h=0,l=0,u=0,f=0;f<i;f++){var c=t[f][s]-n[s],m=e[f];h+=m*(c*c),u+=m,l+=m*m}a[s]=h*(u/(u*u-l))}return a},r.weightedMean=function(t,r,e){void 0===e&&(e=0);var i=t.length;if(0===i)return[];var o,a,s,h,l,u,f=t[0].length;if(0===e){for(o=new Array(f),a=0;a<f;a++)o[a]=0;for(a=0;a<i;a++)for(u=t[a],l=r[a],h=0;h<f;h++)o[h]+=u[h]*l}else{if(1!==e)throw new Error("Invalid dimension");for(o=new Array(i),a=0;a<i;a++)o[a]=0;for(h=0;h<i;h++)for(u=t[h],l=r[h],a=0;a<f;a++)o[h]+=u[a]*l}var c=n.sum(r);if(0!==c)for(a=0,s=o.length;a<s;a++)o[a]/=c;return o},r.weightedCovariance=function(t,e,n,i){i=i||0,n=n||r.weightedMean(t,e,i);for(var o=0,a=0,s=0,h=e.length;s<h;s++)o+=e[s],a+=e[s]*e[s];var l=o/(o*o-a);return r.weightedScatter(t,e,n,l,i)},r.weightedScatter=function(t,e,n,i,o){o=o||0,n=n||r.weightedMean(t,e,o),void 0===i&&(i=1);var a=t.length;if(0===a)return[[]];var s,h,l,u,f,c=t[0].length;if(0===o){for(s=new Array(c),h=0;h<c;h++)s[h]=new Array(c);for(h=0;h<c;h++)for(l=h;l<c;l++){for(f=0,u=0;u<a;u++)f+=e[u]*(t[u][l]-n[l])*(t[u][h]-n[h]);s[h][l]=f*i,s[l][h]=f*i}}else{if(1!==o)throw new Error("Invalid dimension");for(s=new Array(a),h=0;h<a;h++)s[h]=new Array(a);for(h=0;h<a;h++)for(l=h;l<a;l++){for(f=0,u=0;u<c;u++)f+=e[u]*(t[l][u]-n[l])*(t[h][u]-n[h]);s[h][l]=f*i,s[l][h]=f*i}}return s}},function(t,r,e){"use strict";function n(t,r,e,n){return.5*e*r*r+n*r-(.5*e*t*t+n*t)}r.getEquallySpacedData=function(t,r,e){if(t.length>1&&t[0]>t[1]&&(t=t.slice().reverse(),r=r.slice().reverse()),t.length!==r.length)throw new RangeError("the x and y vector doesn't have the same size.");void 0===e&&(e={});var i=void 0===e.from?t[0]:e.from;if(isNaN(i)||!isFinite(i))throw new RangeError("'From' value must be a number");var o=void 0===e.to?t[t.length-1]:e.to;if(isNaN(o)||!isFinite(o))throw new RangeError("'To' value must be a number");var a=i>o;if(a){var s=i;i=o,o=s}var h=void 0===e.numberOfPoints?100:e.numberOfPoints;if(isNaN(h)||!isFinite(h))throw new RangeError("'Number of points' value must be a number");if(h<1)throw new RangeError("the number of point must be higher than 1");var l="slot"===("slot"===e.variant?"slot":"smooth")?function(t,r,e,n,i){var o=t.length,a=(n-e)/(i-1),s=a/2,h=t[t.length-1]-t[t.length-2],l=e-s,u=new Array(i),f=l,c=l+a,m=-Number.MAX_VALUE,v=0,g=t[0],p=r[0],w=0,d=!0,y=0,x=0,M=1,b=0;t:for(;;){if(m>=g)throw new Error("x must be an increasing serie");for(;m-c>0;){if(d&&(x++,d=!1),u[b]=x<=0?0:y/x,++b===i)break t;f=c,c+=a,y=0,x=0}m>f&&(y+=v,x++),(m===-Number.MAX_VALUE||w>1)&&x--,m=g,v=p,M<o?(g=t[M],p=r[M],M++):(g+=h,p=0,w++)}return u}(t,r,i,o,h):function(t,r,e,i,o){var a=t.length,s=(i-e)/(o-1),h=e-s/2,l=new Array(o),u=t[1]-t[0],f=t[t.length-1]-t[t.length-2],c=h,m=h+s,v=Number.MIN_VALUE,g=0,p=t[0]-u,w=0,d=0,y=0,x=0,M=0,b=0,A=0,S=0;function k(t,r,e,n){return(n-r)/(e-t)}t:for(;;){for(;p-m>=0;){var R=n(0,m-v,y,g);if(b=d+R,l[S]=(b-M)/s,++S===o)break t;c=m,m+=s,M=b}v<=c&&c<=p&&(R=n(0,c-v,y,g),M=d+R),d+=n(v,p,y,x),v=p,g=w,A<a?(p=t[A],w=r[A],A++):A===a&&(p+=f,w=0),y=k(v,g,p,w),x=-y*v+g}return l}(t,r,i,o,h);return a?l.reverse():l},r.integral=n},function(t,r,e){"use strict";r.SNV=function(t){for(var r=n.mean(t),e=n.standardDeviation(t),i=t.slice(),o=0;o<t.length;o++)i[o]=(i[o]-r)/e;return i};var n=e(11).array},function(t,r,e){"use strict";var n=e(1);t.exports=class extends n{constructor(t){super(t,t.columns,t.rows)}set(t,r,e){return this.matrix.set(r,t,e),this}get(t,r){return this.matrix.get(r,t)}}},function(t,r,e){"use strict";var n=e(1);t.exports=class extends n{constructor(t,r){super(t,1,t.columns),this.row=r}set(t,r,e){return this.matrix.set(this.row,r,e),this}get(t,r){return this.matrix.get(this.row,r)}}},function(t,r,e){"use strict";var n=e(1),i=e(3);t.exports=class extends n{constructor(t,r,e,n,o){i.checkRange(t,r,e,n,o),super(t,e-r+1,o-n+1),this.startRow=r,this.startColumn=n}set(t,r,e){return this.matrix.set(this.startRow+t,this.startColumn+r,e),this}get(t,r){return this.matrix.get(this.startRow+t,this.startColumn+r)}}},function(t,r,e){"use strict";var n=e(1),i=e(3);t.exports=class extends n{constructor(t,r,e){var n=i.checkIndices(t,r,e);super(t,n.row.length,n.column.length),this.rowIndices=n.row,this.columnIndices=n.column}set(t,r,e){return this.matrix.set(this.rowIndices[t],this.columnIndices[r],e),this}get(t,r){return this.matrix.get(this.rowIndices[t],this.columnIndices[r])}}},function(t,r,e){"use strict";var n=e(1);t.exports=class extends n{constructor(t,r){super(t,t.rows,1),this.column=r}set(t,r,e){return this.matrix.set(t,this.column,e),this}get(t){return this.matrix.get(t,this.column)}}},function(t,r,e){"use strict";var n=e(1);t.exports=class extends n{constructor(t){super(t,t.rows,t.columns)}set(t,r,e){return this.matrix.set(this.rows-t-1,r,e),this}get(t,r){return this.matrix.get(this.rows-t-1,r)}}},function(t,r,e){"use strict";var n=e(1);t.exports=class extends n{constructor(t){super(t,t.rows,t.columns)}set(t,r,e){return this.matrix.set(t,this.columns-r-1,e),this}get(t,r){return this.matrix.get(t,this.columns-r-1)}}},function(t,r,e){"use strict";var n=e(0).Matrix,i=e(10),o=e(41),a=e(9),s=e(42),h=e(43);function l(t){return u(t=n.checkMatrix(t),n.eye(t.rows))}function u(t,r){return t=n.checkMatrix(t),r=n.checkMatrix(r),t.isSquare()?new a(t).solve(r):new s(t).solve(r)}n.inverse=n.inv=l,n.prototype.inverse=n.prototype.inv=function(){return l(this)},n.solve=u,n.prototype.solve=function(t){return u(this,t)},t.exports={SingularValueDecomposition:i,SVD:i,EigenvalueDecomposition:o,EVD:o,LuDecomposition:a,LU:a,QrDecomposition:s,QR:s,CholeskyDecomposition:h,CHO:h,inverse:l,solve:u}},function(t,r,e){"use strict";const n=e(0).Matrix,i=e(5),o=i.hypotenuse,a=i.getFilled2DArray,s={assumeSymmetric:!1};function h(t,r){if(r=Object.assign({},s,r),!(this instanceof h))return new h(t,r);if(!(t=n.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");var e,i,u=t.columns,f=a(u,u,0),c=new Array(u),m=new Array(u),v=t;if(!!r.assumeSymmetric||t.isSymmetric()){for(e=0;e<u;e++)for(i=0;i<u;i++)f[e][i]=v.get(e,i);!function(t,r,e,n){var i,o,a,s,h,l,u,f;for(h=0;h<t;h++)e[h]=n[t-1][h];for(s=t-1;s>0;s--){for(f=0,a=0,l=0;l<s;l++)f+=Math.abs(e[l]);if(0===f)for(r[s]=e[s-1],h=0;h<s;h++)e[h]=n[s-1][h],n[s][h]=0,n[h][s]=0;else{for(l=0;l<s;l++)e[l]/=f,a+=e[l]*e[l];for(i=e[s-1],o=Math.sqrt(a),i>0&&(o=-o),r[s]=f*o,a-=i*o,e[s-1]=i-o,h=0;h<s;h++)r[h]=0;for(h=0;h<s;h++){for(i=e[h],n[h][s]=i,o=r[h]+n[h][h]*i,l=h+1;l<=s-1;l++)o+=n[l][h]*e[l],r[l]+=n[l][h]*i;r[h]=o}for(i=0,h=0;h<s;h++)r[h]/=a,i+=r[h]*e[h];for(u=i/(a+a),h=0;h<s;h++)r[h]-=u*e[h];for(h=0;h<s;h++){for(i=e[h],o=r[h],l=h;l<=s-1;l++)n[l][h]-=i*r[l]+o*e[l];e[h]=n[s-1][h],n[s][h]=0}}e[s]=a}for(s=0;s<t-1;s++){if(n[t-1][s]=n[s][s],n[s][s]=1,0!==(a=e[s+1])){for(l=0;l<=s;l++)e[l]=n[l][s+1]/a;for(h=0;h<=s;h++){for(o=0,l=0;l<=s;l++)o+=n[l][s+1]*n[l][h];for(l=0;l<=s;l++)n[l][h]-=o*e[l]}}for(l=0;l<=s;l++)n[l][s+1]=0}for(h=0;h<t;h++)e[h]=n[t-1][h],n[t-1][h]=0;n[t-1][t-1]=1,r[0]=0}(u,m,c,f),function(t,r,e,n){var i,a,s,h,l,u,f,c,m,v,g,p,w,d,y,x;for(s=1;s<t;s++)r[s-1]=r[s];r[t-1]=0;var M=0,b=0,A=Math.pow(2,-52);for(u=0;u<t;u++){for(b=Math.max(b,Math.abs(e[u])+Math.abs(r[u])),f=u;f<t&&!(Math.abs(r[f])<=A*b);)f++;if(f>u){0;do{for(1,i=e[u],c=(e[u+1]-i)/(2*r[u]),m=o(c,1),c<0&&(m=-m),e[u]=r[u]/(c+m),e[u+1]=r[u]*(c+m),v=e[u+1],a=i-e[u],s=u+2;s<t;s++)e[s]-=a;for(M+=a,c=e[f],p=g=1,w=g,d=r[u+1],y=0,x=0,s=f-1;s>=u;s--)for(w=p,p=g,x=y,i=g*r[s],a=g*c,m=o(c,r[s]),r[s+1]=y*m,y=r[s]/m,c=(g=c/m)*e[s]-y*i,e[s+1]=a+y*(g*i+y*e[s]),l=0;l<t;l++)a=n[l][s+1],n[l][s+1]=y*n[l][s]+g*a,n[l][s]=g*n[l][s]-y*a;c=-y*x*w*d*r[u]/v,r[u]=y*c,e[u]=g*c}while(Math.abs(r[u])>A*b)}e[u]=e[u]+M,r[u]=0}for(s=0;s<t-1;s++){for(l=s,c=e[s],h=s+1;h<t;h++)e[h]<c&&(l=h,c=e[h]);if(l!==s)for(e[l]=e[s],e[s]=c,h=0;h<t;h++)c=n[h][s],n[h][s]=n[h][l],n[h][l]=c}}(u,m,c,f)}else{var g=a(u,u,0),p=new Array(u);for(i=0;i<u;i++)for(e=0;e<u;e++)g[e][i]=v.get(e,i);!function(t,r,e,n){var i,o,a,s,h,l,u,f=t-1;for(l=1;l<=f-1;l++){for(u=0,s=l;s<=f;s++)u+=Math.abs(r[s][l-1]);if(0!==u){for(a=0,s=f;s>=l;s--)e[s]=r[s][l-1]/u,a+=e[s]*e[s];for(o=Math.sqrt(a),e[l]>0&&(o=-o),a-=e[l]*o,e[l]=e[l]-o,h=l;h<t;h++){for(i=0,s=f;s>=l;s--)i+=e[s]*r[s][h];for(i/=a,s=l;s<=f;s++)r[s][h]-=i*e[s]}for(s=0;s<=f;s++){for(i=0,h=f;h>=l;h--)i+=e[h]*r[s][h];for(i/=a,h=l;h<=f;h++)r[s][h]-=i*e[h]}e[l]=u*e[l],r[l][l-1]=u*o}}for(s=0;s<t;s++)for(h=0;h<t;h++)n[s][h]=s===h?1:0;for(l=f-1;l>=1;l--)if(0!==r[l][l-1]){for(s=l+1;s<=f;s++)e[s]=r[s][l-1];for(h=l;h<=f;h++){for(o=0,s=l;s<=f;s++)o+=e[s]*n[s][h];for(o=o/e[l]/r[l][l-1],s=l;s<=f;s++)n[s][h]+=o*e[s]}}}(u,g,p,f),function(t,r,e,n,i){var o,a,s,h,u,f,c,m,v,g,p,w,d,y,x,M=t-1,b=t-1,A=Math.pow(2,-52),S=0,k=0,R=0,E=0,V=0,C=0,_=0,O=0;for(o=0;o<t;o++)for((o<0||o>b)&&(e[o]=i[o][o],r[o]=0),a=Math.max(o-1,0);a<t;a++)k+=Math.abs(i[o][a]);for(;M>=0;){for(h=M;h>0&&(0===(C=Math.abs(i[h-1][h-1])+Math.abs(i[h][h]))&&(C=k),!(Math.abs(i[h][h-1])<A*C));)h--;if(h===M)i[M][M]=i[M][M]+S,e[M]=i[M][M],r[M]=0,M--,O=0;else if(h===M-1){if(c=i[M][M-1]*i[M-1][M],R=(i[M-1][M-1]-i[M][M])/2,E=R*R+c,_=Math.sqrt(Math.abs(E)),i[M][M]=i[M][M]+S,i[M-1][M-1]=i[M-1][M-1]+S,m=i[M][M],E>=0){for(_=R>=0?R+_:R-_,e[M-1]=m+_,e[M]=e[M-1],0!==_&&(e[M]=m-c/_),r[M-1]=0,r[M]=0,m=i[M][M-1],C=Math.abs(m)+Math.abs(_),R=m/C,E=_/C,V=Math.sqrt(R*R+E*E),R/=V,E/=V,a=M-1;a<t;a++)_=i[M-1][a],i[M-1][a]=E*_+R*i[M][a],i[M][a]=E*i[M][a]-R*_;for(o=0;o<=M;o++)_=i[o][M-1],i[o][M-1]=E*_+R*i[o][M],i[o][M]=E*i[o][M]-R*_;for(o=0;o<=b;o++)_=n[o][M-1],n[o][M-1]=E*_+R*n[o][M],n[o][M]=E*n[o][M]-R*_}else e[M-1]=m+R,e[M]=m+R,r[M-1]=_,r[M]=-_;M-=2,O=0}else{if(m=i[M][M],v=0,c=0,h<M&&(v=i[M-1][M-1],c=i[M][M-1]*i[M-1][M]),10===O){for(S+=m,o=0;o<=M;o++)i[o][o]-=m;C=Math.abs(i[M][M-1])+Math.abs(i[M-1][M-2]),m=v=.75*C,c=-.4375*C*C}if(30===O&&(C=(C=(v-m)/2)*C+c)>0){for(C=Math.sqrt(C),v<m&&(C=-C),C=m-c/((v-m)/2+C),o=0;o<=M;o++)i[o][o]-=C;S+=C,m=v=c=.964}for(O+=1,u=M-2;u>=h&&(_=i[u][u],R=((V=m-_)*(C=v-_)-c)/i[u+1][u]+i[u][u+1],E=i[u+1][u+1]-_-V-C,V=i[u+2][u+1],C=Math.abs(R)+Math.abs(E)+Math.abs(V),R/=C,E/=C,V/=C,u!==h)&&!(Math.abs(i[u][u-1])*(Math.abs(E)+Math.abs(V))<A*(Math.abs(R)*(Math.abs(i[u-1][u-1])+Math.abs(_)+Math.abs(i[u+1][u+1]))));)u--;for(o=u+2;o<=M;o++)i[o][o-2]=0,o>u+2&&(i[o][o-3]=0);for(s=u;s<=M-1&&(y=s!==M-1,s!==u&&(R=i[s][s-1],E=i[s+1][s-1],V=y?i[s+2][s-1]:0,0!==(m=Math.abs(R)+Math.abs(E)+Math.abs(V))&&(R/=m,E/=m,V/=m)),0!==m);s++)if(C=Math.sqrt(R*R+E*E+V*V),R<0&&(C=-C),0!==C){for(s!==u?i[s][s-1]=-C*m:h!==u&&(i[s][s-1]=-i[s][s-1]),m=(R+=C)/C,v=E/C,_=V/C,E/=R,V/=R,a=s;a<t;a++)R=i[s][a]+E*i[s+1][a],y&&(R+=V*i[s+2][a],i[s+2][a]=i[s+2][a]-R*_),i[s][a]=i[s][a]-R*m,i[s+1][a]=i[s+1][a]-R*v;for(o=0;o<=Math.min(M,s+3);o++)R=m*i[o][s]+v*i[o][s+1],y&&(R+=_*i[o][s+2],i[o][s+2]=i[o][s+2]-R*V),i[o][s]=i[o][s]-R,i[o][s+1]=i[o][s+1]-R*E;for(o=0;o<=b;o++)R=m*n[o][s]+v*n[o][s+1],y&&(R+=_*n[o][s+2],n[o][s+2]=n[o][s+2]-R*V),n[o][s]=n[o][s]-R,n[o][s+1]=n[o][s+1]-R*E}}}if(0===k)return;for(M=t-1;M>=0;M--)if(R=e[M],0===(E=r[M]))for(h=M,i[M][M]=1,o=M-1;o>=0;o--){for(c=i[o][o]-R,V=0,a=h;a<=M;a++)V+=i[o][a]*i[a][M];if(r[o]<0)_=c,C=V;else if(h=o,0===r[o]?i[o][M]=0!==c?-V/c:-V/(A*k):(m=i[o][o+1],v=i[o+1][o],E=(e[o]-R)*(e[o]-R)+r[o]*r[o],f=(m*C-_*V)/E,i[o][M]=f,i[o+1][M]=Math.abs(m)>Math.abs(_)?(-V-c*f)/m:(-C-v*f)/_),f=Math.abs(i[o][M]),A*f*f>1)for(a=o;a<=M;a++)i[a][M]=i[a][M]/f}else if(E<0)for(h=M-1,Math.abs(i[M][M-1])>Math.abs(i[M-1][M])?(i[M-1][M-1]=E/i[M][M-1],i[M-1][M]=-(i[M][M]-R)/i[M][M-1]):(x=l(0,-i[M-1][M],i[M-1][M-1]-R,E),i[M-1][M-1]=x[0],i[M-1][M]=x[1]),i[M][M-1]=0,i[M][M]=1,o=M-2;o>=0;o--){for(g=0,p=0,a=h;a<=M;a++)g+=i[o][a]*i[a][M-1],p+=i[o][a]*i[a][M];if(c=i[o][o]-R,r[o]<0)_=c,V=g,C=p;else if(h=o,0===r[o]?(x=l(-g,-p,c,E),i[o][M-1]=x[0],i[o][M]=x[1]):(m=i[o][o+1],v=i[o+1][o],w=(e[o]-R)*(e[o]-R)+r[o]*r[o]-E*E,d=2*(e[o]-R)*E,0===w&&0===d&&(w=A*k*(Math.abs(c)+Math.abs(E)+Math.abs(m)+Math.abs(v)+Math.abs(_))),x=l(m*V-_*g+E*p,m*C-_*p-E*g,w,d),i[o][M-1]=x[0],i[o][M]=x[1],Math.abs(m)>Math.abs(_)+Math.abs(E)?(i[o+1][M-1]=(-g-c*i[o][M-1]+E*i[o][M])/m,i[o+1][M]=(-p-c*i[o][M]-E*i[o][M-1])/m):(x=l(-V-v*i[o][M-1],-C-v*i[o][M],_,E),i[o+1][M-1]=x[0],i[o+1][M]=x[1])),f=Math.max(Math.abs(i[o][M-1]),Math.abs(i[o][M])),A*f*f>1)for(a=o;a<=M;a++)i[a][M-1]=i[a][M-1]/f,i[a][M]=i[a][M]/f}for(o=0;o<t;o++)if(o<0||o>b)for(a=o;a<t;a++)n[o][a]=i[o][a];for(a=t-1;a>=0;a--)for(o=0;o<=b;o++){for(_=0,s=0;s<=Math.min(a,b);s++)_+=n[o][s]*i[s][a];n[o][a]=_}}(u,m,c,f,g)}this.n=u,this.e=m,this.d=c,this.V=f}function l(t,r,e,n){var i,o;return Math.abs(e)>Math.abs(n)?[(t+(i=n/e)*r)/(o=e+i*n),(r-i*t)/o]:[((i=e/n)*t+r)/(o=n+i*e),(i*r-t)/o]}h.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return n.isMatrix(this.V)||(this.V=new n(this.V)),this.V},get diagonalMatrix(){var t,r,e=this.n,i=this.e,o=this.d,a=new n(e,e);for(t=0;t<e;t++){for(r=0;r<e;r++)a[t][r]=0;a[t][t]=o[t],i[t]>0?a[t][t+1]=i[t]:i[t]<0&&(a[t][t-1]=i[t])}return a}},t.exports=h},function(t,r,e){"use strict";var n=e(0).Matrix,i=e(5).hypotenuse;function o(t){if(!(this instanceof o))return new o(t);var r,e,a,s,h=(t=n.checkMatrix(t)).clone(),l=t.rows,u=t.columns,f=new Array(u);for(a=0;a<u;a++){var c=0;for(r=a;r<l;r++)c=i(c,h[r][a]);if(0!==c){for(h[a][a]<0&&(c=-c),r=a;r<l;r++)h[r][a]/=c;for(h[a][a]+=1,e=a+1;e<u;e++){for(s=0,r=a;r<l;r++)s+=h[r][a]*h[r][e];for(s=-s/h[a][a],r=a;r<l;r++)h[r][e]+=s*h[r][a]}}f[a]=-c}this.QR=h,this.Rdiag=f}o.prototype={solve:function(t){t=n.checkMatrix(t);var r=this.QR,e=r.rows;if(t.rows!==e)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var i,o,a,s,h=t.columns,l=t.clone(),u=r.columns;for(a=0;a<u;a++)for(o=0;o<h;o++){for(s=0,i=a;i<e;i++)s+=r[i][a]*l[i][o];for(s=-s/r[a][a],i=a;i<e;i++)l[i][o]+=s*r[i][a]}for(a=u-1;a>=0;a--){for(o=0;o<h;o++)l[a][o]/=this.Rdiag[a];for(i=0;i<a;i++)for(o=0;o<h;o++)l[i][o]-=l[a][o]*r[i][a]}return l.subMatrix(0,u-1,0,h-1)},isFullRank:function(){for(var t=this.QR.columns,r=0;r<t;r++)if(0===this.Rdiag[r])return!1;return!0},get upperTriangularMatrix(){var t,r,e=this.QR,i=e.columns,o=new n(i,i);for(t=0;t<i;t++)for(r=0;r<i;r++)o[t][r]=t<r?e[t][r]:t===r?this.Rdiag[t]:0;return o},get orthogonalMatrix(){var t,r,e,i,o=this.QR,a=o.rows,s=o.columns,h=new n(a,s);for(e=s-1;e>=0;e--){for(t=0;t<a;t++)h[t][e]=0;for(h[e][e]=1,r=e;r<s;r++)if(0!==o[e][e]){for(i=0,t=e;t<a;t++)i+=o[t][e]*h[t][r];for(i=-i/o[e][e],t=e;t<a;t++)h[t][r]+=i*o[t][e]}}return h}},t.exports=o},function(t,r,e){"use strict";var n=e(0).Matrix;function i(t){if(!(this instanceof i))return new i(t);if(!(t=n.checkMatrix(t)).isSymmetric())throw new Error("Matrix is not symmetric");var r,e,o,a=t,s=a.rows,h=new n(s,s),l=!0;for(e=0;e<s;e++){var u=h[e],f=0;for(o=0;o<e;o++){var c=h[o],m=0;for(r=0;r<o;r++)m+=c[r]*u[r];u[o]=m=(a[e][o]-m)/h[o][o],f+=m*m}for(l&=(f=a[e][e]-f)>0,h[e][e]=Math.sqrt(Math.max(f,0)),o=e+1;o<s;o++)h[e][o]=0}if(!l)throw new Error("Matrix is not positive definite");this.L=h}i.prototype={get lowerTriangularMatrix(){return this.L},solve:function(t){t=n.checkMatrix(t);var r=this.L,e=r.rows;if(t.rows!==e)throw new Error("Matrix dimensions do not match");var i,o,a,s=t.columns,h=t.clone();for(a=0;a<e;a++)for(o=0;o<s;o++){for(i=0;i<a;i++)h[a][o]-=h[i][o]*r[a][i];h[a][o]/=r[a][a]}for(a=e-1;a>=0;a--)for(o=0;o<s;o++){for(i=a+1;i<e;i++)h[a][o]-=h[i][o]*r[i][a];h[a][o]/=r[a][a]}return h}},t.exports=i},function(t,r,e){"use strict";var n=e(7);t.exports=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var e=r.width,i=[],o=0,a=0,s=1;for(let r=t.length-1;r>=0;r--)t[r].soft&&i.push(t.splice(r,1)[0]);i.push({x:Number.MAX_VALUE});var h=[[i[0].x,i[0].y]],l=[0];for(let r=1;r<i.length;r++)if(Math.abs(i[r-1].x-i[r].x)<e)h.push([i[r].x,i[r].y]),i[r].y>o&&(o=i[r].y,a=r),l.push(r),s++;else{if(s>2){var u=n.optimizeSingleLorentzian(h,{x:i[a].x,y:o,width:Math.abs(h[0][0]-h[h.length-1][0])});t.push({x:u[0][0],y:u[1][0],width:u[2][0],soft:!1})}else l.forEach(r=>{t.push(i[r])});h=[[i[r].x,i[r].y]],l=[r],o=i[r].y,a=r,s=1}return t.sort(function(t,r){return t.x-r.x}),t}},function(t,r,e){"use strict";t.exports=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{factor:e=2,overlap:n=!1}=r;for(let r of t)r.from=r.x-r.width/2*e,r.to=r.x+r.width/2*e;if(!n)for(let r=0;r<t.length-1;r++){let e=t[r],n=t[r+1];e.to>n.from&&(e.to=n.from=(e.to+n.from)/2)}for(let r of t)r.width=r.to-r.from;return t}},function(t,r,e){"use strict";function n(){const t=/[, \t]+/,r=["TIC",".RIC","SCANNUMBER"];function e(t){var r=[];for(let e=0;e<t.length;e++)r.push(parseFloat(t[e]));return r}class n{}const i={keepRecordsRegExp:/^$/,xy:!1,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};function o(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function a(t){return-1!==r.indexOf(t)}function s(t,r){if(r.xFactor||(r.xFactor=1),r.yFactor||(r.yFactor=1),r.observeFrequency&&r.xUnit&&"HZ"===r.xUnit.toUpperCase()&&(r.xUnit="PPM",r.xFactor=r.xFactor/r.observeFrequency,r.firstX=r.firstX/r.observeFrequency,r.lastX=r.lastX/r.observeFrequency,r.deltaX=r.deltaX/r.observeFrequency),r.shiftOffsetVal){var e=r.firstX-r.shiftOffsetVal;r.firstX=r.firstX-e,r.lastX=r.lastX-e}}function h(t){var r=(t=t.sort(l)).length;return t[Math.floor(r/2)]}function l(t,r){return t-r}function u(t,r){var e=t.yFactor,n=t.deltaX;t.isXYdata=!0;var i=[];t.data=[i];var o,a=t.firstX,s=t.firstY,h=!1;let l=0;for(;l<r.length;l++)if(13===(o=r.charCodeAt(l))||10===o)h=!0;else if(h)break;for(var u=!0,f=!1,c=!1,m=0,v=!1,g=!1,p=0,w=0,d=!1,y=!1,x=!1,M=0;l<=r.length;l++)if(o=l===r.length?13:r.charCodeAt(l),g)13!==o&&10!==o||(u=!0,g=!1);else if(o<=57&&o>=48)y=!0,M>0?p+=(o-48)/Math.pow(10,M++):(p*=10,p+=o-48);else if(44===o||46===o)y=!0,M++;else{if(y){if(u)u=!1,c&&(x=!0);else if(x)x=!1;else{f?(m=d?0-p:p,c=!0,f=!1):v||(w=d?0-p:p);for(var b=v?p-1:1,A=0;A<b;A++)c?s+=m:s=w,i.push(a),i.push(s*e),a+=n}d=!1,p=0,M=0,y=!1,v=!1}if(o<74&&o>63)y=!0,c=!1,p=o-64;else if(o>96&&o<106)y=!0,c=!1,p=o-96,d=!0;else if(115===o)y=!0,v=!0,p=9;else if(o>82&&o<91)y=!0,v=!0,p=o-82;else if(o>73&&o<83)y=!0,f=!0,p=o-73;else if(o>105&&o<115)y=!0,f=!0,p=o-105,d=!0;else if(36===o&&36===r.charCodeAt(l+1))y=!0,g=!0;else if(37===o)y=!0,f=!0,p=0,d=!1;else if(45===o){var S=r.charCodeAt(l+1);(S>=48&&S<=57||44===S||46===S)&&(y=!0,u||(c=!1),d=!0)}else 13!==o&&10!==o||(u=!0,g=!1)}}function f(t,r){var e,n=/(\(+|\)+|<+|>+|\s+)/g;t.isXYAdata=!0;var i=[];t.data=[i];var o=r.split(/,? *,?[;\r\n]+ */);for(let t=1;t<o.length;t++)e=o[t].trim().replace(n,"").split(","),i.push(parseFloat(e[0])),i.push(parseFloat(e[1]))}function c(t,r,e){var n,i=/\$\$.*/,o=/[,\t ]+/;t.isPeaktable=!0;var a=[];t.data=[a];var s=r.split(/,? *,?[;\r\n]+ */);for(let r=1;r<s.length;r++)if((n=s[r].trim().replace(i,"").split(o)).length%2==0)for(let r=0;r<n.length;r+=2)a.push(parseFloat(n[r])*t.xFactor),a.push(parseFloat(n[r+1])*t.yFactor);else e.logs.push("Format error: ".concat(n))}return function(l,m){var v,g,p,w,d,y,x,M=!(m=Object.assign({},i,m)).withoutXY,b=Date.now(),A={},S={};S.profiling=!!m.profiling&&[],S.logs=[];var k=[];S.spectra=k,S.info={};var R=new n;if("string"!=typeof l)throw new TypeError("the JCAMP should be a string");S.profiling&&S.profiling.push({action:"Before split to LDRS",time:Date.now()-b}),w=l.split(/[\r\n]+##/),S.profiling&&S.profiling.push({action:"Split to LDRS",time:Date.now()-b}),w[0]&&(w[0]=w[0].replace(/^[\r\n ]*##/,""));for(let r=0;r<w.length;r++){if((d=(v=w[r]).indexOf("="))>0?(g=v.substring(0,d),p=v.substring(d+1).trim()):(g=v,p=""),"DATATABLE"===(g=g.replace(/[_ -]/g,"").toUpperCase())&&(-1===(y=p.indexOf("\n"))&&(y=p.indexOf("\r")),y>0)){var E=-1,V=-1;if((x=p.substring(0,y).split(/[ ,;\t]+/))[0].indexOf("++")>0){var C=x[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),_=x[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");E=A.symbol.indexOf(C),V=A.symbol.indexOf(_)}-1===E&&(E=0),-1===V&&(V=0),A.first&&(A.first.length>E&&(R.firstX=A.first[E]),A.first.length>V&&(R.firstY=A.first[V])),A.last&&(A.last.length>E&&(R.lastX=A.last[E]),A.last.length>V&&(R.lastY=A.last[V])),A.vardim&&A.vardim.length>E&&(R.nbPoints=A.vardim[E]),A.factor&&(A.factor.length>E&&(R.xFactor=A.factor[E]),A.factor.length>V&&(R.yFactor=A.factor[V])),A.units&&(A.units.length>E&&(R.xUnit=A.units[E]),A.units.length>V&&(R.yUnit=A.units[V])),R.datatable=x[0],x[1]&&x[1].indexOf("PEAKS")>-1?g="PEAKTABLE":x[1]&&(x[1].indexOf("XYDATA")||x[0].indexOf("++")>0)&&(g="XYDATA",R.deltaX=(R.lastX-R.firstX)/(R.nbPoints-1))}if("XYDATA"!==g)if("PEAKTABLE"!==g)if("PEAKASSIGNMENTS"!==g){if("TITLE"===g)R.title=p;else if("DATATYPE"===g)R.dataType=p,p.indexOf("nD")>-1&&(S.twoD=!0);else if("NTUPLES"===g)p.indexOf("nD")>-1&&(S.twoD=!0);else if("XUNITS"===g)R.xUnit=p;else if("YUNITS"===g)R.yUnit=p;else if("FIRSTX"===g)R.firstX=parseFloat(p);else if("LASTX"===g)R.lastX=parseFloat(p);else if("FIRSTY"===g)R.firstY=parseFloat(p);else if("LASTY"===g)R.lastY=parseFloat(p);else if("NPOINTS"===g)R.nbPoints=parseFloat(p);else if("XFACTOR"===g)R.xFactor=parseFloat(p);else if("YFACTOR"===g)R.yFactor=parseFloat(p);else if("MAXX"===g)R.maxX=parseFloat(p);else if("MINX"===g)R.minX=parseFloat(p);else if("MAXY"===g)R.maxY=parseFloat(p);else if("MINY"===g)R.minY=parseFloat(p);else if("DELTAX"===g)R.deltaX=parseFloat(p);else if(".OBSERVEFREQUENCY"===g||"$SFO1"===g)R.observeFrequency||(R.observeFrequency=parseFloat(p));else if(".OBSERVENUCLEUS"===g)R.xType||(S.xType=p.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===g)S.indirectFrequency||(S.indirectFrequency=parseFloat(p));else if("$OFFSET"===g)S.shiftOffsetNum=0,R.shiftOffsetVal||(R.shiftOffsetVal=parseFloat(p));else if("$REFERENCEPOINT"===g);else if("VARNAME"===g)A.varname=p.split(t);else if("SYMBOL"===g)A.symbol=p.split(t);else if("VARTYPE"===g)A.vartype=p.split(t);else if("VARFORM"===g)A.varform=p.split(t);else if("VARDIM"===g)A.vardim=e(p.split(t));else if("UNITS"===g)A.units=p.split(t);else if("FACTOR"===g)A.factor=e(p.split(t));else if("FIRST"===g)A.first=e(p.split(t));else if("LAST"===g)A.last=e(p.split(t));else if("MIN"===g)A.min=e(p.split(t));else if("MAX"===g)A.max=e(p.split(t));else if(".NUCLEUS"===g)S.twoD&&(S.yType=p.split(t)[0]);else if("PAGE"===g){R.page=p.trim(),R.pageValue=parseFloat(p.replace(/^.*=/,"")),R.pageSymbol=R.page.replace(/[=].*/,"");var O=A.symbol.indexOf(R.pageSymbol),T="";A.units&&A.units[O]&&(T=A.units[O]),S.indirectFrequency&&"PPM"!==T&&(R.pageValue/=S.indirectFrequency)}else"RETENTIONTIME"===g?R.pageValue=parseFloat(p):a(g)?R[o(g)]=p:"SAMPLEDESCRIPTION"===g&&(R.sampleDescription=p);g.match(m.keepRecordsRegExp)&&(S.info[g]?(Array.isArray(S.info[g])||(S.info[g]=[S.info[g]]),S.info[g].push(p.trim())):S.info[g]=p.trim())}else M&&(p.match(/.*(XYA).*/)&&f(R,p),k.push(R),R=new n);else M&&(s(S,R),c(R,p,S),k.push(R),R=new n);else M&&(s(S,R),p.match(/.*\+\+.*/)?(R.deltaX||(R.deltaX=(R.lastX-R.firstX)/(R.nbPoints-1)),u(R,p)):c(R,p,S),k.push(R),R=new n)}if(S.profiling&&S.profiling.push({action:"Finished parsing",time:Date.now()-b}),Object.keys(A).length>0){var F=[],z=Object.keys(A);for(let t=0;t<z.length;t++){var D=z[t],I=A[D];for(let t=0;t<I.length;t++)F[t]||(F[t]={}),F[t][D]=I[t]}S.ntuples=F}if(S.twoD&&M&&(!function(t,r){var e=function(t){var r=t[0].data[0][0],e=r,n=t.length,i=t[0].data[0].length/2,o=new Array(n);for(let h=0;h<n;h++){o[h]=new Array(i);var a=t[h].data[0];for(let t=0;t<i;t++){var s=a[2*t+1];o[h][t]=s,s<r&&(r=s),s>e&&(e=s)}}const l=t[0].data[0][0],u=t[0].data[0][t[0].data[0].length-2],f=t[0].pageValue,c=t[n-1].pageValue;if(l>u)for(let t of o)t.reverse();f>c&&o.reverse();return{z:o,minX:Math.min(l,u),maxX:Math.max(l,u),minY:Math.min(f,c),maxY:Math.max(f,c),minZ:r,maxZ:e,noise:h(o[0].map(Math.abs))}}(t.spectra);r.noContour||(t.contourLines=function(t,r){for(var e,n,i,o,a,s,h,l,u,f,c,m,v,g=t.noise,p=t.z,w=p.length,d=p[0].length,y=t.minX,x=(t.maxX-y)/(d-1),M=t.minY,b=(t.maxY-M)/(w-1),A=t.minZ,S=t.maxZ,k=2*r.nbContourLevels,R=new Array(k),E=0;E<k;E++){var V={};R[E]=V;var C=E%2,_=(S-r.noiseMultiplier*g)*Math.exp((E>>1)-r.nbContourLevels);v=0===C?_+r.noiseMultiplier*g:0-_-r.noiseMultiplier*g;var O=[];if(V.zValue=v,V.lines=O,!(v<=A||v>=S))for(var T=0;T<w-1;T++)for(var F=p[T],z=p[T+1],D=0;D<d-1;D++)e=F[D],n=F[D+1],i=z[D],o=z[D+1],h=i>v,l=o>v,(a=e>v)!==(s=n>v)&&a!==h&&(u=D+(v-e)/(n-e),f=T,c=D,m=T+(v-e)/(i-e),O.push(u*x+y),O.push(f*b+M),O.push(c*x+y),O.push(m*b+M)),l!==s&&l!==h&&(u=D+1,f=T+1-(v-o)/(n-o),c=D+1-(v-o)/(i-o),m=T+1,O.push(u*x+y),O.push(f*b+M),O.push(c*x+y),O.push(m*b+M)),s!==h&&(u=(D+1-(v-n)/(i-n))*x+y,f=(T+(v-n)/(i-n))*b+M,s!==a&&(c=D+1-(v-n)/(e-n),m=T,O.push(u),O.push(f),O.push(c*x+y),O.push(m*b+M)),h!==a&&(c=D,m=T+1-(v-i)/(e-i),O.push(u),O.push(f),O.push(c*x+y),O.push(m*b+M)),s!==l&&(c=D+1,m=T+(v-n)/(o-n),O.push(u),O.push(f),O.push(c*x+y),O.push(m*b+M)),h!==l&&(c=D+(v-i)/(o-i),m=T+1,O.push(u),O.push(f),O.push(c*x+y),O.push(m*b+M)))}return{minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,segments:R}}(e,r),delete e.z);t.minMax=e}(S,m),S.profiling&&S.profiling.push({action:"Finished countour plot calculation",time:Date.now()-b}),m.keepSpectra||delete S.spectra),m.chromatogram&&(m.xy=!0),m.xy&&M&&k.length>0)for(let t=0;t<k.length;t++)if((R=k[t]).data.length>0)for(let t=0;t<R.data.length;t++){for(var q=R.data[t],j={x:new Array(q.length/2),y:new Array(q.length/2)},N=0;N<q.length;N+=2)j.x[N/2]=q[N],j.y[N/2]=q[N+1];R.data[t]=j}return m.chromatogram&&(S.spectra.length>1?function(t){var e=t.spectra,n=e.length,i={times:new Array(n),series:{ms:{dimension:2,data:new Array(n)}}},a=[];for(let t=0;t<r.length;t++){var s=o(r[t]);e[0][s]&&(a.push(s),i.series[s]={dimension:1,data:new Array(n)})}for(let t=0;t<n;t++){var h=e[t];i.times[t]=h.pageValue;for(let r=0;r<a.length;r++)i.series[a[r]].data[t]=parseFloat(h[a[r]]);h.data&&(i.series.ms.data[t]=[h.data[0].x,h.data[0].y])}t.chromatogram=i}(S):function(t){var r=t.spectra[0].data[0];t.chromatogram={times:r.x.slice(),series:{intensity:{dimension:1,data:r.y.slice()}}}}(S),S.profiling&&S.profiling.push({action:"Finished chromatogram calculation",time:Date.now()-b})),S.profiling&&S.profiling.push({action:"Total time",time:Date.now()-b}),S}}var i=n();var o,a={};t.exports={convert:function(t,r,e){return"boolean"==typeof r&&(e=r,r={}),e?function(t,r){o||(e=URL.createObjectURL(new Blob(["var getConverter =".concat(n.toString(),";var convert = getConverter(); onmessage = function (event) { var data = JSON.parse(event.data); postMessage(JSON.stringify({stamp: data.stamp, output: convert(data.input, data.options)})); };")],{type:"application/javascript"})),o=new Worker(e),URL.revokeObjectURL(e),o.addEventListener("message",function(t){var r=JSON.parse(t.data),e=r.stamp;a[e]&&a[e](r.output)}));var e;return new Promise(function(e){var n="".concat(Date.now()).concat(Math.random());a[n]=e,o.postMessage(JSON.stringify({stamp:n,input:t,options:r}))})}(t,r):i(t,r)},createTree:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{flatten:e=!1}=r;if("string"!=typeof t)throw new TypeError("the JCAMP should be a string");let n,i=t.split(/[\r\n]+/),o=[],a=[],s=[],h=0,l=t.includes("## ");for(var u=0;u<i.length;u++){let t=i[u],r=l?t.replace(/ /g,""):t;if("##NTUPLES"===r.substring(0,9)&&h++,"##TITLE"===r.substring(0,7)){let e=[r.substring(8).trim()];for(let t=u+1;t<i.length&&!i[t].startsWith("##");t++)e.push(i[t].trim());a.push({title:e.join("\n"),jcamp:"".concat(t,"\n"),children:[]}),n=a[a.length-1],o.push(n)}else if("##END"===r.substring(0,5)&&0===h){n.jcamp+="".concat(t,"\n");var f=a.pop();0!==a.length?(n=a[a.length-1]).children.push(f):(n=void 0,s.push(f))}else if(n&&n.jcamp){n.jcamp+="".concat(t,"\n");var c=r.match(/^##(.*?)=(.+)/);if(c)"DATATYPE"===c[1].replace(/[ _-]/g,"").toUpperCase()&&(n.dataType=c[2].trim())}"##END"===r.substring(0,5)&&h>0&&h--}return e?(o.forEach(t=>{t.children=void 0}),o):s}}},function(t,r,e){"use strict";function n(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{x:e,y:n}=t,{reverse:i=!1}=r;var o;o=i?(t,r)=>r.x-t.x:(t,r)=>t.x-r.x;for(var a=e.map((t,r)=>({x:t,y:n[r]})).sort(o),s={x:e.slice(),y:n.slice()},h=0;h<e.length;h++)s.x[h]=a[h].x,s.y[h]=a[h].y;return s}e.r(r),e.d(r,"default",function(){return n})},function(t,r,e){"use strict";e.r(r),e.d(r,"parseXY",function(){return o});var n=e(14),i=e.n(n);function o(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{normalize:e=!1,uniqueX:n=!1,arrayType:o="xyxy",xColumn:a=0,yColumn:s=1,keepInfo:h=!1,maxNumberColumns:l=Math.max(a,s)+1,minNumberColumns:u=Math.max(a,s)+1}=r;var f=t.split(/[\r\n]+/);if("xxyy"!==o&&"xyxy"!==o)throw new Error("unsupported arrayType (".concat(o,")"));for(var c=Number.MIN_VALUE,m=[[],[]],v=[],g=0;g<f.length;g++){var p=f[g].trim();if(p.match(/[0-9]+/)&&p.match(/^[0-9eE,;. \t+-]+$/)){var w=p.split(/,[; \t]+|[; \t]+/);if(1===w.length&&(w=p.split(/[,; \t]+/)),w&&w.length>=u&&w.length<=l){let t=parseFloat(w[a].replace(",",".")),r=parseFloat(w[s].replace(",","."));r>c&&(c=r),m[0].push(t),m[1].push(r)}}else p&&v.push({position:m[0].length,value:p})}if(e)for(var d=0;d<m[0].length;d++)m[1][d]/=c;if(n&&i()(m[0],m[1]),"xyxy"===o){var y=[];for(let t=0;t<m[0].length;t++)y.push([m[0][t],m[1][t]]);m=y}return h?{info:v,data:m}:m}}])});
//# sourceMappingURL=raman-spectrum.min.js.map