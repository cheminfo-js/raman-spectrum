!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((r=r||self).RamanSpectrum={})}(this,function(exports){"use strict";function unwrapExports(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function createCommonjsModule(r,t){return r(t={exports:{}},t.exports),t.exports}function getCjsExportFromNamespace(r){return r&&r.default||r}const toString=Object.prototype.toString;function isAnyArray(r){return toString.call(r).endsWith("Array]")}var src=isAnyArray;function min(r){if(!src(r))throw new TypeError("input must be an array");if(0===r.length)throw new TypeError("input must not be empty");for(var t=r[0],e=1;e<r.length;e++)r[e]<t&&(t=r[e]);return t}var libEs6=Object.freeze({default:min});function max(r){if(!src(r))throw new TypeError("input must be an array");if(0===r.length)throw new TypeError("input must not be empty");for(var t=r[0],e=1;e<r.length;e++)r[e]>t&&(t=r[e]);return t}var libEs6$1=Object.freeze({default:max}),hasOwn=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,defineProperty=Object.defineProperty,gOPD=Object.getOwnPropertyDescriptor,isArray=function(r){return"function"==typeof Array.isArray?Array.isArray(r):"[object Array]"===toStr.call(r)},isPlainObject=function(r){if(!r||"[object Object]"!==toStr.call(r))return!1;var t,e=hasOwn.call(r,"constructor"),a=r.constructor&&r.constructor.prototype&&hasOwn.call(r.constructor.prototype,"isPrototypeOf");if(r.constructor&&!e&&!a)return!1;for(t in r);return void 0===t||hasOwn.call(r,t)},setProperty=function(r,t){defineProperty&&"__proto__"===t.name?defineProperty(r,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):r[t.name]=t.newValue},getProperty=function(r,t){if("__proto__"===t){if(!hasOwn.call(r,t))return;if(gOPD)return gOPD(r,t).value}return r[t]},extend=function r(){var t,e,a,n,i,o,s=arguments[0],l=1,h=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},l=2),(null==s||"object"!=typeof s&&"function"!=typeof s)&&(s={});l<h;++l)if(null!=(t=arguments[l]))for(e in t)a=getProperty(s,e),s!==(n=getProperty(t,e))&&(u&&n&&(isPlainObject(n)||(i=isArray(n)))?(i?(i=!1,o=a&&isArray(a)?a:[]):o=a&&isPlainObject(a)?a:{},setProperty(s,{name:e,newValue:r(u,o,n)})):void 0!==n&&setProperty(s,{name:e,newValue:n}));return s},array=createCommonjsModule(function(r,t){function e(r,t){return r-t}t.sum=function(r){for(var t=0,e=0;e<r.length;e++)t+=r[e];return t},t.max=function(r){for(var t=-1/0,e=r.length,a=0;a<e;a++)r[a]>t&&(t=r[a]);return t},t.min=function(r){for(var t=1/0,e=r.length,a=0;a<e;a++)r[a]<t&&(t=r[a]);return t},t.minMax=function(r){for(var t=1/0,e=-1/0,a=r.length,n=0;n<a;n++)r[n]<t&&(t=r[n]),r[n]>e&&(e=r[n]);return{min:t,max:e}},t.arithmeticMean=function(r){for(var t=0,e=r.length,a=0;a<e;a++)t+=r[a];return t/e},t.mean=t.arithmeticMean,t.geometricMean=function(r){for(var t=1,e=r.length,a=0;a<e;a++)t*=r[a];return Math.pow(t,1/e)},t.logMean=function(r){for(var t=0,e=r.length,a=0;a<e;a++)t+=Math.log(r[a]);return t/e},t.grandMean=function(r,t){for(var e=0,a=0,n=r.length,i=0;i<n;i++)e+=t[i]*r[i],a+=t[i];return e/a},t.truncatedMean=function(r,t,a){void 0===a&&(a=!1),a||(r=r.slice().sort(e));for(var n=r.length,i=Math.floor(n*t),o=0,s=i;s<n-i;s++)o+=r[s];return o/(n-2*i)},t.harmonicMean=function(r){for(var t=0,e=r.length,a=0;a<e;a++){if(0===r[a])throw new RangeError("value at index "+a+"is zero");t+=1/r[a]}return e/t},t.contraHarmonicMean=function(r){for(var t=0,e=0,a=r.length,n=0;n<a;n++)t+=r[n]*r[n],e+=r[n];if(e<0)throw new RangeError("sum of values is negative");return t/e},t.median=function(r,t){void 0===t&&(t=!1),t||(r=r.slice().sort(e));var a=r.length,n=Math.floor(a/2);return a%2==0?.5*(r[n-1]+r[n]):r[n]},t.variance=function(r,e){void 0===e&&(e=!0);for(var a=t.mean(r),n=0,i=r.length,o=0;o<i;o++){var s=r[o]-a;n+=s*s}return e?n/(i-1):n/i},t.standardDeviation=function(r,e){return Math.sqrt(t.variance(r,e))},t.standardError=function(r){return t.standardDeviation(r)/Math.sqrt(r.length)},t.quartiles=function(r,a){void 0===a&&(a=!1),a||(r=r.slice()).sort(e);var n=r.length/4;return{q1:r[Math.ceil(n)-1],q2:t.median(r,!0),q3:r[Math.ceil(3*n)-1]}},t.pooledStandardDeviation=function(r,e){return Math.sqrt(t.pooledVariance(r,e))},t.pooledVariance=function(r,e){void 0===e&&(e=!0);for(var a=0,n=0,i=r.length,o=0;o<i;o++){var s=r[o],l=t.variance(s);a+=(s.length-1)*l,n+=e?s.length-1:s.length}return a/n},t.mode=function(r){var t,e=r.length,a=new Array(e);for(t=0;t<e;t++)a[t]=0;var n=new Array(e),i=0;for(t=0;t<e;t++){var o=n.indexOf(r[t]);o>=0?a[o]++:(n[i]=r[t],a[i]=1,i++)}var s=0,l=0;for(t=0;t<i;t++)a[t]>s&&(s=a[t],l=t);return n[l]},t.covariance=function(r,e,a){void 0===a&&(a=!0);var n=t.mean(r),i=t.mean(e);if(r.length!==e.length)throw"Vectors do not have the same dimensions";for(var o=0,s=r.length,l=0;l<s;l++){o+=(r[l]-n)*(e[l]-i)}return a?o/(s-1):o/s},t.skewness=function(r,e){void 0===e&&(e=!0);for(var a=t.mean(r),n=0,i=0,o=r.length,s=0;s<o;s++){var l=r[s]-a;n+=l*l,i+=l*l*l}var h=n/o,u=i/o/Math.pow(h,1.5);return e?Math.sqrt(o*(o-1))/(o-2)*u:u},t.kurtosis=function(r,e){void 0===e&&(e=!0);for(var a=t.mean(r),n=r.length,i=0,o=0,s=0;s<n;s++){var l=r[s]-a;i+=l*l,o+=l*l*l*l}var h=i/n;if(e){var u=i/(n-1);return n*(n+1)/((n-1)*(n-2)*(n-3))*(o/(u*u))-3*((n-1)*(n-1)/((n-2)*(n-3)))}return o/n/(h*h)-3},t.entropy=function(r,t){void 0===t&&(t=0);for(var e=0,a=r.length,n=0;n<a;n++)e+=r[n]*Math.log(r[n]+t);return-e},t.weightedMean=function(r,t){for(var e=0,a=r.length,n=0;n<a;n++)e+=r[n]*t[n];return e},t.weightedStandardDeviation=function(r,e){return Math.sqrt(t.weightedVariance(r,e))},t.weightedVariance=function(r,e){for(var a=t.weightedMean(r,e),n=0,i=r.length,o=0,s=0,l=0;l<i;l++){var h=r[l]-a,u=e[l];n+=u*(h*h),s+=u,o+=u*u}return n*(s/(s*s-o))},t.center=function(r,e){void 0===e&&(e=!1);var a=r;e||(a=r.slice());for(var n=t.mean(a),i=a.length,o=0;o<i;o++)a[o]-=n},t.standardize=function(r,e,a){void 0===e&&(e=t.standardDeviation(r)),void 0===a&&(a=!1);for(var n=r.length,i=a?r:new Array(n),o=0;o<n;o++)i[o]=r[o]/e;return i},t.cumulativeSum=function(r){var t=r.length,e=new Array(t);e[0]=r[0];for(var a=1;a<t;a++)e[a]=e[a-1]+r[a];return e}}),array_1=array.sum,array_2=array.max,array_3=array.min,array_4=array.minMax,array_5=array.arithmeticMean,array_6=array.mean,array_7=array.geometricMean,array_8=array.logMean,array_9=array.grandMean,array_10=array.truncatedMean,array_11=array.harmonicMean,array_12=array.contraHarmonicMean,array_13=array.median,array_14=array.variance,array_15=array.standardDeviation,array_16=array.standardError,array_17=array.quartiles,array_18=array.pooledStandardDeviation,array_19=array.pooledVariance,array_20=array.mode,array_21=array.covariance,array_22=array.skewness,array_23=array.kurtosis,array_24=array.entropy,array_25=array.weightedMean,array_26=array.weightedStandardDeviation,array_27=array.weightedVariance,array_28=array.center,array_29=array.standardize,array_30=array.cumulativeSum,defaultOptions={windowSize:9,derivative:0,polynomial:3};function SavitzkyGolay(r,t,e){if((e=extend({},defaultOptions,e)).windowSize%2==0||e.windowSize<5||!Number.isInteger(e.windowSize))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(e.windowSize>r.length)throw new RangeError("Window size is higher than the data length "+e.windowSize+">"+r.length);if(e.derivative<0||!Number.isInteger(e.derivative))throw new RangeError("Derivative should be a positive integer");if(e.polynomial<1||!Number.isInteger(e.polynomial))throw new RangeError("Polynomial should be a positive integer");e.polynomial>=6&&console.warn("You should not use polynomial grade higher than 5 if you are not sure that your data arises from such a model. Possible polynomial oscillation problems");var a=e.windowSize,n=Math.floor(a/2),i=r.length,o=new Array(i),s=fullWeights(a,e.polynomial,e.derivative),l=0,h=!0;"[object Array]"===Object.prototype.toString.call(t)?h=!1:l=Math.pow(t,e.derivative);for(var u=0;u<n;u++){for(var c=s[n-u-1],f=s[n+u+1],m=0,g=0,p=0;p<a;p++)m+=c[p]*r[p],g+=f[p]*r[i-a+p-1];h?(o[n-u-1]=m/l,o[i-n+u]=g/l):(l=getHs(t,n-u-1,n,e.derivative),o[n-u-1]=m/l,l=getHs(t,i-n+u,n,e.derivative),o[i-n+u]=g/l)}var v=s[n];for(u=a;u<i+1;u++){var d=0;for(p=0;p<a;p++)d+=v[p]*r[p+u-a];h||(l=getHs(t,u-n-1,n,e.derivative)),o[u-n-1]=d/l}return o}function getHs(r,t,e,a){for(var n=0,i=0,o=t-e;o<t+e;o++)o>=0&&o<r.length-1&&(n+=r[o+1]-r[o],i++);return Math.pow(n/i,a)}function GramPoly(r,t,e,a){return e>0?(4*e-2)/(e*(2*t-e+1))*(r*GramPoly(r,t,e-1,a)+a*GramPoly(r,t,e-1,a-1))-(e-1)*(2*t+e)/(e*(2*t-e+1))*GramPoly(r,t,e-2,a):0==e&&0==a?1:0}function GenFact(r,t){var e=1;if(r>=t)for(var a=r-t+1;a<=r;a++)e*=a;return e}function Weight(r,t,e,a,n){for(var i=0,o=0;o<=a;o++)i+=(2*o+1)*(GenFact(2*e,o)/GenFact(2*e+o+1,o+1))*GramPoly(r,e,o,0)*GramPoly(t,e,o,n);return i}function fullWeights(r,t,e){for(var a=new Array(r),n=Math.floor(r/2),i=-n;i<=n;i++){a[i+n]=new Array(r);for(var o=-n;o<=n;o++)a[i+n][o+n]=Weight(o,i,n,t,e)}return a}var src$1=SavitzkyGolay;const defaultOptions$1={sgOptions:{windowSize:9,polynomial:3},minMaxRatio:25e-5,broadRatio:0,maxCriteria:!0,smoothY:!0,realTopDetection:!1,heightFactor:0,boundaries:!1,derivativeThreshold:-1};function gsd(r,t,e){let a=(e=Object.assign({},defaultOptions$1,e)).sgOptions;const n=[].concat(t);if(!("noiseLevel"in e)){var i,o=0,s=Number.MAX_VALUE;for(let t=0;t<r.length-1;++t)(i=Math.abs(r[t+1]-r[t]))<s&&(s=i),i>o&&(o=i);e.noiseLevel=(o-s)/o<.05?getNoiseLevel(n):0}const l={m:1,b:e.noiseLevel};e.maxCriteria||(l.m=-1,l.b*=-1);for(let r=0;r<n.length;r++)n[r]=l.m*n[r]-l.b;for(let r=0;r<n.length;r++)n[r]<0&&(n[r]=0);let h,u,c=n;(o-s)/o<.05?(e.smoothY&&(c=src$1(n,r[1]-r[0],{windowSize:a.windowSize,polynomial:a.polynomial,derivative:0})),h=src$1(n,r[1]-r[0],{windowSize:a.windowSize,polynomial:a.polynomial,derivative:1}),u=src$1(n,r[1]-r[0],{windowSize:a.windowSize,polynomial:a.polynomial,derivative:2})):(e.smoothY&&(c=src$1(n,r,{windowSize:a.windowSize,polynomial:a.polynomial,derivative:0})),h=src$1(n,r,{windowSize:a.windowSize,polynomial:a.polynomial,derivative:1}),u=src$1(n,r,{windowSize:a.windowSize,polynomial:a.polynomial,derivative:2}));const f=r,m=r[1]-r[0];var g=0,p=0;for(let r=0;r<c.length;r++)Math.abs(u[r])>g&&(g=Math.abs(u[r])),Math.abs(c[r])>p&&(p=Math.abs(c[r]));var v=null,d=null,w=new Array(c.length-2),y=new Array(c.length),x=new Array(c.length),M=new Array(c.length-2),b=0,$=0,A=0,S=0;for(let r=1;r<c.length-1;++r)Math.abs(h[r])>e.derivativeThreshold&&((h[r]<h[r-1]&&h[r]<=h[r+1]||h[r]<=h[r-1]&&h[r]<h[r+1])&&(d={x:f[r],index:r},m>0&&null!==v&&(y[$++]=v,x[A++]=d)),(h[r]>=h[r-1]&&h[r]>h[r+1]||h[r]>h[r-1]&&h[r]>=h[r+1])&&(v={x:f[r],index:r},m<0&&null!==d&&(y[$++]=v,x[A++]=d))),u[r]<u[r-1]&&u[r]<u[r+1]&&(w[b++]=r,M[S++]=Math.abs(u[r])<=e.broadRatio*g);w.length=b,y.length=$,x.length=A,M.length=S;let k,_,E,z,R,C=new Array(w.length),D=0,V=-1;for(let r=0;r<w.length;++r){_=f[w[r]],k=-1;let t=V+1;for(z=Number.MAX_VALUE,E=0,R=!0;-1===k&&t<y.length&&R;)(E=Math.abs(_-(y[t].x+x[t].x)/2))<z?z=E:R=!1,E<Math.abs(y[t].x-x[t].x)/2&&(k=t,V=t),++t;if(-1!==k&&Math.abs(c[w[r]])>e.minMaxRatio*p&&(C[D++]={index:w[r],x:_,y:(c[w[r]]+l.b)/l.m,width:Math.abs(x[k].x-y[k].x),soft:M[r]},e.boundaries&&(C[D-1].left=y[k],C[D-1].right=x[k]),e.heightFactor)){let r=c[y[k].index],t=c[x[k].index];C[D-1].height=e.heightFactor*(C[D-1].y-(r+t)/2)}}C.length=D,e.realTopDetection&&realTopDetection(C,f,c);for(let r=0;r<C.length;r++)C[r].base=e.noiseLevel;return C.sort(function(r,t){return r.x-t.x}),C}function getNoiseLevel(r){var t=0,e=r.length;for(let a=0;a<e;++a)t+=r[a];t/=e;var a=new Array(e);for(let n=0;n<e;++n)a[n]=Math.abs(r[n]-t);return a.sort(),e%2==1?a[(e-1)/2]/.6745:.5*(a[e/2]+a[e/2-1])/.6745}function realTopDetection(r,t,e){for(var a,n,i,o,s,l=0;l<r.length;l++)e[(s=r[l].index)-1]>=e[s-2]&&e[s-1]>=e[s]?s--:e[s+1]>=e[s]&&e[s+1]>=e[s+2]?s++:e[s-2]>=e[s-3]&&e[s-2]>=e[s-1]?s-=2:e[s+2]>=e[s+1]&&e[s+2]>=e[s+3]&&(s+=2),e[s-1]>0&&e[s+1]>0&&e[s]>=e[s-1]&&e[s]>=e[s+1]&&(a=20*Math.log10(e[s-1]),n=20*Math.log10(e[s]),o=.5*(a-(i=20*Math.log10(e[s+1])))/(a-2*n+i),r[l].x=t[s]+(t[s]-t[s-1])*o,r[l].y=e[s]-.25*(e[s-1]-e[s+1])*o)}var gsd_1=gsd;Symbol.species||(Symbol.species=Symbol.for("@@species"));var symbolSpecies=Object.freeze({});function LuDecomposition(r){if(!(this instanceof LuDecomposition))return new LuDecomposition(r);var t,e,a,n,i,o,s,l,h,u,c=(r=matrix$2.Matrix.checkMatrix(r)).clone(),f=c.rows,m=c.columns,g=new Array(f),p=1;for(t=0;t<f;t++)g[t]=t;for(h=new Array(f),e=0;e<m;e++){for(t=0;t<f;t++)h[t]=c[t][e];for(t=0;t<f;t++){for(l=c[t],u=Math.min(t,e),i=0,a=0;a<u;a++)i+=l[a]*h[a];l[e]=h[t]-=i}for(n=e,t=e+1;t<f;t++)Math.abs(h[t])>Math.abs(h[n])&&(n=t);if(n!==e){for(a=0;a<m;a++)o=c[n][a],c[n][a]=c[e][a],c[e][a]=o;s=g[n],g[n]=g[e],g[e]=s,p=-p}if(e<f&&0!==c[e][e])for(t=e+1;t<f;t++)c[t][e]/=c[e][e]}this.LU=c,this.pivotVector=g,this.pivotSign=p}LuDecomposition.prototype={isSingular:function(){for(var r=this.LU,t=r.columns,e=0;e<t;e++)if(0===r[e][e])return!0;return!1},get determinant(){var r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");for(var t=this.pivotSign,e=r.columns,a=0;a<e;a++)t*=r[a][a];return t},get lowerTriangularMatrix(){for(var r=this.LU,t=r.rows,e=r.columns,a=new matrix$2.Matrix(t,e),n=0;n<t;n++)for(var i=0;i<e;i++)a[n][i]=n>i?r[n][i]:n===i?1:0;return a},get upperTriangularMatrix(){for(var r=this.LU,t=r.rows,e=r.columns,a=new matrix$2.Matrix(t,e),n=0;n<t;n++)for(var i=0;i<e;i++)a[n][i]=n<=i?r[n][i]:0;return a},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(r){r=matrix$2.Matrix.checkMatrix(r);var t=this.LU;if(t.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var e,a,n,i=r.columns,o=r.subMatrixRow(this.pivotVector,0,i-1),s=t.columns;for(n=0;n<s;n++)for(e=n+1;e<s;e++)for(a=0;a<i;a++)o[e][a]-=o[n][a]*t[e][n];for(n=s-1;n>=0;n--){for(a=0;a<i;a++)o[n][a]/=t[n][n];for(e=0;e<n;e++)for(a=0;a<i;a++)o[e][a]-=o[n][a]*t[e][n]}return o}};var lu=LuDecomposition,hypotenuse=function(r,t){var e;return Math.abs(r)>Math.abs(t)?(e=t/r,Math.abs(r)*Math.sqrt(1+e*e)):0!==t?(e=r/t,Math.abs(t)*Math.sqrt(1+e*e)):0},getEmpty2DArray=function(r,t){for(var e=new Array(r),a=0;a<r;a++)e[a]=new Array(t);return e},getFilled2DArray=function(r,t,e){for(var a=new Array(r),n=0;n<r;n++){a[n]=new Array(t);for(var i=0;i<t;i++)a[n][i]=e}return a},util={hypotenuse:hypotenuse,getEmpty2DArray:getEmpty2DArray,getFilled2DArray:getFilled2DArray},hypotenuse$1=util.hypotenuse,getFilled2DArray$1=util.getFilled2DArray;function SingularValueDecomposition(r,t){if(!(this instanceof SingularValueDecomposition))return new SingularValueDecomposition(r,t);t=t||{};var e=(r=matrix$2.Matrix.checkMatrix(r)).rows,a=r.columns,n=Math.min(e,a),i=!0,o=!0;!1===t.computeLeftSingularVectors&&(i=!1),!1===t.computeRightSingularVectors&&(o=!1);var s,l=!0===t.autoTranspose,h=!1;if(e<a)if(l){e=(s=r.transpose()).rows,a=s.columns,h=!0;var u=i;i=o,o=u}else s=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else s=r.clone();var c,f,m,g,p,v,d,w,y,x,M,b,$,A,S,k,_,E,z,R,C,D=new Array(Math.min(e+1,a)),V=getFilled2DArray$1(e,n,0),O=getFilled2DArray$1(a,a,0),T=new Array(a),F=new Array(e),q=Math.min(e-1,a),I=Math.max(0,Math.min(a-2,e));for(m=0,x=Math.max(q,I);m<x;m++){if(m<q){for(D[m]=0,c=m;c<e;c++)D[m]=hypotenuse$1(D[m],s[c][m]);if(0!==D[m]){for(s[m][m]<0&&(D[m]=-D[m]),c=m;c<e;c++)s[c][m]/=D[m];s[m][m]+=1}D[m]=-D[m]}for(f=m+1;f<a;f++){if(m<q&&0!==D[m]){for(p=0,c=m;c<e;c++)p+=s[c][m]*s[c][f];for(p=-p/s[m][m],c=m;c<e;c++)s[c][f]+=p*s[c][m]}T[f]=s[m][f]}if(i&&m<q)for(c=m;c<e;c++)V[c][m]=s[c][m];if(m<I){for(T[m]=0,c=m+1;c<a;c++)T[m]=hypotenuse$1(T[m],T[c]);if(0!==T[m]){for(T[m+1]<0&&(T[m]=0-T[m]),c=m+1;c<a;c++)T[c]/=T[m];T[m+1]+=1}if(T[m]=-T[m],m+1<e&&0!==T[m]){for(c=m+1;c<e;c++)F[c]=0;for(f=m+1;f<a;f++)for(c=m+1;c<e;c++)F[c]+=T[f]*s[c][f];for(f=m+1;f<a;f++)for(p=-T[f]/T[m+1],c=m+1;c<e;c++)s[c][f]+=p*F[c]}if(o)for(c=m+1;c<a;c++)O[c][m]=T[c]}}if(g=Math.min(a,e+1),q<a&&(D[q]=s[q][q]),e<g&&(D[g-1]=0),I+1<g&&(T[I]=s[I][g-1]),T[g-1]=0,i){for(f=q;f<n;f++){for(c=0;c<e;c++)V[c][f]=0;V[f][f]=1}for(m=q-1;m>=0;m--)if(0!==D[m]){for(f=m+1;f<n;f++){for(p=0,c=m;c<e;c++)p+=V[c][m]*V[c][f];for(p=-p/V[m][m],c=m;c<e;c++)V[c][f]+=p*V[c][m]}for(c=m;c<e;c++)V[c][m]=-V[c][m];for(V[m][m]=1+V[m][m],c=0;c<m-1;c++)V[c][m]=0}else{for(c=0;c<e;c++)V[c][m]=0;V[m][m]=1}}if(o)for(m=a-1;m>=0;m--){if(m<I&&0!==T[m])for(f=m+1;f<a;f++){for(p=0,c=m+1;c<a;c++)p+=O[c][m]*O[c][f];for(p=-p/O[m+1][m],c=m+1;c<a;c++)O[c][f]+=p*O[c][m]}for(c=0;c<a;c++)O[c][m]=0;O[m][m]=1}for(var j=g-1,L=Math.pow(2,-52);g>0;){for(m=g-2;m>=-1&&-1!==m;m--)if(Math.abs(T[m])<=L*(Math.abs(D[m])+Math.abs(D[m+1]))){T[m]=0;break}if(m===g-2)M=4;else{for(v=g-1;v>=m&&v!==m;v--)if(p=(v!==g?Math.abs(T[v]):0)+(v!==m+1?Math.abs(T[v-1]):0),Math.abs(D[v])<=L*p){D[v]=0;break}v===m?M=3:v===g-1?M=1:(M=2,m=v)}switch(m++,M){case 1:for(d=T[g-2],T[g-2]=0,f=g-2;f>=m;f--)if(p=hypotenuse$1(D[f],d),w=D[f]/p,y=d/p,D[f]=p,f!==m&&(d=-y*T[f-1],T[f-1]=w*T[f-1]),o)for(c=0;c<a;c++)p=w*O[c][f]+y*O[c][g-1],O[c][g-1]=-y*O[c][f]+w*O[c][g-1],O[c][f]=p;break;case 2:for(d=T[m-1],T[m-1]=0,f=m;f<g;f++)if(p=hypotenuse$1(D[f],d),w=D[f]/p,y=d/p,D[f]=p,d=-y*T[f],T[f]=w*T[f],i)for(c=0;c<e;c++)p=w*V[c][f]+y*V[c][m-1],V[c][m-1]=-y*V[c][f]+w*V[c][m-1],V[c][f]=p;break;case 3:for(b=Math.max(Math.max(Math.max(Math.max(Math.abs(D[g-1]),Math.abs(D[g-2])),Math.abs(T[g-2])),Math.abs(D[m])),Math.abs(T[m])),$=D[g-1]/b,A=D[g-2]/b,S=T[g-2]/b,k=D[m]/b,_=T[m]/b,z=$*S*($*S),R=0,0===(E=((A+$)*(A-$)+S*S)/2)&&0===z||(R=Math.sqrt(E*E+z),E<0&&(R=-R),R=z/(E+R)),d=(k+$)*(k-$)+R,C=k*_,f=m;f<g-1;f++){if(w=d/(p=hypotenuse$1(d,C)),y=C/p,f!==m&&(T[f-1]=p),d=w*D[f]+y*T[f],T[f]=w*T[f]-y*D[f],C=y*D[f+1],D[f+1]=w*D[f+1],o)for(c=0;c<a;c++)p=w*O[c][f]+y*O[c][f+1],O[c][f+1]=-y*O[c][f]+w*O[c][f+1],O[c][f]=p;if(w=d/(p=hypotenuse$1(d,C)),y=C/p,D[f]=p,d=w*T[f]+y*D[f+1],D[f+1]=-y*T[f]+w*D[f+1],C=y*T[f+1],T[f+1]=w*T[f+1],i&&f<e-1)for(c=0;c<e;c++)p=w*V[c][f]+y*V[c][f+1],V[c][f+1]=-y*V[c][f]+w*V[c][f+1],V[c][f]=p}T[g-2]=d;break;case 4:if(D[m]<=0&&(D[m]=D[m]<0?-D[m]:0,o))for(c=0;c<=j;c++)O[c][m]=-O[c][m];for(;m<j&&!(D[m]>=D[m+1]);){if(p=D[m],D[m]=D[m+1],D[m+1]=p,o&&m<a-1)for(c=0;c<a;c++)p=O[c][m+1],O[c][m+1]=O[c][m],O[c][m]=p;if(i&&m<e-1)for(c=0;c<e;c++)p=V[c][m+1],V[c][m+1]=V[c][m],V[c][m]=p;m++}g--}}if(h){var P=O;O=V,V=P}this.m=e,this.n=a,this.s=D,this.U=V,this.V=O}SingularValueDecomposition.prototype={get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var r=Math.pow(2,-52),t=Math.max(this.m,this.n)*this.s[0]*r,e=0,a=this.s,n=0,i=a.length;n<i;n++)a[n]>t&&e++;return e},get diagonal(){return this.s},get threshold(){return Math.pow(2,-52)/2*Math.max(this.m,this.n)*this.s[0]},get leftSingularVectors(){return matrix$2.Matrix.isMatrix(this.U)||(this.U=new matrix$2.Matrix(this.U)),this.U},get rightSingularVectors(){return matrix$2.Matrix.isMatrix(this.V)||(this.V=new matrix$2.Matrix(this.V)),this.V},get diagonalMatrix(){return matrix$2.Matrix.diag(this.s)},solve:function(r){var t,e=r,a=this.threshold,n=this.s.length,i=matrix$2.Matrix.zeros(n,n);for(t=0;t<n;t++)Math.abs(this.s[t])<=a?i[t][t]=0:i[t][t]=1/this.s[t];var o,s,l,h=this.U,u=this.rightSingularVectors,c=u.mmul(i),f=u.rows,m=h.length,g=matrix$2.Matrix.zeros(f,m);for(t=0;t<f;t++)for(o=0;o<m;o++){for(l=0,s=0;s<n;s++)l+=c[t][s]*h[o][s];g[t][o]=l}return g.mmul(e)},solveForDiagonal:function(r){return this.solve(matrix$2.Matrix.diag(r))},inverse:function(){var r,t,e=this.V,a=this.threshold,n=e.length,i=e[0].length,o=new matrix$2.Matrix(n,this.s.length);for(r=0;r<n;r++)for(t=0;t<i;t++)Math.abs(this.s[t])>a?o[r][t]=e[r][t]/this.s[t]:o[r][t]=0;var s,l,h=this.U,u=h.length,c=h[0].length,f=new matrix$2.Matrix(n,u);for(r=0;r<n;r++)for(t=0;t<u;t++){for(l=0,s=0;s<c;s++)l+=o[r][s]*h[t][s];f[r][t]=l}return f}};var svd=SingularValueDecomposition,array$1=createCommonjsModule(function(r,t){function e(r,t){return r-t}t.sum=function(r){for(var t=0,e=0;e<r.length;e++)t+=r[e];return t},t.max=function(r){for(var t=r[0],e=r.length,a=1;a<e;a++)r[a]>t&&(t=r[a]);return t},t.min=function(r){for(var t=r[0],e=r.length,a=1;a<e;a++)r[a]<t&&(t=r[a]);return t},t.minMax=function(r){for(var t=r[0],e=r[0],a=r.length,n=1;n<a;n++)r[n]<t&&(t=r[n]),r[n]>e&&(e=r[n]);return{min:t,max:e}},t.arithmeticMean=function(r){for(var t=0,e=r.length,a=0;a<e;a++)t+=r[a];return t/e},t.mean=t.arithmeticMean,t.geometricMean=function(r){for(var t=1,e=r.length,a=0;a<e;a++)t*=r[a];return Math.pow(t,1/e)},t.logMean=function(r){for(var t=0,e=r.length,a=0;a<e;a++)t+=Math.log(r[a]);return t/e},t.grandMean=function(r,t){for(var e=0,a=0,n=r.length,i=0;i<n;i++)e+=t[i]*r[i],a+=t[i];return e/a},t.truncatedMean=function(r,t,a){void 0===a&&(a=!1),a||(r=[].concat(r).sort(e));for(var n=r.length,i=Math.floor(n*t),o=0,s=i;s<n-i;s++)o+=r[s];return o/(n-2*i)},t.harmonicMean=function(r){for(var t=0,e=r.length,a=0;a<e;a++){if(0===r[a])throw new RangeError("value at index "+a+"is zero");t+=1/r[a]}return e/t},t.contraHarmonicMean=function(r){for(var t=0,e=0,a=r.length,n=0;n<a;n++)t+=r[n]*r[n],e+=r[n];if(e<0)throw new RangeError("sum of values is negative");return t/e},t.median=function(r,t){void 0===t&&(t=!1),t||(r=[].concat(r).sort(e));var a=r.length,n=Math.floor(a/2);return a%2==0?.5*(r[n-1]+r[n]):r[n]},t.variance=function(r,e){void 0===e&&(e=!0);for(var a=t.mean(r),n=0,i=r.length,o=0;o<i;o++){var s=r[o]-a;n+=s*s}return e?n/(i-1):n/i},t.standardDeviation=function(r,e){return Math.sqrt(t.variance(r,e))},t.standardError=function(r){return t.standardDeviation(r)/Math.sqrt(r.length)},t.robustMeanAndStdev=function(r){var t=0,a=r.length,n=0;for(n=0;n<a;n++)t+=r[n];t/=a;var i=new Array(a);for(n=0;n<a;n++)i[n]=Math.abs(r[n]-t);return i.sort(e),{mean:t,stdev:a%2==1?i[(a-1)/2]/.6745:.5*(i[a/2]+i[a/2-1])/.6745}},t.quartiles=function(r,a){void 0===a&&(a=!1),a||(r=[].concat(r).sort(e));var n=r.length/4;return{q1:r[Math.ceil(n)-1],q2:t.median(r,!0),q3:r[Math.ceil(3*n)-1]}},t.pooledStandardDeviation=function(r,e){return Math.sqrt(t.pooledVariance(r,e))},t.pooledVariance=function(r,e){void 0===e&&(e=!0);for(var a=0,n=0,i=r.length,o=0;o<i;o++){var s=r[o],l=t.variance(s);a+=(s.length-1)*l,n+=e?s.length-1:s.length}return a/n},t.mode=function(r){var t,e=r.length,a=new Array(e);for(t=0;t<e;t++)a[t]=0;var n=new Array(e),i=0;for(t=0;t<e;t++){var o=n.indexOf(r[t]);o>=0?a[o]++:(n[i]=r[t],a[i]=1,i++)}var s=0,l=0;for(t=0;t<i;t++)a[t]>s&&(s=a[t],l=t);return n[l]},t.covariance=function(r,e,a){void 0===a&&(a=!0);var n=t.mean(r),i=t.mean(e);if(r.length!==e.length)throw"Vectors do not have the same dimensions";for(var o=0,s=r.length,l=0;l<s;l++){o+=(r[l]-n)*(e[l]-i)}return a?o/(s-1):o/s},t.skewness=function(r,e){void 0===e&&(e=!0);for(var a=t.mean(r),n=0,i=0,o=r.length,s=0;s<o;s++){var l=r[s]-a;n+=l*l,i+=l*l*l}var h=n/o,u=i/o/Math.pow(h,1.5);return e?Math.sqrt(o*(o-1))/(o-2)*u:u},t.kurtosis=function(r,e){void 0===e&&(e=!0);for(var a=t.mean(r),n=r.length,i=0,o=0,s=0;s<n;s++){var l=r[s]-a;i+=l*l,o+=l*l*l*l}var h=i/n;if(e){var u=i/(n-1);return n*(n+1)/((n-1)*(n-2)*(n-3))*(o/(u*u))-3*((n-1)*(n-1)/((n-2)*(n-3)))}return o/n/(h*h)-3},t.entropy=function(r,t){void 0===t&&(t=0);for(var e=0,a=r.length,n=0;n<a;n++)e+=r[n]*Math.log(r[n]+t);return-e},t.weightedMean=function(r,t){for(var e=0,a=r.length,n=0;n<a;n++)e+=r[n]*t[n];return e},t.weightedStandardDeviation=function(r,e){return Math.sqrt(t.weightedVariance(r,e))},t.weightedVariance=function(r,e){for(var a=t.weightedMean(r,e),n=0,i=r.length,o=0,s=0,l=0;l<i;l++){var h=r[l]-a,u=e[l];n+=u*(h*h),s+=u,o+=u*u}return n*(s/(s*s-o))},t.center=function(r,e){void 0===e&&(e=!1);var a=r;e||(a=[].concat(r));for(var n=t.mean(a),i=a.length,o=0;o<i;o++)a[o]-=n},t.standardize=function(r,e,a){void 0===e&&(e=t.standardDeviation(r)),void 0===a&&(a=!1);for(var n=r.length,i=a?r:new Array(n),o=0;o<n;o++)i[o]=r[o]/e;return i},t.cumulativeSum=function(r){var t=r.length,e=new Array(t);e[0]=r[0];for(var a=1;a<t;a++)e[a]=e[a-1]+r[a];return e}}),array_1$1=array$1.sum,array_2$1=array$1.max,array_3$1=array$1.min,array_4$1=array$1.minMax,array_5$1=array$1.arithmeticMean,array_6$1=array$1.mean,array_7$1=array$1.geometricMean,array_8$1=array$1.logMean,array_9$1=array$1.grandMean,array_10$1=array$1.truncatedMean,array_11$1=array$1.harmonicMean,array_12$1=array$1.contraHarmonicMean,array_13$1=array$1.median,array_14$1=array$1.variance,array_15$1=array$1.standardDeviation,array_16$1=array$1.standardError,array_17$1=array$1.robustMeanAndStdev,array_18$1=array$1.quartiles,array_19$1=array$1.pooledStandardDeviation,array_20$1=array$1.pooledVariance,array_21$1=array$1.mode,array_22$1=array$1.covariance,array_23$1=array$1.skewness,array_24$1=array$1.kurtosis,array_25$1=array$1.entropy,array_26$1=array$1.weightedMean,array_27$1=array$1.weightedStandardDeviation,array_28$1=array$1.weightedVariance,array_29$1=array$1.center,array_30$1=array$1.standardize,array_31=array$1.cumulativeSum,matrix=createCommonjsModule(function(r,t){function e(r,t){return r-t}t.max=function(r){for(var t=-1/0,e=0;e<r.length;e++)for(var a=0;a<r[e].length;a++)r[e][a]>t&&(t=r[e][a]);return t},t.min=function(r){for(var t=1/0,e=0;e<r.length;e++)for(var a=0;a<r[e].length;a++)r[e][a]<t&&(t=r[e][a]);return t},t.minMax=function(r){for(var t=1/0,e=-1/0,a=0;a<r.length;a++)for(var n=0;n<r[a].length;n++)r[a][n]<t&&(t=r[a][n]),r[a][n]>e&&(e=r[a][n]);return{min:t,max:e}},t.entropy=function(r,t){void 0===t&&(t=0);for(var e=0,a=r.length,n=r[0].length,i=0;i<a;i++)for(var o=0;o<n;o++)e+=r[i][o]*Math.log(r[i][o]+t);return-e},t.mean=function(r,t){void 0===t&&(t=0);var e,a,n,i,o=r.length,s=r[0].length;if(-1===t){for(e=[0],a=o*s,n=0;n<o;n++)for(i=0;i<s;i++)e[0]+=r[n][i];e[0]/=a}else if(0===t)for(e=new Array(s),a=o,i=0;i<s;i++){for(e[i]=0,n=0;n<o;n++)e[i]+=r[n][i];e[i]/=a}else{if(1!==t)throw new Error("Invalid dimension");for(e=new Array(o),a=s,i=0;i<o;i++){for(e[i]=0,n=0;n<s;n++)e[i]+=r[i][n];e[i]/=a}}return e},t.sum=function(r,t){void 0===t&&(t=0);var e,a,n,i=r.length,o=r[0].length;if(-1===t)for(e=[0],a=0;a<i;a++)for(n=0;n<o;n++)e[0]+=r[a][n];else if(0===t)for(e=new Array(o),n=0;n<o;n++)for(e[n]=0,a=0;a<i;a++)e[n]+=r[a][n];else{if(1!==t)throw new Error("Invalid dimension");for(e=new Array(i),n=0;n<i;n++)for(e[n]=0,a=0;a<o;a++)e[n]+=r[n][a]}return e},t.product=function(r,t){void 0===t&&(t=0);var e,a,n,i=r.length,o=r[0].length;if(-1===t)for(e=[1],a=0;a<i;a++)for(n=0;n<o;n++)e[0]*=r[a][n];else if(0===t)for(e=new Array(o),n=0;n<o;n++)for(e[n]=1,a=0;a<i;a++)e[n]*=r[a][n];else{if(1!==t)throw new Error("Invalid dimension");for(e=new Array(i),n=0;n<i;n++)for(e[n]=1,a=0;a<o;a++)e[n]*=r[n][a]}return e},t.standardDeviation=function(r,e,a){for(var n=t.variance(r,e,a),i=n.length,o=0;o<i;o++)n[o]=Math.sqrt(n[o]);return n},t.variance=function(r,e,a){void 0===a&&(a=!0),e=e||t.mean(r);var n=r.length;if(0===n)return[];for(var i=r[0].length,o=new Array(i),s=0;s<i;s++){for(var l=0,h=0,u=0,c=0;c<n;c++)l+=u=r[c][s]-e[s],h+=u*u;o[s]=a?(h-l*l/n)/(n-1):(h-l*l/n)/n}return o},t.median=function(r){for(var t=r.length,a=r[0].length,n=new Array(a),i=0;i<a;i++){for(var o=new Array(t),s=0;s<t;s++)o[s]=r[s][i];o.sort(e);var l=o.length;n[i]=l%2==0?.5*(o[l/2]+o[l/2-1]):o[Math.floor(l/2)]}return n},t.mode=function(r){var t,e,a=r.length,n=r[0].length,i=new Array(n);for(t=0;t<n;t++){for(var o=new Array(a),s=0;s<a;s++)o[s]=0;var l=new Array(a),h=0;for(e=0;e<a;e++){var u=l.indexOf(r[e][t]);u>=0?o[u]++:(l[h]=r[e][t],o[h]=1,h++)}var c=0,f=0;for(e=0;e<h;e++)o[e]>c&&(c=o[e],f=e);i[t]=l[f]}return i},t.skewness=function(r,e){void 0===e&&(e=!0);for(var a=t.mean(r),n=r.length,i=a.length,o=new Array(i),s=0;s<i;s++){for(var l=0,h=0,u=0;u<n;u++){var c=r[u][s]-a[s];l+=c*c,h+=c*c*c}var f=l/n,m=h/n/Math.pow(f,1.5);if(e){var g=Math.sqrt(n*(n-1)),p=n-2;o[s]=g/p*m}else o[s]=m}return o},t.kurtosis=function(r,e){void 0===e&&(e=!0);for(var a=t.mean(r),n=r.length,i=r[0].length,o=new Array(i),s=0;s<i;s++){for(var l=0,h=0,u=0;u<n;u++){var c=r[u][s]-a[s];l+=c*c,h+=c*c*c*c}var f=l/n,m=h/n;if(e){var g=l/(n-1),p=n*(n+1)/((n-1)*(n-2)*(n-3)),v=h/(g*g),d=(n-1)*(n-1)/((n-2)*(n-3));o[s]=p*v-3*d}else o[s]=m/(f*f)-3}return o},t.standardError=function(r){for(var e=r.length,a=t.standardDeviation(r),n=a.length,i=new Array(n),o=Math.sqrt(e),s=0;s<n;s++)i[s]=a[s]/o;return i},t.covariance=function(r,e){return t.scatter(r,void 0,e)},t.scatter=function(r,e,a){void 0===a&&(a=0),void 0===e&&(0===a?e=r.length-1:1===a&&(e=r[0].length-1));var n=t.mean(r,a),i=r.length;if(0===i)return[[]];var o,s,l,h,u,c=r[0].length;if(0===a){for(o=new Array(c),s=0;s<c;s++)o[s]=new Array(c);for(s=0;s<c;s++)for(l=s;l<c;l++){for(h=0,u=0;u<i;u++)h+=(r[u][l]-n[l])*(r[u][s]-n[s]);h/=e,o[s][l]=h,o[l][s]=h}}else{if(1!==a)throw new Error("Invalid dimension");for(o=new Array(i),s=0;s<i;s++)o[s]=new Array(i);for(s=0;s<i;s++)for(l=s;l<i;l++){for(h=0,u=0;u<c;u++)h+=(r[l][u]-n[l])*(r[s][u]-n[s]);h/=e,o[s][l]=h,o[l][s]=h}}return o},t.correlation=function(r){var e,a,n=t.mean(r),i=t.standardDeviation(r,!0,n),o=t.zScores(r,n,i),s=r.length,l=r[0].length,h=new Array(l);for(e=0;e<l;e++)h[e]=new Array(l);for(e=0;e<l;e++)for(a=e;a<l;a++){for(var u=0,c=0,f=o.length;c<f;c++)u+=o[c][a]*o[c][e];u/=s-1,h[e][a]=u,h[a][e]=u}return h},t.zScores=function(r,e,a){return e=e||t.mean(r),void 0===a&&(a=t.standardDeviation(r,!0,e)),t.standardize(t.center(r,e,!1),a,!0)},t.center=function(r,e,a){e=e||t.mean(r);var n,i,o,s=r,l=r.length;if(!a)for(s=new Array(l),n=0;n<l;n++)s[n]=new Array(r[n].length);for(n=0;n<l;n++){var h=s[n];for(i=0,o=h.length;i<o;i++)h[i]=r[n][i]-e[i]}return s},t.standardize=function(r,e,a){void 0===e&&(e=t.standardDeviation(r));var n,i,o,s=r,l=r.length;if(!a)for(s=new Array(l),n=0;n<l;n++)s[n]=new Array(r[n].length);for(n=0;n<l;n++){var h=s[n],u=r[n];for(i=0,o=h.length;i<o;i++)0===e[i]||isNaN(e[i])||(h[i]=u[i]/e[i])}return s},t.weightedVariance=function(r,e){var a=t.mean(r),n=r.length;if(0===n)return[];for(var i=r[0].length,o=new Array(i),s=0;s<i;s++){for(var l=0,h=0,u=0,c=0;c<n;c++){var f=r[c][s]-a[s],m=e[c];l+=m*(f*f),u+=m,h+=m*m}o[s]=l*(u/(u*u-h))}return o},t.weightedMean=function(r,t,e){void 0===e&&(e=0);var a=r.length;if(0===a)return[];var n,i,o,s,l,h,u=r[0].length;if(0===e){for(n=new Array(u),i=0;i<u;i++)n[i]=0;for(i=0;i<a;i++)for(h=r[i],l=t[i],s=0;s<u;s++)n[s]+=h[s]*l}else{if(1!==e)throw new Error("Invalid dimension");for(n=new Array(a),i=0;i<a;i++)n[i]=0;for(s=0;s<a;s++)for(h=r[s],l=t[s],i=0;i<u;i++)n[s]+=h[i]*l}var c=array$1.sum(t);if(0!==c)for(i=0,o=n.length;i<o;i++)n[i]/=c;return n},t.weightedCovariance=function(r,e,a,n){n=n||0,a=a||t.weightedMean(r,e,n);for(var i=0,o=0,s=0,l=e.length;s<l;s++)i+=e[s],o+=e[s]*e[s];var h=i/(i*i-o);return t.weightedScatter(r,e,a,h,n)},t.weightedScatter=function(r,e,a,n,i){i=i||0,a=a||t.weightedMean(r,e,i),void 0===n&&(n=1);var o=r.length;if(0===o)return[[]];var s,l,h,u,c,f=r[0].length;if(0===i){for(s=new Array(f),l=0;l<f;l++)s[l]=new Array(f);for(l=0;l<f;l++)for(h=l;h<f;h++){for(c=0,u=0;u<o;u++)c+=e[u]*(r[u][h]-a[h])*(r[u][l]-a[l]);s[l][h]=c*n,s[h][l]=c*n}}else{if(1!==i)throw new Error("Invalid dimension");for(s=new Array(o),l=0;l<o;l++)s[l]=new Array(o);for(l=0;l<o;l++)for(h=l;h<o;h++){for(c=0,u=0;u<f;u++)c+=e[u]*(r[h][u]-a[h])*(r[l][u]-a[l]);s[l][h]=c*n,s[h][l]=c*n}}return s}}),matrix_1=matrix.max,matrix_2=matrix.min,matrix_3=matrix.minMax,matrix_4=matrix.entropy,matrix_5=matrix.mean,matrix_6=matrix.sum,matrix_7=matrix.product,matrix_8=matrix.standardDeviation,matrix_9=matrix.variance,matrix_10=matrix.median,matrix_11=matrix.mode,matrix_12=matrix.skewness,matrix_13=matrix.kurtosis,matrix_14=matrix.standardError,matrix_15=matrix.covariance,matrix_16=matrix.scatter,matrix_17=matrix.correlation,matrix_18=matrix.zScores,matrix_19=matrix.center,matrix_20=matrix.standardize,matrix_21=matrix.weightedVariance,matrix_22=matrix.weightedMean,matrix_23=matrix.weightedCovariance,matrix_24=matrix.weightedScatter,array$2=array$1,matrix$1=matrix,mlStat={array:array$2,matrix:matrix$1};const Stat=mlStat.array;function coordArrayToPoints(r,t){if(r.length%t!=0)throw new RangeError("Dimensions number must be accordance with the size of the array.");for(var e=r.length/t,a=new Array(e),n=0,i=0;i<r.length;i+=t){for(var o=new Array(t),s=0;s<t;++s)o[s]=r[i+s];a[n]=o,n++}return a}function coordArrayToCoordMatrix(r,t){if(r.length%t!=0)throw new RangeError("Dimensions number must be accordance with the size of the array.");for(var e=new Array(t),a=r.length/t,n=0;n<e.length;n++)e[n]=new Array(a);for(n=0;n<r.length;n+=t)for(var i=0;i<t;++i){var o=Math.floor(n/t);e[i][o]=r[n+i]}return e}function coordMatrixToCoordArray(r){for(var t=new Array(r.length*r[0].length),e=0,a=0;a<r[0].length;++a)for(var n=0;n<r.length;++n)t[e]=r[n][a],++e;return t}function transpose(r){for(var t=new Array(r[0].length),e=0;e<t.length;++e)t[e]=new Array(r.length);for(e=0;e<r.length;++e)for(var a=0;a<r[0].length;++a)t[a][e]=r[e][a];return t}function pointsToCoordArray(r){for(var t=new Array(r.length*r[0].length),e=0,a=0;a<r.length;++a)for(var n=0;n<r[0].length;++n)t[e]=r[a][n],++e;return t}function applyDotProduct(r,t){var e,a;r.length<=t.length?(a=r,e=t):(a=t,e=r);for(var n=e.length-a.length+1,i=new Array(n),o=0;o<n;++o){for(var s=0,l=0;l<a.length;++l)s+=a[l]*e[o+l];i[o]=s}return i}function scale(r,t){var e;e=t.inPlace?r:new Array(r.length);const a=t.max,n=t.min;if("number"==typeof a)if("number"==typeof n)for(var i=Stat.minMax(r),o=(a-n)/(i.max-i.min),s=0;s<e.length;s++)e[s]=(r[s]-i.min)*o+n;else for(o=a/Stat.max(r),s=0;s<e.length;s++)e[s]=r[s]*o;else if("number"==typeof n)for(o=n/Stat.min(r),s=0;s<e.length;s++)e[s]=r[s]*o;return e}var ArrayUtils={coordArrayToPoints:coordArrayToPoints,coordArrayToCoordMatrix:coordArrayToCoordMatrix,coordMatrixToCoordArray:coordMatrixToCoordArray,coordMatrixToPoints:transpose,pointsToCoordArray:pointsToCoordArray,pointsToCoordMatrix:transpose,applyDotProduct:applyDotProduct,scale:scale};function getEquallySpacedData(r,t,e){if(r.length>1&&r[0]>r[1]&&(r=r.slice().reverse(),t=t.slice().reverse()),r.length!==t.length)throw new RangeError("the x and y vector doesn't have the same size.");void 0===e&&(e={});var a=void 0===e.from?r[0]:e.from;if(isNaN(a)||!isFinite(a))throw new RangeError("'From' value must be a number");var n=void 0===e.to?r[r.length-1]:e.to;if(isNaN(n)||!isFinite(n))throw new RangeError("'To' value must be a number");var i=a>n;if(i){var o=a;a=n,n=o}var s=void 0===e.numberOfPoints?100:e.numberOfPoints;if(isNaN(s)||!isFinite(s))throw new RangeError("'Number of points' value must be a number");if(s<1)throw new RangeError("the number of point must be higher than 1");var l="slot"===("slot"===e.variant?"slot":"smooth")?getEquallySpacedSlot(r,t,a,n,s):getEquallySpacedSmooth(r,t,a,n,s);return i?l.reverse():l}function getEquallySpacedSmooth(r,t,e,a,n){var i=r.length,o=(a-e)/(n-1),s=e-o/2,l=new Array(n),h=r[1]-r[0],u=r[r.length-1]-r[r.length-2],c=s,f=s+o,m=Number.MIN_VALUE,g=0,p=r[0]-h,v=0,d=0,w=0,y=0,x=0,M=0,b=0,$=0;function A(r,t,e,a){return(a-t)/(e-r)}r:for(;;){for(;p-f>=0;){var S=integral(0,f-m,w,g);if(M=d+S,l[$]=(M-x)/o,++$===n)break r;c=f,f+=o,x=M}m<=c&&c<=p&&(x=d+(S=integral(0,c-m,w,g))),d+=integral(m,p,w,y),m=p,g=v,b<i?(p=r[b],v=t[b],b++):b===i&&(p+=u,v=0),y=-(w=A(m,g,p,v))*m+g}return l}function getEquallySpacedSlot(r,t,e,a,n){var i=r.length,o=(a-e)/(n-1),s=o/2,l=r[r.length-1]-r[r.length-2],h=e-s,u=new Array(n),c=h,f=h+o,m=-Number.MAX_VALUE,g=0,p=r[0],v=t[0],d=0,w=!0,y=0,x=0,M=1,b=0;r:for(;;){if(m>=p)throw new Error("x must be an increasing serie");for(;m-f>0;){if(w&&(x++,w=!1),u[b]=x<=0?0:y/x,++b===n)break r;c=f,f+=o,y=0,x=0}m>c&&(y+=g,x++),(m===-Number.MAX_VALUE||d>1)&&x--,m=p,g=v,M<i?(p=r[M],v=t[M],M++):(p+=l,v=0,d++)}return u}function integral(r,t,e,a){return.5*e*t*t+a*t-(.5*e*r*r+a*r)}var getEquallySpacedData_1=getEquallySpacedData,integral_1=integral,getEquallySpaced={getEquallySpacedData:getEquallySpacedData_1,integral:integral_1},SNV_1=SNV,Stat$1=mlStat.array;function SNV(r){for(var t=Stat$1.mean(r),e=Stat$1.standardDeviation(r),a=r.slice(),n=0;n<r.length;n++)a[n]=(a[n]-t)/e;return a}var snv={SNV:SNV_1},src$2=createCommonjsModule(function(r,t){r.exports=t=ArrayUtils,t.getEquallySpacedData=getEquallySpaced.getEquallySpacedData,t.SNV=snv.SNV}),src_1=src$2.getEquallySpacedData,src_2=src$2.SNV,checkRowIndex=function(r,t,e){var a=e?r.rows:r.rows-1;if(t<0||t>a)throw new RangeError("Row index out of range")},checkColumnIndex=function(r,t,e){var a=e?r.columns:r.columns-1;if(t<0||t>a)throw new RangeError("Column index out of range")},checkRowVector=function(r,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==r.columns)throw new RangeError("vector size must be the same as the number of columns");return t},checkColumnVector=function(r,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==r.rows)throw new RangeError("vector size must be the same as the number of rows");return t},checkIndices=function(r,t,e){var a=t.some(t=>t<0||t>=r.rows),n=e.some(t=>t<0||t>=r.columns);if(a||n)throw new RangeError("Indices are out of range");if("object"!=typeof t||"object"!=typeof e)throw new TypeError("Unexpected type for row/column indices");return Array.isArray(t)||(t=Array.from(t)),Array.isArray(e)||(t=Array.from(e)),{row:t,column:e}},checkRange=function(r,t,e,a,n){if(5!==arguments.length)throw new TypeError("Invalid argument type");var i=Array.from(arguments).slice(1).some(function(r){return"number"!=typeof r});if(i)throw new TypeError("Invalid argument type");if(t>e||a>n||t<0||t>=r.rows||e<0||e>=r.rows||a<0||a>=r.columns||n<0||n>=r.columns)throw new RangeError("Submatrix indices are out of range")},getRange=function(r,t){for(var e=new Array(t-r+1),a=0;a<e.length;a++)e[a]=r+a;return e},sumByRow=function(r){for(var t=matrix$2.Matrix.zeros(r.rows,1),e=0;e<r.rows;++e)for(var a=0;a<r.columns;++a)t.set(e,0,t.get(e,0)+r.get(e,a));return t},sumByColumn=function(r){for(var t=matrix$2.Matrix.zeros(1,r.columns),e=0;e<r.rows;++e)for(var a=0;a<r.columns;++a)t.set(0,a,t.get(0,a)+r.get(e,a));return t},sumAll=function(r){for(var t=0,e=0;e<r.rows;e++)for(var a=0;a<r.columns;a++)t+=r.get(e,a);return t},util$1={checkRowIndex:checkRowIndex,checkColumnIndex:checkColumnIndex,checkRowVector:checkRowVector,checkColumnVector:checkColumnVector,checkIndices:checkIndices,checkRange:checkRange,getRange:getRange,sumByRow:sumByRow,sumByColumn:sumByColumn,sumAll:sumAll};class BaseView extends(abstractMatrix_1()){constructor(r,t,e){super(),this.matrix=r,this.rows=t,this.columns=e}static get[Symbol.species](){return matrix$2.Matrix}}var base=BaseView;class MatrixTransposeView extends base{constructor(r){super(r,r.columns,r.rows)}set(r,t,e){return this.matrix.set(t,r,e),this}get(r,t){return this.matrix.get(t,r)}}var transpose$1=MatrixTransposeView;class MatrixRowView extends base{constructor(r,t){super(r,1,r.columns),this.row=t}set(r,t,e){return this.matrix.set(this.row,t,e),this}get(r,t){return this.matrix.get(this.row,t)}}var row=MatrixRowView;class MatrixSubView extends base{constructor(r,t,e,a,n){util$1.checkRange(r,t,e,a,n),super(r,e-t+1,n-a+1),this.startRow=t,this.startColumn=a}set(r,t,e){return this.matrix.set(this.startRow+r,this.startColumn+t,e),this}get(r,t){return this.matrix.get(this.startRow+r,this.startColumn+t)}}var sub=MatrixSubView;class MatrixSelectionView extends base{constructor(r,t,e){var a=util$1.checkIndices(r,t,e);super(r,a.row.length,a.column.length),this.rowIndices=a.row,this.columnIndices=a.column}set(r,t,e){return this.matrix.set(this.rowIndices[r],this.columnIndices[t],e),this}get(r,t){return this.matrix.get(this.rowIndices[r],this.columnIndices[t])}}var selection=MatrixSelectionView;class MatrixColumnView extends base{constructor(r,t){super(r,r.rows,1),this.column=t}set(r,t,e){return this.matrix.set(r,this.column,e),this}get(r){return this.matrix.get(r,this.column)}}var column=MatrixColumnView;class MatrixFlipRowView extends base{constructor(r){super(r,r.rows,r.columns)}set(r,t,e){return this.matrix.set(this.rows-r-1,t,e),this}get(r,t){return this.matrix.get(this.rows-r-1,t)}}var flipRow=MatrixFlipRowView;class MatrixFlipColumnView extends base{constructor(r){super(r,r.rows,r.columns)}set(r,t,e){return this.matrix.set(r,this.columns-t-1,e),this}get(r,t){return this.matrix.get(r,this.columns-t-1)}}var flipColumn=MatrixFlipColumnView,abstractMatrix_1=abstractMatrix;function abstractMatrix(superCtor){void 0===superCtor&&(superCtor=Object);class Matrix extends superCtor{static get[Symbol.species](){return this}static from1DArray(r,t,e){if(r*t!==e.length)throw new RangeError("Data length does not match given dimensions");for(var a=new this(r,t),n=0;n<r;n++)for(var i=0;i<t;i++)a.set(n,i,e[n*t+i]);return a}static rowVector(r){for(var t=new this(1,r.length),e=0;e<r.length;e++)t.set(0,e,r[e]);return t}static columnVector(r){for(var t=new this(r.length,1),e=0;e<r.length;e++)t.set(e,0,r[e]);return t}static empty(r,t){return new this(r,t)}static zeros(r,t){return this.empty(r,t).fill(0)}static ones(r,t){return this.empty(r,t).fill(1)}static rand(r,t,e){void 0===e&&(e=Math.random);for(var a=this.empty(r,t),n=0;n<r;n++)for(var i=0;i<t;i++)a.set(n,i,e());return a}static randInt(r,t,e,a){void 0===e&&(e=1e3),void 0===a&&(a=Math.random);for(var n=this.empty(r,t),i=0;i<r;i++)for(var o=0;o<t;o++){var s=Math.floor(a()*e);n.set(i,o,s)}return n}static eye(r,t,e){void 0===t&&(t=r),void 0===e&&(e=1);for(var a=Math.min(r,t),n=this.zeros(r,t),i=0;i<a;i++)n.set(i,i,e);return n}static diag(r,t,e){var a=r.length;void 0===t&&(t=a),void 0===e&&(e=t);for(var n=Math.min(a,t,e),i=this.zeros(t,e),o=0;o<n;o++)i.set(o,o,r[o]);return i}static min(r,t){r=this.checkMatrix(r),t=this.checkMatrix(t);for(var e=r.rows,a=r.columns,n=new this(e,a),i=0;i<e;i++)for(var o=0;o<a;o++)n.set(i,o,Math.min(r.get(i,o),t.get(i,o)));return n}static max(r,t){r=this.checkMatrix(r),t=this.checkMatrix(t);for(var e=r.rows,a=r.columns,n=new this(e,a),i=0;i<e;i++)for(var o=0;o<a;o++)n.set(i,o,Math.max(r.get(i,o),t.get(i,o)));return n}static checkMatrix(r){return Matrix.isMatrix(r)?r:new this(r)}static isMatrix(r){return null!=r&&"Matrix"===r.klass}get size(){return this.rows*this.columns}apply(r){if("function"!=typeof r)throw new TypeError("callback must be a function");for(var t=this.rows,e=this.columns,a=0;a<t;a++)for(var n=0;n<e;n++)r.call(this,a,n);return this}to1DArray(){for(var r=new Array(this.size),t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)r[t*this.columns+e]=this.get(t,e);return r}to2DArray(){for(var r=new Array(this.rows),t=0;t<this.rows;t++){r[t]=new Array(this.columns);for(var e=0;e<this.columns;e++)r[t][e]=this.get(t,e)}return r}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(var r=0;r<this.rows;r++)for(var t=0;t<=r;t++)if(this.get(r,t)!==this.get(t,r))return!1;return!0}return!1}set(r,t,e){throw new Error("set method is unimplemented")}get(r,t){throw new Error("get method is unimplemented")}repeat(r,t){r=r||1,t=t||1;for(var e=new this.constructor[Symbol.species](this.rows*r,this.columns*t),a=0;a<r;a++)for(var n=0;n<t;n++)e.setSubMatrix(this,this.rows*a,this.columns*n);return e}fill(r){for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,r);return this}neg(){return this.mulS(-1)}getRow(r){util$1.checkRowIndex(this,r);for(var t=new Array(this.columns),e=0;e<this.columns;e++)t[e]=this.get(r,e);return t}getRowVector(r){return this.constructor.rowVector(this.getRow(r))}setRow(r,t){util$1.checkRowIndex(this,r),t=util$1.checkRowVector(this,t);for(var e=0;e<this.columns;e++)this.set(r,e,t[e]);return this}swapRows(r,t){util$1.checkRowIndex(this,r),util$1.checkRowIndex(this,t);for(var e=0;e<this.columns;e++){var a=this.get(r,e);this.set(r,e,this.get(t,e)),this.set(t,e,a)}return this}getColumn(r){util$1.checkColumnIndex(this,r);for(var t=new Array(this.rows),e=0;e<this.rows;e++)t[e]=this.get(e,r);return t}getColumnVector(r){return this.constructor.columnVector(this.getColumn(r))}setColumn(r,t){util$1.checkColumnIndex(this,r),t=util$1.checkColumnVector(this,t);for(var e=0;e<this.rows;e++)this.set(e,r,t[e]);return this}swapColumns(r,t){util$1.checkColumnIndex(this,r),util$1.checkColumnIndex(this,t);for(var e=0;e<this.rows;e++){var a=this.get(e,r);this.set(e,r,this.get(e,t)),this.set(e,t,a)}return this}addRowVector(r){r=util$1.checkRowVector(this,r);for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)+r[e]);return this}subRowVector(r){r=util$1.checkRowVector(this,r);for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)-r[e]);return this}mulRowVector(r){r=util$1.checkRowVector(this,r);for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)*r[e]);return this}divRowVector(r){r=util$1.checkRowVector(this,r);for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)/r[e]);return this}addColumnVector(r){r=util$1.checkColumnVector(this,r);for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)+r[t]);return this}subColumnVector(r){r=util$1.checkColumnVector(this,r);for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)-r[t]);return this}mulColumnVector(r){r=util$1.checkColumnVector(this,r);for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)*r[t]);return this}divColumnVector(r){r=util$1.checkColumnVector(this,r);for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)/r[t]);return this}mulRow(r,t){util$1.checkRowIndex(this,r);for(var e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)*t);return this}mulColumn(r,t){util$1.checkColumnIndex(this,r);for(var e=0;e<this.rows;e++)this.set(e,r,this.get(e,r)*t);return this}max(){for(var r=this.get(0,0),t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxIndex(){for(var r=this.get(0,0),t=[0,0],e=0;e<this.rows;e++)for(var a=0;a<this.columns;a++)this.get(e,a)>r&&(r=this.get(e,a),t[0]=e,t[1]=a);return t}min(){for(var r=this.get(0,0),t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)this.get(t,e)<r&&(r=this.get(t,e));return r}minIndex(){for(var r=this.get(0,0),t=[0,0],e=0;e<this.rows;e++)for(var a=0;a<this.columns;a++)this.get(e,a)<r&&(r=this.get(e,a),t[0]=e,t[1]=a);return t}maxRow(r){util$1.checkRowIndex(this,r);for(var t=this.get(r,0),e=1;e<this.columns;e++)this.get(r,e)>t&&(t=this.get(r,e));return t}maxRowIndex(r){util$1.checkRowIndex(this,r);for(var t=this.get(r,0),e=[r,0],a=1;a<this.columns;a++)this.get(r,a)>t&&(t=this.get(r,a),e[1]=a);return e}minRow(r){util$1.checkRowIndex(this,r);for(var t=this.get(r,0),e=1;e<this.columns;e++)this.get(r,e)<t&&(t=this.get(r,e));return t}minRowIndex(r){util$1.checkRowIndex(this,r);for(var t=this.get(r,0),e=[r,0],a=1;a<this.columns;a++)this.get(r,a)<t&&(t=this.get(r,a),e[1]=a);return e}maxColumn(r){util$1.checkColumnIndex(this,r);for(var t=this.get(0,r),e=1;e<this.rows;e++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxColumnIndex(r){util$1.checkColumnIndex(this,r);for(var t=this.get(0,r),e=[0,r],a=1;a<this.rows;a++)this.get(a,r)>t&&(t=this.get(a,r),e[0]=a);return e}minColumn(r){util$1.checkColumnIndex(this,r);for(var t=this.get(0,r),e=1;e<this.rows;e++)this.get(e,r)<t&&(t=this.get(e,r));return t}minColumnIndex(r){util$1.checkColumnIndex(this,r);for(var t=this.get(0,r),e=[0,r],a=1;a<this.rows;a++)this.get(a,r)<t&&(t=this.get(a,r),e[0]=a);return e}diag(){for(var r=Math.min(this.rows,this.columns),t=new Array(r),e=0;e<r;e++)t[e]=this.get(e,e);return t}sum(r){switch(r){case"row":return util$1.sumByRow(this);case"column":return util$1.sumByColumn(this);default:return util$1.sumAll(this)}}mean(){return this.sum()/this.size}prod(){for(var r=1,t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)r*=this.get(t,e);return r}cumulativeSum(){for(var r=0,t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)r+=this.get(t,e),this.set(t,e,r);return this}dot(r){Matrix.isMatrix(r)&&(r=r.to1DArray());var t=this.to1DArray();if(t.length!==r.length)throw new RangeError("vectors do not have the same size");for(var e=0,a=0;a<t.length;a++)e+=t[a]*r[a];return e}mmul(r){r=this.constructor.checkMatrix(r),this.columns!==r.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");for(var t=this.rows,e=this.columns,a=r.columns,n=new this.constructor[Symbol.species](t,a),i=new Array(e),o=0;o<a;o++){for(var s=0;s<e;s++)i[s]=r.get(s,o);for(var l=0;l<t;l++){var h=0;for(s=0;s<e;s++)h+=this.get(l,s)*i[s];n.set(l,o,h)}}return n}strassen2x2(r){var t=new this.constructor[Symbol.species](2,2);const e=this.get(0,0),a=r.get(0,0),n=this.get(0,1),i=r.get(0,1),o=this.get(1,0),s=r.get(1,0),l=this.get(1,1),h=r.get(1,1),u=(e+l)*(a+h),c=(o+l)*a,f=e*(i-h),m=l*(s-a),g=(e+n)*h,p=u+m-g+(n-l)*(s+h),v=f+g,d=c+m,w=u-c+f+(o-e)*(a+i);return t.set(0,0,p),t.set(0,1,v),t.set(1,0,d),t.set(1,1,w),t}strassen3x3(r){var t=new this.constructor[Symbol.species](3,3);const e=this.get(0,0),a=this.get(0,1),n=this.get(0,2),i=this.get(1,0),o=this.get(1,1),s=this.get(1,2),l=this.get(2,0),h=this.get(2,1),u=this.get(2,2),c=r.get(0,0),f=r.get(0,1),m=r.get(0,2),g=r.get(1,0),p=r.get(1,1),v=r.get(1,2),d=r.get(2,0),w=r.get(2,1),y=r.get(2,2),x=(e-i)*(-f+p),M=(-e+i+o)*(c-f+p),b=(i+o)*(-c+f),$=e*c,A=(-e+l+h)*(c-m+v),S=(-e+l)*(m-v),k=(l+h)*(-c+m),_=(-n+h+u)*(p+d-w),E=(n-u)*(p-w),z=n*d,R=(h+u)*(-d+w),C=(-n+o+s)*(v+d-y),D=(n-s)*(v-y),V=(o+s)*(-d+y),O=$+z+a*g,T=(e+a+n-i-o-h-u)*p+M+b+$+_+z+R,F=$+A+k+(e+a+n-o-s-l-h)*v+z+C+V,q=x+o*(-c+f+g-p-v-d+y)+M+$+z+C+D,I=x+M+b+$+s*w,j=z+C+D+V+i*m,L=$+A+S+h*(-c+m+g-p-v-d+w)+_+E+z,P=_+E+z+R+l*f,N=$+A+S+k+u*y;return t.set(0,0,O),t.set(0,1,T),t.set(0,2,F),t.set(1,0,q),t.set(1,1,I),t.set(1,2,j),t.set(2,0,L),t.set(2,1,P),t.set(2,2,N),t}mmulStrassen(r){var t=this.clone(),e=t.rows,a=t.columns,n=r.rows,i=r.columns;function o(r,t,e){var a=r.rows,n=r.columns;if(a===t&&n===e)return r;var i=Matrix.zeros(t,e);return i=i.setSubMatrix(r,0,0)}a!==n&&console.warn("Multiplying ".concat(e," x ").concat(a," and ").concat(n," x ").concat(i," matrix: dimensions do not match."));var s=Math.max(e,n),l=Math.max(a,i);return function r(t,e,a,n){if(a<=512||n<=512)return t.mmul(e);a%2==1&&n%2==1?(t=o(t,a+1,n+1),e=o(e,a+1,n+1)):a%2==1?(t=o(t,a+1,n),e=o(e,a+1,n)):n%2==1&&(t=o(t,a,n+1),e=o(e,a,n+1));var i=parseInt(t.rows/2),s=parseInt(t.columns/2),l=t.subMatrix(0,i-1,0,s-1),h=e.subMatrix(0,i-1,0,s-1),u=t.subMatrix(0,i-1,s,t.columns-1),c=e.subMatrix(0,i-1,s,e.columns-1),f=t.subMatrix(i,t.rows-1,0,s-1),m=e.subMatrix(i,e.rows-1,0,s-1),g=t.subMatrix(i,t.rows-1,s,t.columns-1),p=e.subMatrix(i,e.rows-1,s,e.columns-1),v=r(Matrix.add(l,g),Matrix.add(h,p),i,s),d=r(Matrix.add(f,g),h,i,s),w=r(l,Matrix.sub(c,p),i,s),y=r(g,Matrix.sub(m,h),i,s),x=r(Matrix.add(l,u),p,i,s),M=r(Matrix.sub(f,l),Matrix.add(h,c),i,s),b=r(Matrix.sub(u,g),Matrix.add(m,p),i,s),$=Matrix.add(v,y);$.sub(x),$.add(b);var A=Matrix.add(w,x),S=Matrix.add(d,y),k=Matrix.sub(v,d);k.add(w),k.add(M);var _=Matrix.zeros(2*$.rows,2*$.columns);return(_=(_=(_=(_=_.setSubMatrix($,0,0)).setSubMatrix(A,$.rows,0)).setSubMatrix(S,0,$.columns)).setSubMatrix(k,$.rows,$.columns)).subMatrix(0,a-1,0,n-1)}(t=o(t,s,l),r=o(r,s,l),s,l)}scaleRows(r,t){if((r=void 0===r?0:r)>=(t=void 0===t?1:t))throw new RangeError("min should be strictly smaller than max");for(var e=this.constructor.empty(this.rows,this.columns),a=0;a<this.rows;a++){var n=src$2.scale(this.getRow(a),{min:r,max:t});e.setRow(a,n)}return e}scaleColumns(r,t){if((r=void 0===r?0:r)>=(t=void 0===t?1:t))throw new RangeError("min should be strictly smaller than max");for(var e=this.constructor.empty(this.rows,this.columns),a=0;a<this.columns;a++){var n=src$2.scale(this.getColumn(a),{min:r,max:t});e.setColumn(a,n)}return e}kroneckerProduct(r){r=this.constructor.checkMatrix(r);for(var t=this.rows,e=this.columns,a=r.rows,n=r.columns,i=new this.constructor[Symbol.species](t*a,e*n),o=0;o<t;o++)for(var s=0;s<e;s++)for(var l=0;l<a;l++)for(var h=0;h<n;h++)i[a*o+l][n*s+h]=this.get(o,s)*r.get(l,h);return i}transpose(){for(var r=new this.constructor[Symbol.species](this.columns,this.rows),t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)r.set(e,t,this.get(t,e));return r}sortRows(r){void 0===r&&(r=compareNumbers);for(var t=0;t<this.rows;t++)this.setRow(t,this.getRow(t).sort(r));return this}sortColumns(r){void 0===r&&(r=compareNumbers);for(var t=0;t<this.columns;t++)this.setColumn(t,this.getColumn(t).sort(r));return this}subMatrix(r,t,e,a){util$1.checkRange(this,r,t,e,a);for(var n=new this.constructor[Symbol.species](t-r+1,a-e+1),i=r;i<=t;i++)for(var o=e;o<=a;o++)n[i-r][o-e]=this.get(i,o);return n}subMatrixRow(r,t,e){if(void 0===t&&(t=0),void 0===e&&(e=this.columns-1),t>e||t<0||t>=this.columns||e<0||e>=this.columns)throw new RangeError("Argument out of range");for(var a=new this.constructor[Symbol.species](r.length,e-t+1),n=0;n<r.length;n++)for(var i=t;i<=e;i++){if(r[n]<0||r[n]>=this.rows)throw new RangeError("Row index out of range: "+r[n]);a.set(n,i-t,this.get(r[n],i))}return a}subMatrixColumn(r,t,e){if(void 0===t&&(t=0),void 0===e&&(e=this.rows-1),t>e||t<0||t>=this.rows||e<0||e>=this.rows)throw new RangeError("Argument out of range");for(var a=new this.constructor[Symbol.species](e-t+1,r.length),n=0;n<r.length;n++)for(var i=t;i<=e;i++){if(r[n]<0||r[n]>=this.columns)throw new RangeError("Column index out of range: "+r[n]);a.set(i-t,n,this.get(i,r[n]))}return a}setSubMatrix(r,t,e){var a=t+(r=this.constructor.checkMatrix(r)).rows-1,n=e+r.columns-1;util$1.checkRange(this,t,a,e,n);for(var i=0;i<r.rows;i++)for(var o=0;o<r.columns;o++)this[t+i][e+o]=r.get(i,o);return this}selection(r,t){for(var e=util$1.checkIndices(this,r,t),a=new this.constructor[Symbol.species](r.length,t.length),n=0;n<e.row.length;n++)for(var i=e.row[n],o=0;o<e.column.length;o++){var s=e.column[o];a[n][o]=this.get(i,s)}return a}trace(){for(var r=Math.min(this.rows,this.columns),t=0,e=0;e<r;e++)t+=this.get(e,e);return t}transposeView(){return new transpose$1(this)}rowView(r){return util$1.checkRowIndex(this,r),new row(this,r)}columnView(r){return util$1.checkColumnIndex(this,r),new column(this,r)}flipRowView(){return new flipRow(this)}flipColumnView(){return new flipColumn(this)}subMatrixView(r,t,e,a){return new sub(this,r,t,e,a)}selectionView(r,t){return new selection(this,r,t)}det(){var r,t,e,a,n,i;if(this.isSquare())return 2===this.columns?(r=this.get(0,0),t=this.get(0,1),e=this.get(1,0),r*this.get(1,1)-t*e):3===this.columns?(a=this.selectionView([1,2],[1,2]),n=this.selectionView([1,2],[0,2]),i=this.selectionView([1,2],[0,1]),r=this.get(0,0),t=this.get(0,1),e=this.get(0,2),r*a.det()-t*n.det()+e*i.det()):new lu(this).determinant;throw Error("Determinant can only be calculated for a square matrix.")}pseudoInverse(r){void 0===r&&(r=Number.EPSILON);for(var t=new svd(this,{autoTranspose:!0}),e=t.leftSingularVectors,a=t.rightSingularVectors,n=t.diagonal,i=0;i<n.length;i++)Math.abs(n[i])>r?n[i]=1/n[i]:n[i]=0;return n=this.constructor[Symbol.species].diag(n),a.mmul(n.mmul(e.transposeView()))}}function compareNumbers(r,t){return r-t}Matrix.prototype.klass="Matrix",Matrix.random=Matrix.rand,Matrix.diagonal=Matrix.diag,Matrix.prototype.diagonal=Matrix.prototype.diag,Matrix.identity=Matrix.eye,Matrix.prototype.negate=Matrix.prototype.neg,Matrix.prototype.tensorProduct=Matrix.prototype.kroneckerProduct,Matrix.prototype.determinant=Matrix.prototype.det;var inplaceOperator="\n(function %name%(value) {\n    if (typeof value === 'number') return this.%name%S(value);\n    return this.%name%M(value);\n})\n",inplaceOperatorScalar="\n(function %name%S(value) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, this.get(i, j) %op% value);\n        }\n    }\n    return this;\n})\n",inplaceOperatorMatrix="\n(function %name%M(matrix) {\n    matrix = this.constructor.checkMatrix(matrix);\n    checkDimensions(this, matrix);\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));\n        }\n    }\n    return this;\n})\n",staticOperator="\n(function %name%(matrix, value) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(value);\n})\n",inplaceMethod="\n(function %name%() {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j)));\n        }\n    }\n    return this;\n})\n",staticMethod="\n(function %name%(matrix) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%();\n})\n",inplaceMethodWithArgs="\n(function %name%(%args%) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), %args%));\n        }\n    }\n    return this;\n})\n",staticMethodWithArgs="\n(function %name%(matrix, %args%) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(%args%);\n})\n",inplaceMethodWithOneArgScalar="\n(function %name%S(value) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), value));\n        }\n    }\n    return this;\n})\n",inplaceMethodWithOneArgMatrix="\n(function %name%M(matrix) {\n    matrix = this.constructor.checkMatrix(matrix);\n    checkDimensions(this, matrix);\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));\n        }\n    }\n    return this;\n})\n",inplaceMethodWithOneArg="\n(function %name%(value) {\n    if (typeof value === 'number') return this.%name%S(value);\n    return this.%name%M(value);\n})\n",staticMethodWithOneArg=staticMethodWithArgs,operators=[["+","add"],["-","sub","subtract"],["*","mul","multiply"],["/","div","divide"],["%","mod","modulus"],["&","and"],["|","or"],["^","xor"],["<<","leftShift"],[">>","signPropagatingRightShift"],[">>>","rightShift","zeroFillRightShift"]],i;for(var operator of operators){var inplaceOp=eval(fillTemplateFunction(inplaceOperator,{name:operator[1],op:operator[0]})),inplaceOpS=eval(fillTemplateFunction(inplaceOperatorScalar,{name:operator[1]+"S",op:operator[0]})),inplaceOpM=eval(fillTemplateFunction(inplaceOperatorMatrix,{name:operator[1]+"M",op:operator[0]})),staticOp=eval(fillTemplateFunction(staticOperator,{name:operator[1]}));for(i=1;i<operator.length;i++)Matrix.prototype[operator[i]]=inplaceOp,Matrix.prototype[operator[i]+"S"]=inplaceOpS,Matrix.prototype[operator[i]+"M"]=inplaceOpM,Matrix[operator[i]]=staticOp}var methods=[["~","not"]];for(var method of(["abs","acos","acosh","asin","asinh","atan","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","log","log1p","log10","log2","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].forEach(function(r){methods.push(["Math."+r,r])}),methods)){var inplaceMeth=eval(fillTemplateFunction(inplaceMethod,{name:method[1],method:method[0]})),staticMeth=eval(fillTemplateFunction(staticMethod,{name:method[1]}));for(i=1;i<method.length;i++)Matrix.prototype[method[i]]=inplaceMeth,Matrix[method[i]]=staticMeth}var methodsWithArgs=[["Math.pow",1,"pow"]];for(var methodWithArg of methodsWithArgs){var args="arg0";for(i=1;i<methodWithArg[1];i++)args+=", arg".concat(i);if(1!==methodWithArg[1]){var inplaceMethWithArgs=eval(fillTemplateFunction(inplaceMethodWithArgs,{name:methodWithArg[2],method:methodWithArg[0],args:args})),staticMethWithArgs=eval(fillTemplateFunction(staticMethodWithArgs,{name:methodWithArg[2],args:args}));for(i=2;i<methodWithArg.length;i++)Matrix.prototype[methodWithArg[i]]=inplaceMethWithArgs,Matrix[methodWithArg[i]]=staticMethWithArgs}else{var tmplVar={name:methodWithArg[2],args:args,method:methodWithArg[0]},inplaceMethod2=eval(fillTemplateFunction(inplaceMethodWithOneArg,tmplVar)),inplaceMethodS=eval(fillTemplateFunction(inplaceMethodWithOneArgScalar,tmplVar)),inplaceMethodM=eval(fillTemplateFunction(inplaceMethodWithOneArgMatrix,tmplVar)),staticMethod2=eval(fillTemplateFunction(staticMethodWithOneArg,tmplVar));for(i=2;i<methodWithArg.length;i++)Matrix.prototype[methodWithArg[i]]=inplaceMethod2,Matrix.prototype[methodWithArg[i]+"M"]=inplaceMethodM,Matrix.prototype[methodWithArg[i]+"S"]=inplaceMethodS,Matrix[methodWithArg[i]]=staticMethod2}}function fillTemplateFunction(r,t){for(var e in t)r=r.replace(new RegExp("%"+e+"%","g"),t[e]);return r}return Matrix}getCjsExportFromNamespace(symbolSpecies);class Matrix extends(abstractMatrix_1(Array)){constructor(r,t){var e;if(1===arguments.length&&"number"==typeof r)return new Array(r);if(Matrix.isMatrix(r))return r.clone();if(Number.isInteger(r)&&r>0){if(super(r),!(Number.isInteger(t)&&t>0))throw new TypeError("nColumns must be a positive integer");for(e=0;e<r;e++)this[e]=new Array(t)}else{if(!Array.isArray(r))throw new TypeError("First argument must be a positive number or an array");{const a=r;if(r=a.length,"number"!=typeof(t=a[0].length)||0===t)throw new TypeError("Data must be a 2D array with at least one element");for(super(r),e=0;e<r;e++){if(a[e].length!==t)throw new RangeError("Inconsistent array dimensions");this[e]=[].concat(a[e])}}}return this.rows=r,this.columns=t,this}set(r,t,e){return this[r][t]=e,this}get(r,t){return this[r][t]}clone(){for(var r=new this.constructor[Symbol.species](this.rows,this.columns),t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++)r.set(t,e,this.get(t,e));return r}removeRow(r){if(util$1.checkRowIndex(this,r),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.splice(r,1),this.rows-=1,this}addRow(r,t){return void 0===t&&(t=r,r=this.rows),util$1.checkRowIndex(this,r,!0),t=util$1.checkRowVector(this,t,!0),this.splice(r,0,t),this.rows+=1,this}removeColumn(r){if(util$1.checkColumnIndex(this,r),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(var t=0;t<this.rows;t++)this[t].splice(r,1);return this.columns-=1,this}addColumn(r,t){void 0===t&&(t=r,r=this.columns),util$1.checkColumnIndex(this,r,!0),t=util$1.checkColumnVector(this,t);for(var e=0;e<this.rows;e++)this[e].splice(r,0,t[e]);return this.columns+=1,this}}var Matrix_1=Matrix;Matrix.abstractMatrix=abstractMatrix_1;var matrix$2={Matrix:Matrix_1};const Matrix$1=matrix$2.Matrix,hypotenuse$2=util.hypotenuse,getFilled2DArray$2=util.getFilled2DArray,defaultOptions$2={assumeSymmetric:!1};function EigenvalueDecomposition(r,t){if(t=Object.assign({},defaultOptions$2,t),!(this instanceof EigenvalueDecomposition))return new EigenvalueDecomposition(r,t);if(!(r=Matrix$1.checkMatrix(r)).isSquare())throw new Error("Matrix is not a square matrix");var e,a,n=r.columns,i=getFilled2DArray$2(n,n,0),o=new Array(n),s=new Array(n),l=r;if(!!t.assumeSymmetric||r.isSymmetric()){for(e=0;e<n;e++)for(a=0;a<n;a++)i[e][a]=l.get(e,a);tred2(n,s,o,i),tql2(n,s,o,i)}else{var h=getFilled2DArray$2(n,n,0),u=new Array(n);for(a=0;a<n;a++)for(e=0;e<n;e++)h[e][a]=l.get(e,a);orthes(n,h,u,i),hqr2(n,s,o,i,h)}this.n=n,this.e=s,this.d=o,this.V=i}function tred2(r,t,e,a){var n,i,o,s,l,h,u,c;for(l=0;l<r;l++)e[l]=a[r-1][l];for(s=r-1;s>0;s--){for(c=0,o=0,h=0;h<s;h++)c+=Math.abs(e[h]);if(0===c)for(t[s]=e[s-1],l=0;l<s;l++)e[l]=a[s-1][l],a[s][l]=0,a[l][s]=0;else{for(h=0;h<s;h++)e[h]/=c,o+=e[h]*e[h];for(n=e[s-1],i=Math.sqrt(o),n>0&&(i=-i),t[s]=c*i,o-=n*i,e[s-1]=n-i,l=0;l<s;l++)t[l]=0;for(l=0;l<s;l++){for(n=e[l],a[l][s]=n,i=t[l]+a[l][l]*n,h=l+1;h<=s-1;h++)i+=a[h][l]*e[h],t[h]+=a[h][l]*n;t[l]=i}for(n=0,l=0;l<s;l++)t[l]/=o,n+=t[l]*e[l];for(u=n/(o+o),l=0;l<s;l++)t[l]-=u*e[l];for(l=0;l<s;l++){for(n=e[l],i=t[l],h=l;h<=s-1;h++)a[h][l]-=n*t[h]+i*e[h];e[l]=a[s-1][l],a[s][l]=0}}e[s]=o}for(s=0;s<r-1;s++){if(a[r-1][s]=a[s][s],a[s][s]=1,0!==(o=e[s+1])){for(h=0;h<=s;h++)e[h]=a[h][s+1]/o;for(l=0;l<=s;l++){for(i=0,h=0;h<=s;h++)i+=a[h][s+1]*a[h][l];for(h=0;h<=s;h++)a[h][l]-=i*e[h]}}for(h=0;h<=s;h++)a[h][s+1]=0}for(l=0;l<r;l++)e[l]=a[r-1][l],a[r-1][l]=0;a[r-1][r-1]=1,t[0]=0}function tql2(r,t,e,a){var n,i,o,s,l,h,u,c,f,m,g,p,v,d,w,y;for(o=1;o<r;o++)t[o-1]=t[o];t[r-1]=0;var x=0,M=0,b=Math.pow(2,-52);for(h=0;h<r;h++){for(M=Math.max(M,Math.abs(e[h])+Math.abs(t[h])),u=h;u<r&&!(Math.abs(t[u])<=b*M);)u++;if(u>h)do{for(n=e[h],c=(e[h+1]-n)/(2*t[h]),f=hypotenuse$2(c,1),c<0&&(f=-f),e[h]=t[h]/(c+f),e[h+1]=t[h]*(c+f),m=e[h+1],i=n-e[h],o=h+2;o<r;o++)e[o]-=i;for(x+=i,c=e[u],p=g=1,v=g,d=t[h+1],w=0,y=0,o=u-1;o>=h;o--)for(v=p,p=g,y=w,n=g*t[o],i=g*c,f=hypotenuse$2(c,t[o]),t[o+1]=w*f,w=t[o]/f,c=(g=c/f)*e[o]-w*n,e[o+1]=i+w*(g*n+w*e[o]),l=0;l<r;l++)i=a[l][o+1],a[l][o+1]=w*a[l][o]+g*i,a[l][o]=g*a[l][o]-w*i;c=-w*y*v*d*t[h]/m,t[h]=w*c,e[h]=g*c}while(Math.abs(t[h])>b*M);e[h]=e[h]+x,t[h]=0}for(o=0;o<r-1;o++){for(l=o,c=e[o],s=o+1;s<r;s++)e[s]<c&&(l=s,c=e[s]);if(l!==o)for(e[l]=e[o],e[o]=c,s=0;s<r;s++)c=a[s][o],a[s][o]=a[s][l],a[s][l]=c}}function orthes(r,t,e,a){var n,i,o,s,l,h,u,c=r-1;for(h=1;h<=c-1;h++){for(u=0,s=h;s<=c;s++)u+=Math.abs(t[s][h-1]);if(0!==u){for(o=0,s=c;s>=h;s--)e[s]=t[s][h-1]/u,o+=e[s]*e[s];for(i=Math.sqrt(o),e[h]>0&&(i=-i),o-=e[h]*i,e[h]=e[h]-i,l=h;l<r;l++){for(n=0,s=c;s>=h;s--)n+=e[s]*t[s][l];for(n/=o,s=h;s<=c;s++)t[s][l]-=n*e[s]}for(s=0;s<=c;s++){for(n=0,l=c;l>=h;l--)n+=e[l]*t[s][l];for(n/=o,l=h;l<=c;l++)t[s][l]-=n*e[l]}e[h]=u*e[h],t[h][h-1]=u*i}}for(s=0;s<r;s++)for(l=0;l<r;l++)a[s][l]=s===l?1:0;for(h=c-1;h>=1;h--)if(0!==t[h][h-1]){for(s=h+1;s<=c;s++)e[s]=t[s][h-1];for(l=h;l<=c;l++){for(i=0,s=h;s<=c;s++)i+=e[s]*a[s][l];for(i=i/e[h]/t[h][h-1],s=h;s<=c;s++)a[s][l]+=i*e[s]}}}function hqr2(r,t,e,a,n){var i,o,s,l,h,u,c,f,m,g,p,v,d,w,y,x=r-1,M=r-1,b=Math.pow(2,-52),$=0,A=0,S=0,k=0,_=0,E=0,z=0,R=0;for(i=0;i<r;i++)for((i<0||i>M)&&(e[i]=n[i][i],t[i]=0),o=Math.max(i-1,0);o<r;o++)A+=Math.abs(n[i][o]);for(;x>=0;){for(l=x;l>0&&(0===(E=Math.abs(n[l-1][l-1])+Math.abs(n[l][l]))&&(E=A),!(Math.abs(n[l][l-1])<b*E));)l--;if(l===x)n[x][x]=n[x][x]+$,e[x]=n[x][x],t[x]=0,x--,R=0;else if(l===x-1){if(c=n[x][x-1]*n[x-1][x],k=(S=(n[x-1][x-1]-n[x][x])/2)*S+c,z=Math.sqrt(Math.abs(k)),n[x][x]=n[x][x]+$,n[x-1][x-1]=n[x-1][x-1]+$,f=n[x][x],k>=0){for(z=S>=0?S+z:S-z,e[x-1]=f+z,e[x]=e[x-1],0!==z&&(e[x]=f-c/z),t[x-1]=0,t[x]=0,S=(f=n[x][x-1])/(E=Math.abs(f)+Math.abs(z)),k=z/E,S/=_=Math.sqrt(S*S+k*k),k/=_,o=x-1;o<r;o++)z=n[x-1][o],n[x-1][o]=k*z+S*n[x][o],n[x][o]=k*n[x][o]-S*z;for(i=0;i<=x;i++)z=n[i][x-1],n[i][x-1]=k*z+S*n[i][x],n[i][x]=k*n[i][x]-S*z;for(i=0;i<=M;i++)z=a[i][x-1],a[i][x-1]=k*z+S*a[i][x],a[i][x]=k*a[i][x]-S*z}else e[x-1]=f+S,e[x]=f+S,t[x-1]=z,t[x]=-z;x-=2,R=0}else{if(f=n[x][x],m=0,c=0,l<x&&(m=n[x-1][x-1],c=n[x][x-1]*n[x-1][x]),10===R){for($+=f,i=0;i<=x;i++)n[i][i]-=f;f=m=.75*(E=Math.abs(n[x][x-1])+Math.abs(n[x-1][x-2])),c=-.4375*E*E}if(30===R&&(E=(E=(m-f)/2)*E+c)>0){for(E=Math.sqrt(E),m<f&&(E=-E),E=f-c/((m-f)/2+E),i=0;i<=x;i++)n[i][i]-=E;$+=E,f=m=c=.964}for(R+=1,h=x-2;h>=l&&(S=((_=f-(z=n[h][h]))*(E=m-z)-c)/n[h+1][h]+n[h][h+1],k=n[h+1][h+1]-z-_-E,_=n[h+2][h+1],S/=E=Math.abs(S)+Math.abs(k)+Math.abs(_),k/=E,_/=E,h!==l)&&!(Math.abs(n[h][h-1])*(Math.abs(k)+Math.abs(_))<b*(Math.abs(S)*(Math.abs(n[h-1][h-1])+Math.abs(z)+Math.abs(n[h+1][h+1]))));)h--;for(i=h+2;i<=x;i++)n[i][i-2]=0,i>h+2&&(n[i][i-3]=0);for(s=h;s<=x-1&&(w=s!==x-1,s!==h&&(S=n[s][s-1],k=n[s+1][s-1],_=w?n[s+2][s-1]:0,0!==(f=Math.abs(S)+Math.abs(k)+Math.abs(_))&&(S/=f,k/=f,_/=f)),0!==f);s++)if(E=Math.sqrt(S*S+k*k+_*_),S<0&&(E=-E),0!==E){for(s!==h?n[s][s-1]=-E*f:l!==h&&(n[s][s-1]=-n[s][s-1]),f=(S+=E)/E,m=k/E,z=_/E,k/=S,_/=S,o=s;o<r;o++)S=n[s][o]+k*n[s+1][o],w&&(S+=_*n[s+2][o],n[s+2][o]=n[s+2][o]-S*z),n[s][o]=n[s][o]-S*f,n[s+1][o]=n[s+1][o]-S*m;for(i=0;i<=Math.min(x,s+3);i++)S=f*n[i][s]+m*n[i][s+1],w&&(S+=z*n[i][s+2],n[i][s+2]=n[i][s+2]-S*_),n[i][s]=n[i][s]-S,n[i][s+1]=n[i][s+1]-S*k;for(i=0;i<=M;i++)S=f*a[i][s]+m*a[i][s+1],w&&(S+=z*a[i][s+2],a[i][s+2]=a[i][s+2]-S*_),a[i][s]=a[i][s]-S,a[i][s+1]=a[i][s+1]-S*k}}}if(0!==A){for(x=r-1;x>=0;x--)if(S=e[x],0===(k=t[x]))for(l=x,n[x][x]=1,i=x-1;i>=0;i--){for(c=n[i][i]-S,_=0,o=l;o<=x;o++)_+=n[i][o]*n[o][x];if(t[i]<0)z=c,E=_;else if(l=i,0===t[i]?n[i][x]=0!==c?-_/c:-_/(b*A):(f=n[i][i+1],m=n[i+1][i],u=(f*E-z*_)/(k=(e[i]-S)*(e[i]-S)+t[i]*t[i]),n[i][x]=u,n[i+1][x]=Math.abs(f)>Math.abs(z)?(-_-c*u)/f:(-E-m*u)/z),b*(u=Math.abs(n[i][x]))*u>1)for(o=i;o<=x;o++)n[o][x]=n[o][x]/u}else if(k<0)for(l=x-1,Math.abs(n[x][x-1])>Math.abs(n[x-1][x])?(n[x-1][x-1]=k/n[x][x-1],n[x-1][x]=-(n[x][x]-S)/n[x][x-1]):(y=cdiv(0,-n[x-1][x],n[x-1][x-1]-S,k),n[x-1][x-1]=y[0],n[x-1][x]=y[1]),n[x][x-1]=0,n[x][x]=1,i=x-2;i>=0;i--){for(g=0,p=0,o=l;o<=x;o++)g+=n[i][o]*n[o][x-1],p+=n[i][o]*n[o][x];if(c=n[i][i]-S,t[i]<0)z=c,_=g,E=p;else if(l=i,0===t[i]?(y=cdiv(-g,-p,c,k),n[i][x-1]=y[0],n[i][x]=y[1]):(f=n[i][i+1],m=n[i+1][i],v=(e[i]-S)*(e[i]-S)+t[i]*t[i]-k*k,d=2*(e[i]-S)*k,0===v&&0===d&&(v=b*A*(Math.abs(c)+Math.abs(k)+Math.abs(f)+Math.abs(m)+Math.abs(z))),y=cdiv(f*_-z*g+k*p,f*E-z*p-k*g,v,d),n[i][x-1]=y[0],n[i][x]=y[1],Math.abs(f)>Math.abs(z)+Math.abs(k)?(n[i+1][x-1]=(-g-c*n[i][x-1]+k*n[i][x])/f,n[i+1][x]=(-p-c*n[i][x]-k*n[i][x-1])/f):(y=cdiv(-_-m*n[i][x-1],-E-m*n[i][x],z,k),n[i+1][x-1]=y[0],n[i+1][x]=y[1])),b*(u=Math.max(Math.abs(n[i][x-1]),Math.abs(n[i][x])))*u>1)for(o=i;o<=x;o++)n[o][x-1]=n[o][x-1]/u,n[o][x]=n[o][x]/u}for(i=0;i<r;i++)if(i<0||i>M)for(o=i;o<r;o++)a[i][o]=n[i][o];for(o=r-1;o>=0;o--)for(i=0;i<=M;i++){for(z=0,s=0;s<=Math.min(o,M);s++)z+=a[i][s]*n[s][o];a[i][o]=z}}}function cdiv(r,t,e,a){var n,i;return Math.abs(e)>Math.abs(a)?[(r+(n=a/e)*t)/(i=e+n*a),(t-n*r)/i]:[((n=e/a)*r+t)/(i=a+n*e),(n*t-r)/i]}EigenvalueDecomposition.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return Matrix$1.isMatrix(this.V)||(this.V=new Matrix$1(this.V)),this.V},get diagonalMatrix(){var r,t,e=this.n,a=this.e,n=this.d,i=new Matrix$1(e,e);for(r=0;r<e;r++){for(t=0;t<e;t++)i[r][t]=0;i[r][r]=n[r],a[r]>0?i[r][r+1]=a[r]:a[r]<0&&(i[r][r-1]=a[r])}return i}};var evd=EigenvalueDecomposition,Matrix$2=matrix$2.Matrix,hypotenuse$3=util.hypotenuse;function QrDecomposition(r){if(!(this instanceof QrDecomposition))return new QrDecomposition(r);var t,e,a,n,i=(r=Matrix$2.checkMatrix(r)).clone(),o=r.rows,s=r.columns,l=new Array(s);for(a=0;a<s;a++){var h=0;for(t=a;t<o;t++)h=hypotenuse$3(h,i[t][a]);if(0!==h){for(i[a][a]<0&&(h=-h),t=a;t<o;t++)i[t][a]/=h;for(i[a][a]+=1,e=a+1;e<s;e++){for(n=0,t=a;t<o;t++)n+=i[t][a]*i[t][e];for(n=-n/i[a][a],t=a;t<o;t++)i[t][e]+=n*i[t][a]}}l[a]=-h}this.QR=i,this.Rdiag=l}QrDecomposition.prototype={solve:function(r){r=Matrix$2.checkMatrix(r);var t=this.QR,e=t.rows;if(r.rows!==e)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var a,n,i,o,s=r.columns,l=r.clone(),h=t.columns;for(i=0;i<h;i++)for(n=0;n<s;n++){for(o=0,a=i;a<e;a++)o+=t[a][i]*l[a][n];for(o=-o/t[i][i],a=i;a<e;a++)l[a][n]+=o*t[a][i]}for(i=h-1;i>=0;i--){for(n=0;n<s;n++)l[i][n]/=this.Rdiag[i];for(a=0;a<i;a++)for(n=0;n<s;n++)l[a][n]-=l[i][n]*t[a][i]}return l.subMatrix(0,h-1,0,s-1)},isFullRank:function(){for(var r=this.QR.columns,t=0;t<r;t++)if(0===this.Rdiag[t])return!1;return!0},get upperTriangularMatrix(){var r,t,e=this.QR,a=e.columns,n=new Matrix$2(a,a);for(r=0;r<a;r++)for(t=0;t<a;t++)n[r][t]=r<t?e[r][t]:r===t?this.Rdiag[r]:0;return n},get orthogonalMatrix(){var r,t,e,a,n=this.QR,i=n.rows,o=n.columns,s=new Matrix$2(i,o);for(e=o-1;e>=0;e--){for(r=0;r<i;r++)s[r][e]=0;for(s[e][e]=1,t=e;t<o;t++)if(0!==n[e][e]){for(a=0,r=e;r<i;r++)a+=n[r][e]*s[r][t];for(a=-a/n[e][e],r=e;r<i;r++)s[r][t]+=a*n[r][e]}}return s}};var qr=QrDecomposition,Matrix$3=matrix$2.Matrix;function CholeskyDecomposition(r){if(!(this instanceof CholeskyDecomposition))return new CholeskyDecomposition(r);if(!(r=Matrix$3.checkMatrix(r)).isSymmetric())throw new Error("Matrix is not symmetric");var t,e,a,n=r,i=n.rows,o=new Matrix$3(i,i),s=!0;for(e=0;e<i;e++){var l=o[e],h=0;for(a=0;a<e;a++){var u=o[a],c=0;for(t=0;t<a;t++)c+=u[t]*l[t];l[a]=c=(n[e][a]-c)/o[a][a],h+=c*c}for(s&=(h=n[e][e]-h)>0,o[e][e]=Math.sqrt(Math.max(h,0)),a=e+1;a<i;a++)o[e][a]=0}if(!s)throw new Error("Matrix is not positive definite");this.L=o}CholeskyDecomposition.prototype={get lowerTriangularMatrix(){return this.L},solve:function(r){r=Matrix$3.checkMatrix(r);var t=this.L,e=t.rows;if(r.rows!==e)throw new Error("Matrix dimensions do not match");var a,n,i,o=r.columns,s=r.clone();for(i=0;i<e;i++)for(n=0;n<o;n++){for(a=0;a<i;a++)s[i][n]-=s[a][n]*t[i][a];s[i][n]/=t[i][i]}for(i=e-1;i>=0;i--)for(n=0;n<o;n++){for(a=i+1;a<e;a++)s[i][n]-=s[a][n]*t[a][i];s[i][n]/=t[i][i]}return s}};var cholesky=CholeskyDecomposition,Matrix$4=matrix$2.Matrix;function inverse(r){return solve(r=Matrix$4.checkMatrix(r),Matrix$4.eye(r.rows))}function solve(r,t){return r=Matrix$4.checkMatrix(r),t=Matrix$4.checkMatrix(t),r.isSquare()?new lu(r).solve(t):new qr(r).solve(t)}Matrix$4.inverse=Matrix$4.inv=inverse,Matrix$4.prototype.inverse=Matrix$4.prototype.inv=function(){return inverse(this)},Matrix$4.solve=solve,Matrix$4.prototype.solve=function(r){return solve(this,r)};var decompositions={SingularValueDecomposition:svd,SVD:svd,EigenvalueDecomposition:evd,EVD:evd,LuDecomposition:lu,LU:lu,QrDecomposition:qr,QR:qr,CholeskyDecomposition:cholesky,CHO:cholesky,inverse:inverse,solve:solve},src$3=createCommonjsModule(function(r){r.exports=matrix$2.Matrix,r.exports.Decompositions=r.exports.DC=decompositions}),src_1$1=src$3.Decompositions,src_2$1=src$3.DC;function matrix$3(r,t){return new src$3(r,t)}function ones(r,t){return src$3.ones(r,t)}function eye(r,t){return src$3.eye(r,t)}function zeros(r,t){return src$3.zeros(r,t)}function random(r,t){return src$3.rand(r,t)}function transpose$2(r){return"number"==typeof r?r:r.clone().transpose()}function add(r,t){return"number"==typeof r&&"number"==typeof t?r+t:"number"==typeof r?this.add(t,r):r.clone().add(t)}function subtract(r,t){return"number"==typeof r&&"number"==typeof t?r-t:"number"==typeof r?this.subtract(t,r):r.clone().sub(t)}function multiply(r,t){if("number"==typeof r&&"number"==typeof t)return r*t;if("number"==typeof r)return this.multiply(t,r);var e=r.clone();return"number"==typeof t?e.mul(t):e=e.mmul(t),1==e.rows&&1==e.columns?e[0][0]:e}function dotMultiply(r,t){return r.clone().mul(t)}function dotDivide(r,t){return r.clone().div(t)}function diag(r){var t,e,a=null,n=r.rows,i=r.columns;if(void 0===i&&"object"==typeof r)if(r[0]&&r[0].length)for(n=r.length,i=r[0].length,e=Math.min(n,i),a=src$3.zeros(i,i),t=0;t<i;t++)a[t][t]=r[t][t];else for(i=r.length,a=src$3.zeros(i,i),t=0;t<i;t++)a[t][t]=r[t];if(1==n)for(a=src$3.zeros(i,i),t=0;t<i;t++)a[t][t]=r[0][t];else if(n>0&&i>0)for(e=Math.min(n,i),a=new Array(e),t=0;t<e;t++)a[t]=r[t][t];return a}function min$1(r,t){if("number"==typeof r&&"number"==typeof t)return Math.min(r,t);for(var e=r.rows,a=r.columns,n=new src$3(e,a),i=0;i<e;i++)for(var o=0;o<a;o++)r[i][o]<t[i][o]?n[i][o]=r[i][o]:n[i][o]=t[i][o];return n}function max$1(r,t){if("number"==typeof r&&"number"==typeof t)return Math.max(r,t);for(var e=r.rows,a=r.columns,n=new src$3(e,a),i=0;i<e;i++)for(var o=0;o<a;o++)r[i][o]>t[i][o]?n[i][o]=r[i][o]:n[i][o]=t[i][o];return n}function sqrt(r){if("number"==typeof r)return Math.sqrt(r);for(var t=r.rows,e=r.columns,a=new src$3(t,e),n=0;n<t;n++)for(var i=0;i<e;i++)a[n][i]=Math.sqrt(r[n][i]);return a}function abs(r){if("number"==typeof r)return Math.abs(r);for(var t=r.rows,e=r.columns,a=new src$3(t,e),n=0;n<t;n++)for(var i=0;i<e;i++)a[n][i]=Math.abs(r[n][i]);return a}function exp(r){if("number"==typeof r)return Math.sqrt(r);for(var t=r.rows,e=r.columns,a=new src$3(t,e),n=0;n<t;n++)for(var i=0;i<e;i++)a[n][i]=Math.exp(r[n][i]);return a}function dotPow(r,t){if("number"==typeof r)return Math.pow(r,t);for(var e=r.rows,a=r.columns,n=new src$3(e,a),i=0;i<e;i++)for(var o=0;o<a;o++)n[i][o]=Math.pow(r[i][o],t);return n}function solve$1(r,t){return r.solve(t)}function inv(r){return"number"==typeof r?1/r:r.inverse()}var algebra={transpose:transpose$2,add:add,subtract:subtract,multiply:multiply,dotMultiply:dotMultiply,dotDivide:dotDivide,diag:diag,min:min$1,max:max$1,solve:solve$1,inv:inv,sqrt:sqrt,exp:exp,dotPow:dotPow,abs:abs,matrix:matrix$3,ones:ones,zeros:zeros,random:random,eye:eye},LM={optimize:function(r,t,e,a,n,i,o,s,l,h){var u=0;if("object"!=typeof t[0])for(var c=0;c<t.length;c++)t[c]=[t[c]];var f=t.length,m=a.length,g=src$3.zeros(f,1),p=src$3.zeros(m,1),v=-2e-4,d=-2e-4,w=src$3.zeros(m,f);if(e.length==a.length){n=n||Math.sqrt((m-f+1)/algebra.multiply(algebra.transpose(a),a)),i=i||.001,o=o||algebra.multiply(Math.abs(t),-100),s=s||algebra.multiply(Math.abs(t),100),l=l||1;(h=h||[3,10*f,.001,.001,.001,.01,.01,11,9,1])[0];var y=h[1],x=h[2],M=(h[3],h[4],h[5]),b=h[6],$=h[7],A=h[8],S=h[9];if(!i.length||1==i.length){var k=new Array(f);for(c=0;c<f;c++)k[c]=[i];i=k}var _=[];for(c=0;c<i.length;c++)0!=i[c][0]&&_.push(c);var E=_.length,z=!1,R=null;if(!n.length||n.length<m){var C=algebra.multiply(src$3.ones(m,1),n[0]);R=algebra.dotMultiply(C,C)}else R=algebra.dotMultiply(n,n);var D=this.lm_matx(r,e,g,p,1,w,t,a,R,i,l),V=D.JtWJ,O=D.JtWdy,T=(v=D.Chi_sq,D.y_hat);w=D.J;switch(Math.max(Math.abs(O))<x&&(console.log(" *** Your Initial Guess is Extremely Close to Optimal ***"),console.log(" *** epsilon_1 = ",x),z=!0),S){case 1:lambda=b;break;default:lambda=b*Math.max(algebra.diag(V)),nu=2}d=v;for(var F=null;!z&&u<=y;){switch(u+=1,S){case 1:F=algebra.solve(algebra.add(V,algebra.multiply(algebra.diag(algebra.diag(V)),lambda)),O);break;default:F=algebra.solve(algebra.add(V,algebra.multiply(src$3.eye(f),lambda)),O)}var q=new Array(_.length);for(X=0;X<_.length;X++)q[X]=F[_[X]];var I=algebra.add(t,q);for(X=0;X<I.length;X++)I[X][0]=Math.min(Math.max(o[X][0],I[X][0]),s[X][0]);var j=algebra.subtract(a,r(e,I,l)),L=algebra.multiply(algebra.transpose(j),algebra.dotMultiply(j,R));if(2==S){var P=algebra.multiply(algebra.transpose(O),F),N=algebra.multiply(P,algebra.inv(algebra.add(algebra.multiply(algebra.subtract(L-v),.5)),algebra.multiply(P,2)));F=algebra.multiply(N,F);for(var X=0;X<_.length;X++)q[X]=F[_[X]];I=algebra.add(t,q),I=algebra.min(algebra.max(o,I),s),j=algebra.subtract(a,r(e,I,l)),L=algebra.multiply(algebra.transpose(j),mat.dotMultiply(j,R))}var W=(v-L)/algebra.multiply(algebra.multiply(algebra.transpose(F),2),algebra.add(algebra.multiply(lambda,F),O));if(W>M)switch(dX2=v-d,d=v,g=t,p=T,t=I,V=(D=this.lm_matx(r,e,g,p,dX2,w,t,a,R,i,l)).JtWJ,O=D.JtWdy,v=D.Chi_sq,T=D.y_hat,w=D.J,S){case 1:lambda=Math.max(lambda/A,1e-7);break;case 2:lambda=Math.max(lambda/(1+N),1e-7);break;case 3:lambda=algebra.multiply(Math.max(1/3,1-(2*W-1)^3),lambda),nu=2}else switch(v=d,u%(2*f)==0&&(V=(D=this.lm_matx(r,e,g,p,-1,w,t,a,R,i,l)).JtWJ,O=D.JtWdy,dX2=D.Chi_sq,T=D.y_hat,w=D.J),S){case 1:lambda=Math.min(lambda*$,1e7);break;case 2:lambda+=Math.abs((L-v)/2/N);break;case 3:lambda*=nu,nu*=2}}return(R=algebra.multiply(algebra.multiply(algebra.transpose(j),j),src$3.ones(m,1))).apply(function(r,t){R[r][t]=(m-E+1)/R[r][t]}),V=(D=this.lm_matx(r,e,g,p,-1,w,t,a,R,i,l)).JtWJ,O=D.JtWdy,v=D.Chi_sq,T=D.y_hat,w=D.J,{p:t,X2:v}}console.log("lm.m error: the length of t must equal the length of y_dat"),length_t=e.length,length_y_dat=a.length;var v=0},lm_FD_J:function(r,t,e,a,n,i){var o=a.length,s=e.length;n=n||algebra.multiply(src$3.ones(s,1),.001);for(var l=e.clone(),h=new src$3(o,s),u=new Array(s),c=0;c<s;c++){if(u[c]=n[c]*(1+Math.abs(e[c][0])),e[c]=[l[c][0]+u[c]],0!=u[c])if(y1=r(t,e,i),n[c][0]<0)for(var f=algebra.dotDivide(algebra.subtract(y1,a),u[c]),m=0;m<o;m++)h[m][c]=f[m][0];else{e[c][0]=l[c][0]-u[c];for(f=algebra.dotDivide(algebra.subtract(y1,r(t,e,i)),2*u[c]),m=0;m<o;m++)h[m][c]=f[m][0]}e[c]=l[c]}return h},lm_Broyden_J:function(r,t,e,a,n){var i=algebra.subtract(a,r),o=algebra.transpose(i);return o.div(algebra.multiply(o,i)),e=algebra.add(e,algebra.multiply(algebra.subtract(n,algebra.add(t,algebra.multiply(e,i))),o))},lm_matx:function(r,t,e,a,n,i,o,s,l,h,u,c){s.length;var f=o.length;h=h||.001;var m=r(t,o,u);i=c%(2*f)==0||n>0?this.lm_FD_J(r,t,o,m,h,u):this.lm_Broyden_J(e,a,i,o,m);var g=algebra.subtract(s,m),p=algebra.multiply(algebra.transpose(g),algebra.dotMultiply(g,l)),v=algebra.transpose(i);return{JtWJ:algebra.multiply(v,algebra.dotMultiply(i,algebra.multiply(l,src$3.ones(1,f)))),JtWdy:algebra.multiply(v,algebra.dotMultiply(l,g)),Chi_sq:p,y_hat:m,J:i}}},LM_1=LM,src$4=createCommonjsModule(function(r){r.exports=LM_1,r.exports.Matrix=src$3,r.exports.Matrix.algebra=algebra}),src_1$2=src$4.Matrix,math=src$4.Matrix.algebra;function sumOfLorentzians(r,t,e){var a,n,i,o,s=t.length/3,l=r.rows,h=src$3.zeros(r.length,1);for(n=0;n<s;n++)for(o=Math.pow(t[n+2*s][0]/2,2),a=t[n+s][0]*o,i=0;i<l;i++)h[i][0]+=a/(Math.pow(r[i][0]-t[n][0],2)+o);return h}function singleLorentzian(r,t,e){for(var a=t[1][0]*Math.pow(t[2][0]/2,2),n=r.rows,i=new src$3(r.rows,r.columns),o=0;o<n;o++)i[o][0]=a/(Math.pow(r[o][0]-t[0][0],2)+Math.pow(t[2][0]/2,2));return i}function singleGaussian(r,t,e){for(var a=t[2][0]*t[2][0]/2,n=r.rows,i=new src$3(r.rows,r.columns),o=0;o<n;o++)i[o][0]=t[1][0]*Math.exp(-(r[o][0]-t[0][0])*(r[o][0]-t[0][0])/a);return i}function optimizeSingleLorentzian(r,t,e){var a=parseData(r,(e=e||{}).percentage||0);if(null===a||a[0].rows<3)return null;var n=a[0],i=a[1],o=a[2],s=[n.rows/Math.sqrt(i.dot(i))],l=(e=Object.create(e.LMOptions||[3,100,.001,.001,.001,.01,.01,11,9,1]),Math.abs(n[0][0]-n[1][0])),h=new src$3([[-l/1e4],[-.001],[-l/1e4]]),u=new src$3([[t.x],[1],[t.width]]),c=new src$3([[t.x-l],[.75],[t.width/4]]),f=new src$3([[t.x+l],[1.25],[4*t.width]]),m=src$4.optimize(singleLorentzian,u,n,i,s,h,c,f,[],e);return[(m=m.p)[0],[m[1][0]*o],m[2]]}function optimizeSingleGaussian(r,t,e){var a=parseData(r,(e=e||{}).percentage||0);if(null===a||a[0].rows<3)return null;var n=a[0],i=a[1],o=a[2],s=[n.rows/Math.sqrt(i.dot(i))],l=(e=Object.create(e.LMOptions||[3,100,.001,.001,.001,.01,.01,11,9,1]),Math.abs(n[0][0]-n[1][0])),h=new src$3([[-l/1e4],[-.001],[-l/1e4]]),u=(h=new src$3([[-Math.abs(n[0][0]-n[1][0])/1e3],[-.001],[-t.width/1e3]]),new src$3([[t.x],[1],[t.width]])),c=new src$3([[t.x-l],[.75],[t.width/4]]),f=new src$3([[t.x+l],[1.25],[4*t.width]]),m=src$4.optimize(singleGaussian,u,n,i,s,h,c,f,[],e);return[(m=m.p)[0],[m[1][0]*o],m[2]]}function optimizeLorentzianTrain(r,t,e){var a=parseData(r);if(null===a||a[0].rows<3)return null;for(var n,i,o,s,l=a[0],h=a[1],u=a[2],c=0,f=l.length,m=[],g=0;g<t.length;g++){for(n=t[g].x-1.5*t[g].width;l[c++]<n&&c<f;);for(n=t[g].x+1.5*t[g].width,i=[],o=[];l[c]<=n&&c<f;)i.push(l[c][0]),o.push(h[c][0]*u),c++;(s=optimizeSingleLorentzian([i,o],t[g],e))?m.push({x:s[0][0],y:s[1][0],width:s[2][0],opt:!0}):m.push({x:t[g].x,y:t[g].y,width:t[g].width,opt:!1})}return m}function optimizeGaussianTrain(r,t,e){var a=parseData(r);if(null===a||a[0].rows<3)return null;for(var n,i,o,s,l=a[0],h=a[1],u=a[2],c=0,f=l.length,m=[],g=0;g<t.length;g++){for(n=t[g].x-1.5*t[g].width;l[c++]<n&&c<f;);for(n=t[g].x+1.5*t[g].width,i=[],o=[];l[c]<=n&&c<f;)i.push(l[c][0]),o.push(h[c][0]*u),c++;(s=optimizeSingleGaussian([i,o],t[g],e))?m.push({x:s[0][0],y:s[1][0],width:s[2][0],opt:!0}):m.push({x:t[g].x,y:t[g].y,width:t[g].width,opt:!1})}return m}function optimizeLorentzianSum(r,t,e){var a=parseData(r);if(null===a||a[0].rows<3)return null;var n,i=a[0],o=a[1],s=a[2],l=[i.rows/math.sqrt(o.dot(o))],h=(e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,1]),t.length),u=new src$3(3*h,1),c=new src$3(3*h,1),f=new src$3(3*h,1),m=new src$3(3*h,1),g=Math.abs(i[0][0]-i[1][0]);for(n=0;n<h;n++)u[n][0]=t[n].x,u[n+h][0]=1,u[n+2*h][0]=t[n].width,c[n][0]=t[n].x-g,c[n+h][0]=0,c[n+2*h][0]=t[n].width/4,f[n][0]=t[n].x+g,f[n+h][0]=1.5,f[n+2*h][0]=4*t[n].width,m[n][0]=-g/1e3,m[n+h][0]=-.001,m[n+2*h][0]=-g/1e3;m=-Math.abs(i[0][0]-i[1][0])/1e4;var p=src$4.optimize(sumOfLorentzians,u,i,o,l,m,c,f,[],e);p=p.p;var v=new Array(h);for(n=0;n<h;n++)v[n]=[p[n],[p[n+h][0]*s],p[n+2*h]];return v}function optimizeGaussianSum(r,t,e){var a=parseData(r);if(null===a||a[0].rows<3)return null;var n,i=a[0],o=a[1],s=a[2],l=i.rows,h=new src$3(l,1),u=l/math.sqrt(o.dot(o));for(n=0;n<l;n++)h[n][0]=u;e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,2]);var c=t.length,f=new src$3(3*c,1),m=new src$3(3*c,1),g=new src$3(3*c,1),p=new src$3(3*c,1),v=Math.abs(i[0][0]-i[1][0]);for(n=0;n<c;n++)f[n][0]=t[n].x,f[n+c][0]=t[n].y/s,f[n+2*c][0]=t[n].width,m[n][0]=t[n].x-v,m[n+c][0]=.8*t[n].y/s,m[n+2*c][0]=t[n].width/2,g[n][0]=t[n].x+v,g[n+c][0]=1.2*t[n].y/s,g[n+2*c][0]=2*t[n].width,p[n][0]=-v/1e3,p[n+c][0]=-.001,p[n+2*c][0]=-v/1e3;var d=src$4.optimize(sumOfLorentzians,f,i,o,h,p,m,g,[],e);d=d.p;var w=new Array(c);for(n=0;n<c;n++)w[n]=[d[n],[d[n+c][0]*s],d[n+2*c]];return w}function parseData(r,t){var e,a,n,i=r.length,o=null,s=null,l=0;if(2==i){var h=r[0].length;if(o=new Array(h),s=new Array(h),e=r[0],a=r[1],"number"==typeof e[0])for(n=0;n<h;n++)o[n]=e[n],s[n]=a[n],a[n]>l&&(l=a[n]);else if("object"==typeof e[0])for(n=0;n<h;n++)o[n]=e[n][0],s[n]=a[n][0],a[n][0]>l&&(l=a[n][0])}else{h=i;for(o=new Array(h),s=new Array(h),n=0;n<h;n++)o[n]=r[n][0],s[n]=r[n][1],s[n]>l&&(l=s[n])}for(n=0;n<h;n++)s[n]/=l;if(t)for(n=h-1;n>=0;n--)s[n]<t&&(s.splice(n,1),o.splice(n,1));return o.length>0?[new src$3([o]).transpose(),new src$3([s]).transpose(),l]:null}var optimizeSingleLorentzian_1=optimizeSingleLorentzian,optimizeLorentzianSum_1=optimizeLorentzianSum,optimizeSingleGaussian_1=optimizeSingleGaussian,optimizeGaussianSum_1=optimizeGaussianSum,singleGaussian_1=singleGaussian,singleLorentzian_1=singleLorentzian,optimizeGaussianTrain_1=optimizeGaussianTrain,optimizeLorentzianTrain_1=optimizeLorentzianTrain,src$5={optimizeSingleLorentzian:optimizeSingleLorentzian_1,optimizeLorentzianSum:optimizeLorentzianSum_1,optimizeSingleGaussian:optimizeSingleGaussian_1,optimizeGaussianSum:optimizeGaussianSum_1,singleGaussian:singleGaussian_1,singleLorentzian:singleLorentzian_1,optimizeGaussianTrain:optimizeGaussianTrain_1,optimizeLorentzianTrain:optimizeLorentzianTrain_1};function sampleFunction(r,t,e,a,n){var i=e.length,o=[],s=[],l=Math.sign(e[1]-e[0]);-1===l&&(n[0]=e.length-1);for(var h=Math.abs(t-r)/2,u=(r+t)/2,c=!1,f=n[0];!c&&f<i&&f>=0;)Math.abs(e[f]-u)<=h?(o.push(e[f]),s.push(a[f]),f+=l):1===Math.sign(u-e[f])?f+=l:c=!0;return n[0]=f,[o,s]}var optimizePeaks=function(r,t,e,a,n){var i,o,s,l,h,u=[0],c=groupPeaks(r,a),f=[],m=1;for("gaussian"===n&&(m=1.17741),i=0;i<c.length;i++){var g=c[i].group;if(g.length>1){if((s=sampleFunction(c[i].limits[0]-c[i].limits[1],c[i].limits[0]+c[i].limits[1],t,e,u))[0].length>5){h=[3,100,l=g[0].width/1e3,l,l,10*l,10*l,11,9,1];var p=[];for("gaussian"===n?p=src$5.optimizeGaussianSum(s,g,h):"lorentzian"===n&&(p=src$5.optimizeLorentzianSum(s,g,h)),o=0;o<p.length;o++)f.push({x:p[o][0][0],y:p[o][1][0],width:p[o][2][0]*m})}}else if((s=sampleFunction((g=g[0]).x-a*g.width,g.x+a*g.width,t,e,u))[0].length>5){h=[3,100,l=g.width/1e3,l,l,10*l,10*l,11,9,1];var v=[];"gaussian"===n?v=src$5.optimizeSingleGaussian([s[0],s[1]],g,h):"lorentzian"===n&&(v=src$5.optimizeSingleLorentzian([s[0],s[1]],g,h)),f.push({x:v[0][0],y:v[1][0],width:v[2][0]*m})}}return f};function groupPeaks(r,t){var e,a,n,i,o=[],s=[],l=[r[0].x,t*r[0].width];for(e=0;e<r.length;e++)Math.abs(r[e].x-l[0])<t*r[e].width+l[1]?(o.push(r[e]),n=l[0]+l[1],r[e].x+t*r[e].width>n&&(n=r[e].x+t*r[e].width),i=l[0]-l[1],r[e].x-t*r[e].width<i&&(i=r[e].x-t*r[e].width),l=[(n+i)/2,Math.abs(n-i)/2]):(s.push({limits:l,group:o}),o=[r[e]],l=[r[e].x,t*r[e].width]);for(s.push({limits:l,group:o}),e=s.length-2;e>=0;e--)if(Math.abs(s[e].limits[0]-s[e+1].limits[0])<(s[e].limits[1]+s[e+1].limits[1])/2){for(a=0;a<s[e+1].group.length;a++)s[e].group.push(s[e+1].group[a]);n=s[e].limits[0]+s[e].limits[1],s[e+1].limits[0]+s[e+1].limits[1]>n&&(n=s[e+1].limits[0]+s[e+1].limits[1]),i=s[e].limits[0]-s[e].limits[1],s[e+1].limits[0]-s[e+1].limits[1]<i&&(i=s[e+1].limits[0]-s[e+1].limits[1]),s[e].limits=[(n+i)/2,Math.abs(n-i)/2],s.splice(e+1,1)}return s}var joinBroadPeaks=function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var e=t.width,a=[],n=0,i=0,o=1;for(let t=r.length-1;t>=0;t--)r[t].soft&&a.push(r.splice(t,1)[0]);a.push({x:Number.MAX_VALUE});var s=[[a[0].x,a[0].y]],l=[0];for(let t=1;t<a.length;t++)if(Math.abs(a[t-1].x-a[t].x)<e)s.push([a[t].x,a[t].y]),a[t].y>n&&(n=a[t].y,i=t),l.push(t),o++;else{if(o>2){var h=src$5.optimizeSingleLorentzian(s,{x:a[i].x,y:n,width:Math.abs(s[0][0]-s[s.length-1][0])});r.push({x:h[0][0],y:h[1][0],width:h[2][0],soft:!1})}else l.forEach(t=>{r.push(a[t])});s=[[a[t].x,a[t].y]],l=[t],n=a[t].y,i=t,o=1}return r.sort(function(r,t){return r.x-t.x}),r},broadenPeaks=function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{factor:e=2,overlap:a=!1}=t;for(let t of r)t.from=t.x-t.width/2*e,t.to=t.x+t.width/2*e;if(!a)for(let t=0;t<r.length-1;t++){let e=r[t],a=r[t+1];e.to>a.from&&(e.to=a.from=(e.to+a.from)/2)}for(let t of r)t.width=t.to-t.from;return r},gsd$1=gsd_1,post={optimizePeaks:optimizePeaks,joinBroadPeaks:joinBroadPeaks,broadenPeaks:broadenPeaks},src$6={gsd:gsd$1,post:post};function getConverter(){const r=/[, \t]+/,t=["TIC",".RIC","SCANNUMBER"];function e(r){var t=[];for(let e=0;e<r.length;e++)t.push(parseFloat(r[e]));return t}class a{}const n={keepRecordsRegExp:/^$/,xy:!1,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};function i(r){return r.toLowerCase().replace(/[^a-z0-9]/g,"")}function o(r){return-1!==t.indexOf(r)}function s(r,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),t.shiftOffsetVal){var e=t.firstX-t.shiftOffsetVal;t.firstX=t.firstX-e,t.lastX=t.lastX-e}}function l(r){var t=(r=r.sort(h)).length;return r[Math.floor(t/2)]}function h(r,t){return r-t}function u(r,t){var e=r.yFactor,a=r.deltaX;r.isXYdata=!0;var n=[];r.data=[n];var i,o=r.firstX,s=r.firstY,l=!1;let h=0;for(;h<t.length;h++)if(13===(i=t.charCodeAt(h))||10===i)l=!0;else if(l)break;for(var u=!0,c=!1,f=!1,m=0,g=!1,p=!1,v=0,d=0,w=!1,y=!1,x=!1,M=0;h<=t.length;h++)if(i=h===t.length?13:t.charCodeAt(h),p)13!==i&&10!==i||(u=!0,p=!1);else if(i<=57&&i>=48)y=!0,M>0?v+=(i-48)/Math.pow(10,M++):(v*=10,v+=i-48);else if(44===i||46===i)y=!0,M++;else{if(y){if(u)u=!1,f&&(x=!0);else if(x)x=!1;else{c?(m=w?0-v:v,f=!0,c=!1):g||(d=w?0-v:v);for(var b=g?v-1:1,$=0;$<b;$++)f?s+=m:s=d,n.push(o),n.push(s*e),o+=a}w=!1,v=0,M=0,y=!1,g=!1}if(i<74&&i>63)y=!0,f=!1,v=i-64;else if(i>96&&i<106)y=!0,f=!1,v=i-96,w=!0;else if(115===i)y=!0,g=!0,v=9;else if(i>82&&i<91)y=!0,g=!0,v=i-82;else if(i>73&&i<83)y=!0,c=!0,v=i-73;else if(i>105&&i<115)y=!0,c=!0,v=i-105,w=!0;else if(36===i&&36===t.charCodeAt(h+1))y=!0,p=!0;else if(37===i)y=!0,c=!0,v=0,w=!1;else if(45===i){var A=t.charCodeAt(h+1);(A>=48&&A<=57||44===A||46===A)&&(y=!0,u||(f=!1),w=!0)}else 13!==i&&10!==i||(u=!0,p=!1)}}function c(r,t){var e,a=/(\(+|\)+|<+|>+|\s+)/g;r.isXYAdata=!0;var n=[];r.data=[n];var i=t.split(/,? *,?[;\r\n]+ */);for(let r=1;r<i.length;r++)e=i[r].trim().replace(a,"").split(","),n.push(parseFloat(e[0])),n.push(parseFloat(e[1]))}function f(r,t,e){var a,n=/\$\$.*/,i=/[,\t ]+/;r.isPeaktable=!0;var o=[];r.data=[o];var s=t.split(/,? *,?[;\r\n]+ */);for(let t=1;t<s.length;t++)if((a=s[t].trim().replace(n,"").split(i)).length%2==0)for(let t=0;t<a.length;t+=2)o.push(parseFloat(a[t])*r.xFactor),o.push(parseFloat(a[t+1])*r.yFactor);else e.logs.push("Format error: ".concat(a))}return function(h,m){var g,p,v,d,w,y,x,M=!(m=Object.assign({},n,m)).withoutXY,b=Date.now(),$={},A={};A.profiling=!!m.profiling&&[],A.logs=[];var S=[];A.spectra=S,A.info={};var k=new a;if("string"!=typeof h)throw new TypeError("the JCAMP should be a string");A.profiling&&A.profiling.push({action:"Before split to LDRS",time:Date.now()-b}),d=h.split(/[\r\n]+##/),A.profiling&&A.profiling.push({action:"Split to LDRS",time:Date.now()-b}),d[0]&&(d[0]=d[0].replace(/^[\r\n ]*##/,""));for(let t=0;t<d.length;t++){if((w=(g=d[t]).indexOf("="))>0?(p=g.substring(0,w),v=g.substring(w+1).trim()):(p=g,v=""),"DATATABLE"===(p=p.replace(/[_ -]/g,"").toUpperCase())&&(-1===(y=v.indexOf("\n"))&&(y=v.indexOf("\r")),y>0)){var _=-1,E=-1;if((x=v.substring(0,y).split(/[ ,;\t]+/))[0].indexOf("++")>0){var z=x[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),R=x[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");_=$.symbol.indexOf(z),E=$.symbol.indexOf(R)}-1===_&&(_=0),-1===E&&(E=0),$.first&&($.first.length>_&&(k.firstX=$.first[_]),$.first.length>E&&(k.firstY=$.first[E])),$.last&&($.last.length>_&&(k.lastX=$.last[_]),$.last.length>E&&(k.lastY=$.last[E])),$.vardim&&$.vardim.length>_&&(k.nbPoints=$.vardim[_]),$.factor&&($.factor.length>_&&(k.xFactor=$.factor[_]),$.factor.length>E&&(k.yFactor=$.factor[E])),$.units&&($.units.length>_&&(k.xUnit=$.units[_]),$.units.length>E&&(k.yUnit=$.units[E])),k.datatable=x[0],x[1]&&x[1].indexOf("PEAKS")>-1?p="PEAKTABLE":x[1]&&(x[1].indexOf("XYDATA")||x[0].indexOf("++")>0)&&(p="XYDATA",k.deltaX=(k.lastX-k.firstX)/(k.nbPoints-1))}if("XYDATA"!==p)if("PEAKTABLE"!==p)if("PEAKASSIGNMENTS"!==p){if("TITLE"===p)k.title=v;else if("DATATYPE"===p)k.dataType=v,v.indexOf("nD")>-1&&(A.twoD=!0);else if("NTUPLES"===p)v.indexOf("nD")>-1&&(A.twoD=!0);else if("XUNITS"===p)k.xUnit=v;else if("YUNITS"===p)k.yUnit=v;else if("FIRSTX"===p)k.firstX=parseFloat(v);else if("LASTX"===p)k.lastX=parseFloat(v);else if("FIRSTY"===p)k.firstY=parseFloat(v);else if("LASTY"===p)k.lastY=parseFloat(v);else if("NPOINTS"===p)k.nbPoints=parseFloat(v);else if("XFACTOR"===p)k.xFactor=parseFloat(v);else if("YFACTOR"===p)k.yFactor=parseFloat(v);else if("MAXX"===p)k.maxX=parseFloat(v);else if("MINX"===p)k.minX=parseFloat(v);else if("MAXY"===p)k.maxY=parseFloat(v);else if("MINY"===p)k.minY=parseFloat(v);else if("DELTAX"===p)k.deltaX=parseFloat(v);else if(".OBSERVEFREQUENCY"===p||"$SFO1"===p)k.observeFrequency||(k.observeFrequency=parseFloat(v));else if(".OBSERVENUCLEUS"===p)k.xType||(A.xType=v.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===p)A.indirectFrequency||(A.indirectFrequency=parseFloat(v));else if("$OFFSET"===p)A.shiftOffsetNum=0,k.shiftOffsetVal||(k.shiftOffsetVal=parseFloat(v));else if("$REFERENCEPOINT"===p);else if("VARNAME"===p)$.varname=v.split(r);else if("SYMBOL"===p)$.symbol=v.split(r);else if("VARTYPE"===p)$.vartype=v.split(r);else if("VARFORM"===p)$.varform=v.split(r);else if("VARDIM"===p)$.vardim=e(v.split(r));else if("UNITS"===p)$.units=v.split(r);else if("FACTOR"===p)$.factor=e(v.split(r));else if("FIRST"===p)$.first=e(v.split(r));else if("LAST"===p)$.last=e(v.split(r));else if("MIN"===p)$.min=e(v.split(r));else if("MAX"===p)$.max=e(v.split(r));else if(".NUCLEUS"===p)A.twoD&&(A.yType=v.split(r)[0]);else if("PAGE"===p){k.page=v.trim(),k.pageValue=parseFloat(v.replace(/^.*=/,"")),k.pageSymbol=k.page.replace(/[=].*/,"");var C=$.symbol.indexOf(k.pageSymbol),D="";$.units&&$.units[C]&&(D=$.units[C]),A.indirectFrequency&&"PPM"!==D&&(k.pageValue/=A.indirectFrequency)}else"RETENTIONTIME"===p?k.pageValue=parseFloat(v):o(p)?k[i(p)]=v:"SAMPLEDESCRIPTION"===p&&(k.sampleDescription=v);p.match(m.keepRecordsRegExp)&&(A.info[p]?(Array.isArray(A.info[p])||(A.info[p]=[A.info[p]]),A.info[p].push(v.trim())):A.info[p]=v.trim())}else M&&(v.match(/.*(XYA).*/)&&c(k,v),S.push(k),k=new a);else M&&(s(A,k),f(k,v,A),S.push(k),k=new a);else M&&(s(A,k),v.match(/.*\+\+.*/)?(k.deltaX||(k.deltaX=(k.lastX-k.firstX)/(k.nbPoints-1)),u(k,v)):f(k,v,A),S.push(k),k=new a)}if(A.profiling&&A.profiling.push({action:"Finished parsing",time:Date.now()-b}),Object.keys($).length>0){var V=[],O=Object.keys($);for(let r=0;r<O.length;r++){var T=O[r],F=$[T];for(let r=0;r<F.length;r++)V[r]||(V[r]={}),V[r][T]=F[r]}A.ntuples=V}if(A.twoD&&M&&(!function(r,t){var e=function(r){var t=r[0].data[0][0],e=t,a=r.length,n=r[0].data[0].length/2,i=new Array(a);for(let l=0;l<a;l++){i[l]=new Array(n);var o=r[l].data[0];for(let r=0;r<n;r++){var s=o[2*r+1];i[l][r]=s,s<t&&(t=s),s>e&&(e=s)}}const h=r[0].data[0][0],u=r[0].data[0][r[0].data[0].length-2],c=r[0].pageValue,f=r[a-1].pageValue;if(h>u)for(let r of i)r.reverse();c>f&&i.reverse();return{z:i,minX:Math.min(h,u),maxX:Math.max(h,u),minY:Math.min(c,f),maxY:Math.max(c,f),minZ:t,maxZ:e,noise:l(i[0].map(Math.abs))}}(r.spectra);t.noContour||(r.contourLines=function(r,t){for(var e,a,n,i,o,s,l,h,u,c,f,m,g,p=r.noise,v=r.z,d=v.length,w=v[0].length,y=r.minX,x=(r.maxX-y)/(w-1),M=r.minY,b=(r.maxY-M)/(d-1),$=r.minZ,A=r.maxZ,S=2*t.nbContourLevels,k=new Array(S),_=0;_<S;_++){var E={};k[_]=E;var z=_%2,R=(A-t.noiseMultiplier*p)*Math.exp((_>>1)-t.nbContourLevels);g=0===z?R+t.noiseMultiplier*p:0-R-t.noiseMultiplier*p;var C=[];if(E.zValue=g,E.lines=C,!(g<=$||g>=A))for(var D=0;D<d-1;D++)for(var V=v[D],O=v[D+1],T=0;T<w-1;T++)e=V[T],a=V[T+1],n=O[T],i=O[T+1],l=n>g,h=i>g,(o=e>g)!==(s=a>g)&&o!==l&&(u=T+(g-e)/(a-e),c=D,f=T,m=D+(g-e)/(n-e),C.push(u*x+y),C.push(c*b+M),C.push(f*x+y),C.push(m*b+M)),h!==s&&h!==l&&(u=T+1,c=D+1-(g-i)/(a-i),f=T+1-(g-i)/(n-i),m=D+1,C.push(u*x+y),C.push(c*b+M),C.push(f*x+y),C.push(m*b+M)),s!==l&&(u=(T+1-(g-a)/(n-a))*x+y,c=(D+(g-a)/(n-a))*b+M,s!==o&&(f=T+1-(g-a)/(e-a),m=D,C.push(u),C.push(c),C.push(f*x+y),C.push(m*b+M)),l!==o&&(f=T,m=D+1-(g-n)/(e-n),C.push(u),C.push(c),C.push(f*x+y),C.push(m*b+M)),s!==h&&(f=T+1,m=D+(g-a)/(i-a),C.push(u),C.push(c),C.push(f*x+y),C.push(m*b+M)),l!==h&&(f=T+(g-n)/(i-n),m=D+1,C.push(u),C.push(c),C.push(f*x+y),C.push(m*b+M)))}return{minX:r.minX,maxX:r.maxX,minY:r.minY,maxY:r.maxY,segments:k}}(e,t),delete e.z);r.minMax=e}(A,m),A.profiling&&A.profiling.push({action:"Finished countour plot calculation",time:Date.now()-b}),m.keepSpectra||delete A.spectra),m.chromatogram&&(m.xy=!0),m.xy&&M&&S.length>0)for(let r=0;r<S.length;r++)if((k=S[r]).data.length>0)for(let r=0;r<k.data.length;r++){for(var q=k.data[r],I={x:new Array(q.length/2),y:new Array(q.length/2)},j=0;j<q.length;j+=2)I.x[j/2]=q[j],I.y[j/2]=q[j+1];k.data[r]=I}return m.chromatogram&&(A.spectra.length>1?function(r){var e=r.spectra,a=e.length,n={times:new Array(a),series:{ms:{dimension:2,data:new Array(a)}}},o=[];for(let r=0;r<t.length;r++){var s=i(t[r]);e[0][s]&&(o.push(s),n.series[s]={dimension:1,data:new Array(a)})}for(let r=0;r<a;r++){var l=e[r];n.times[r]=l.pageValue;for(let t=0;t<o.length;t++)n.series[o[t]].data[r]=parseFloat(l[o[t]]);l.data&&(n.series.ms.data[r]=[l.data[0].x,l.data[0].y])}r.chromatogram=n}(A):function(r){var t=r.spectra[0].data[0];r.chromatogram={times:t.x.slice(),series:{intensity:{dimension:1,data:t.y.slice()}}}}(A),A.profiling&&A.profiling.push({action:"Finished chromatogram calculation",time:Date.now()-b})),A.profiling&&A.profiling.push({action:"Total time",time:Date.now()-b}),A}}var convert=getConverter();function JcampConverter(r,t,e){return"boolean"==typeof t&&(e=t,t={}),e?postToWorker(r,t):convert(r,t)}var stamps={},worker;function postToWorker(r,t){return worker||createWorker(),new Promise(function(e){var a="".concat(Date.now()).concat(Math.random());stamps[a]=e,worker.postMessage(JSON.stringify({stamp:a,input:r,options:t}))})}function createWorker(){var r=URL.createObjectURL(new Blob(["var getConverter =".concat(getConverter.toString(),";var convert = getConverter(); onmessage = function (event) { var data = JSON.parse(event.data); postMessage(JSON.stringify({stamp: data.stamp, output: convert(data.input, data.options)})); };")],{type:"application/javascript"}));worker=new Worker(r),URL.revokeObjectURL(r),worker.addEventListener("message",function(r){var t=JSON.parse(r.data),e=t.stamp;stamps[e]&&stamps[e](t.output)})}function createTree(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{flatten:e=!1}=t;if("string"!=typeof r)throw new TypeError("the JCAMP should be a string");let a,n=r.split(/[\r\n]+/),i=[],o=[],s=[],l=0,h=r.includes("## ");for(var u=0;u<n.length;u++){let r=n[u],t=h?r.replace(/ /g,""):r;if("##NTUPLES"===t.substring(0,9)&&l++,"##TITLE"===t.substring(0,7)){let e=[t.substring(8).trim()];for(let r=u+1;r<n.length&&!n[r].startsWith("##");r++)e.push(n[r].trim());o.push({title:e.join("\n"),jcamp:"".concat(r,"\n"),children:[]}),a=o[o.length-1],i.push(a)}else if("##END"===t.substring(0,5)&&0===l){a.jcamp+="".concat(r,"\n");var c=o.pop();0!==o.length?(a=o[o.length-1]).children.push(c):(a=void 0,s.push(c))}else if(a&&a.jcamp){a.jcamp+="".concat(r,"\n");var f=t.match(/^##(.*?)=(.+)/);if(f)"DATATYPE"===f[1].replace(/[ _-]/g,"").toUpperCase()&&(a.dataType=f[2].trim())}"##END"===t.substring(0,5)&&l>0&&l--}return e?(i.forEach(r=>{r.children=void 0}),i):s}var src$7={convert:JcampConverter,createTree:createTree};function sortX(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{x:e,y:a}=r,{reverse:n=!1}=t;var i;i=n?(r,t)=>t.x-r.x:(r,t)=>r.x-t.x;for(var o=e.map((r,t)=>({x:r,y:a[t]})).sort(i),s={x:e.slice(),y:a.slice()},l=0;l<e.length;l++)s.x[l]=o[l].x,s.y[l]=o[l].y;return s}var src$8=Object.freeze({default:sortX});function uniqueX(r,t){if(!(r.length<2)){for(var e=r[0],a=0,n=1;n<r.length;n++)e!==r[n]&&(a++,e=r[n],r[a]=r[n],n!==a&&(t[a]=0)),n!==a&&(t[a]+=t[n]);r.length=a+1,t.length=a+1}}var src$9=uniqueX;function parseXY(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{normalize:e=!1,uniqueX:a=!1,arrayType:n="xyxy",xColumn:i=0,yColumn:o=1,keepInfo:s=!1,maxNumberColumns:l=Math.max(i,o)+1,minNumberColumns:h=Math.max(i,o)+1}=t;var u=r.split(/[\r\n]+/);if("xxyy"!==n&&"xyxy"!==n)throw new Error("unsupported arrayType (".concat(n,")"));for(var c=Number.MIN_VALUE,f=[[],[]],m=[],g=0;g<u.length;g++){var p=u[g].trim();if(p.match(/[0-9]+/)&&p.match(/^[0-9eE,;. \t+-]+$/)){var v=p.split(/,[; \t]+|[; \t]+/);if(1===v.length&&(v=p.split(/[,; \t]+/)),v&&v.length>=h&&v.length<=l){let r=parseFloat(v[i].replace(",",".")),t=parseFloat(v[o].replace(",","."));t>c&&(c=t),f[0].push(r),f[1].push(t)}}else p&&m.push({position:f[0].length,value:p})}if(e)for(var d=0;d<f[0].length;d++)f[1][d]/=c;if(a&&src$9(f[0],f[1]),"xyxy"===n){var w=[];for(let r=0;r<f[0].length;r++)w.push([f[0][r],f[1][r]]);f=w}return s?{info:m,data:f}:f}var src$a=Object.freeze({parseXY:parseXY}),require$$0=getCjsExportFromNamespace(libEs6),require$$1=getCjsExportFromNamespace(libEs6$1),require$$2=getCjsExportFromNamespace(src$8),xyParser=getCjsExportFromNamespace(src$a),lib=createCommonjsModule(function(r,t){function e(r){return r&&"object"==typeof r&&"default"in r?r.default:r}Object.defineProperty(t,"__esModule",{value:!0});var a=e(require$$0),n=e(require$$1),i=e(require$$2);function o(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.wavelength)throw new Error("addPeak: peak mush have wavelength property");const{wavelength:e,intensity:a}=t;for(let t of r.peaks)if(Number(t.wavelength)===e)return t;return r.peaks.push({wavelength:e,intensity:a,kind:s(a,r.minIntensity,r.maxIntensity)}),t}function s(r,t,e){var a=r/(e-t);return a<.33?"w":a<.66?"m":"S"}function l(r,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{range:a=0,optimize:n=!1}=e;let i=function(r,t){let e={intensity:r.intensity[0],wavelength:r.wavelength[0],index:0},a=Math.abs(t-e.wavelength);for(let n=1;n<r.wavelength.length;n++){let i=Math.abs(t-r.wavelength[n]);i<a&&(a=i,h(r,e,n))}return e}(r,t);return n?function(r,t){let e,a=t.index;for(;a!==e;)e=a,a>0&&r.intensity[a-1]>t.intensity?h(r,t,--a):a<r.wavelength.length-1&&r.intensity[a+1]>t.intensity&&h(r,t,++a)}(r,i):a&&function(r,t,e,a){for(let n=0;n<r.wavelength.length;n++)Math.abs(r.wavelength[n]-e)<=a&&r.intensity[n]>t.intensity&&h(r,t,n)}(r,i,t,a),o(r,i)}function h(r,t,e){t.index=e,t.wavelength=r.wavelength[e],t.intensity=r.intensity[e]}class u{constructor(r){this.wavelength=r.wavelength||[],this.intensity=r.intensity||[],this.peaks=[],function(r){r.wavelength.length>0&&(r.minWavelength=a(r.wavelength));r.wavelength.length>0&&(r.maxWavelength=n(r.wavelength));r.intensity.length>0&&(r.minIntensity=a(r.intensity));r.intensity.length>0&&(r.maxIntensity=n(r.intensity))}(this)}setPeaks(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.peaks=r}peakPicking(r){l(this,r,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}getData(){return{x:this.wavelength,y:this.intensity}}}u.prototype.getAnnotations=function(r){return function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{fillColor:e="green",strokeColor:a="red",creationFct:n}=t,i=r.peaks;return i?i.map(r=>{var t={line:1,type:"rect",strokeColor:a,strokeWidth:0,fillColor:e};return n&&n(t,r),function(r,t){r.label=[{text:t.kind,size:"18px",anchor:"middle",color:"red",position:{x:t.wavelength,y:t.intensity,dy:"-15px"}}],r.position=[{x:t.wavelength,y:t.intensity,dy:"-10px",dx:"-1px"},{x:t.wavelength,y:t.intensity,dy:"-5px",dx:"1px"}]}(t,r),t}):[]}(this,r)},u.prototype.autoPeakPicking=function(r){return function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{noiseLevel:e=.001,minMaxRatio:a=.05,fromWavelength:n=0,toWavelength:i=5e3,replaceExisting:s=!0}=t;let l=src$6.gsd(r.wavelength,r.absorbance,{noiseLevel:e,minMaxRatio:a,realTopDetection:!0,maxCriteria:!0,smoothY:!1,sgOptions:{windowSize:7,polynomial:3}});if(l=l.filter(r=>r.x>=n&&r.x<=i),s)for(;r.peaks.length;)r.peaks.pop();r:for(let t of l){for(let e of r.peaks)if(Number(e.wavelength)===Number(t.x))continue r;o(r,{wavelength:t.x,absorbance:t.y})}}(this,r)},t.Spectrum=u,t.fromJcamp=function(r){let t=src$7.convert(r,{xy:!0}).spectra[0].data[0];return t=i(t),new u({wavelength:t.x,intensity:t.y})},t.fromText=function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({},t,{arrayType:"xxyy"});const e=xyParser.parseXY(r,t);let a=i({x:e[0],y:e[1]});return new u({wavelength:a.x,intensity:a.y})}}),index=unwrapExports(lib),lib_1=lib.Spectrum,lib_2=lib.fromJcamp,lib_3=lib.fromText;exports.Spectrum=lib_1,exports.default=index,exports.fromJcamp=lib_2,exports.fromText=lib_3,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=raman-spectrum.min.js.map
